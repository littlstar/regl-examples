(function e$$0(y,v,k){function c(b,f){if(!v[b]){if(!y[b]){var h="function"==typeof require&&require;if(!f&&h)return h(b,!0);if(a)return a(b,!0);h=Error("Cannot find module '"+b+"'");throw h.code="MODULE_NOT_FOUND",h;}h=v[b]={exports:{}};y[b][0].call(h.exports,function(a){var f=y[b][1][a];return c(f?f:a)},h,h.exports,e$$0,y,v,k)}return v[b].exports}for(var a="function"==typeof require&&require,b=0;b<k.length;b++)c(k[b]);return c})({1:[function(x,y,v){x("webrtc-adapter");y.exports=function(k,c){var a,
b={video:!0,audio:!0};2!==arguments.length&&(c=k,k=b);if("undefined"===typeof navigator||!navigator.getUserMedia)return a=Error("MediaStreamError"),a.name="NotSupportedError",setTimeout(function(){c(a)},0);if(!k.audio&&!k.video)return a=Error("MediaStreamError"),a.name="NoMediaRequestedError",setTimeout(function(){c(a)},0);navigator.mediaDevices.getUserMedia(k).then(function(a){c(null,a)})["catch"](function(a){var b;"string"===typeof a?(b=Error("MediaStreamError"),b.name="PermissionDeniedError"===
a||"PERMISSION_DENIED"===a?"PermissionDeniedError":"ConstraintNotSatisfiedError"):(b=a,b.name||(a.name=b.PermissionDeniedError?"PermissionDeniedError":"ConstraintNotSatisfiedError"));c(b)})}},{"webrtc-adapter":4}],2:[function(x,y,v){(function(k,c){"object"===typeof v&&"undefined"!==typeof y?y.exports=c():"function"===typeof define&&define.amd?define(c):k.createREGL=c()})(this,function(){function k(d){return"undefined"!==typeof btoa?btoa(d):"base64:"+d}function c(d){d=Error("(regl) "+d);console.error(d);
throw d;}function a(d,a){d||c(a)}function b(d){return d?": "+d:""}function e(d,a,g){0>a.indexOf(d)&&c("invalid value"+b(g)+". must be one of: "+a)}function f(d,a){for(d+="";d.length<a;)d=" "+d;return d}function h(){this.name="unknown";this.lines=[];this.index={};this.hasErrors=!1}function l(d,a){this.number=d;this.line=a;this.errors=[]}function r(d,a,b){this.file=d;this.line=a;this.message=b}function p(){var d=Error(),d=(d.stack||d).toString(),a=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(d);return a?
a[1]:(d=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(d))?d[1]:"unknown"}function n(){var d=Error(),d=(d.stack||d).toString(),a=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(d);return a?a[1]:(d=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(d))?d[1]:"unknown"}function C(d,a){var b=d.split("\n"),g=1,c=0,e={unknown:new h,0:new h};e.unknown.name=e[0].name=a||p();e.unknown.lines.push(new l(0,""));for(var f=0;f<b.length;++f){var Q=b[f],G=/^\s*\#\s*(\w+)\s+(.+)\s*$/.exec(Q);if(G)switch(G[1]){case "line":if(G=/(\d+)(\s+\d+)?/.exec(G[2]))g=
G[1]|0,G[2]&&(c=G[2]|0,c in e||(e[c]=new h));break;case "define":if(G=/SHADER_NAME(_B64)?\s+(.*)$/.exec(G[2]))e[c].name=G[1]?k(G[2]):G[2]}e[c].lines.push(new l(g++,Q))}Object.keys(e).forEach(function(d){var a=e[d];a.lines.forEach(function(d){a.index[d.number]=d})});return e}function M(d){var a=[];d.split("\n").forEach(function(d){if(!(5>d.length)){var b=/^ERROR\:\s+(\d+)\:(\d+)\:\s*(.*)$/.exec(d);b?a.push(new r(b[1]|0,b[2]|0,b[3].trim())):0<d.length&&a.push(new r("unknown",0,d))}});return a}function W(d,
a){a.forEach(function(a){var m=d[a.file];if(m){var b=m.index[a.line];if(b){b.errors.push(a);m.hasErrors=!0;return}}d.unknown.hasErrors=!0;d.unknown.lines[0].errors.push(a)})}function Y(d){d._commandRef=p()}function x(d,a){var b=n();c(d+" in command "+(a||p())+("unknown"===b?"":" called from "+b))}function y(d,a,g,c){typeof d!==a&&x("invalid parameter type"+b(g)+". expected "+a+", got "+typeof d,c||p())}function v(d,a){return 32820===d||32819===d||33635===d?2:34042===d?4:N[d]*a}function A(d,a){this.id=
Ub++;this.type=d;this.data=a}function da(d){if(0===d.length)return[];var a=d.charAt(0),b=d.charAt(d.length-1);if(1<d.length&&a===b&&('"'===a||"'"===a))return['"'+d.substr(1,d.length-2).replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];if(a=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(d))return da(d.substr(0,a.index)).concat(da(a[1])).concat(da(d.substr(a.index+a[0].length)));a=d.split(".");if(1===a.length)return['"'+d.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];d=[];for(b=0;b<a.length;++b)d=d.concat(da(a[b]));
return d}function Ka(d){return"["+da(d).join("][")+"]"}function ja(){var d={"":0},a=[""];return{id:function(b){var g=d[b];if(g)return g;g=d[b]=a.length;a.push(b);return g},str:function(d){return a[d]}}}function fb(d,a,b){function g(){var a=window.innerWidth,m=window.innerHeight;d!==document.body&&(m=d.getBoundingClientRect(),a=m.right-m.left,m=m.bottom-m.top);c.width=b*a;c.height=b*m;S(c.style,{width:a+"px",height:m+"px"})}var c=document.createElement("canvas");S(c.style,{border:0,margin:0,padding:0,
top:0,left:0});d.appendChild(c);d===document.body&&(c.style.position="absolute",S(d.style,{margin:0,padding:0}));window.addEventListener("resize",g,!1);g();return{canvas:c,onDestroy:function(){window.removeEventListener("resize",g);d.removeChild(c)}}}function ka(d,a){function b(g){try{return d.getContext(g,a)}catch(c){return null}}return b("webgl")||b("experimental-webgl")||b("webgl-experimental")}function La(d){if("string"===typeof d)return d.split();g(Array.isArray(d),"invalid extension array");
return d}function Xa(d){return"string"===typeof d?(g("undefined"!==typeof document,"not supported outside of DOM"),document.querySelector(d)):d}function Ya(d){var a=d||{},b,c,e,f;d={};var h=[],k=[],G="undefined"===typeof window?1:window.devicePixelRatio,l=!1,ya=function(d){d&&g.raise(d)},R=function(){};"string"===typeof a?(g("undefined"!==typeof document,"selector queries only supported in DOM enviroments"),b=document.querySelector(a),g(b,"invalid query string for element")):"object"===typeof a?"string"===
typeof a.nodeName&&"function"===typeof a.appendChild&&"function"===typeof a.getBoundingClientRect?b=a:"function"===typeof a.drawArrays||"function"===typeof a.drawElements?(f=a,e=f.canvas):(g.constructor(a),"gl"in a?f=a.gl:"canvas"in a?e=Xa(a.canvas):"container"in a&&(c=Xa(a.container)),"attributes"in a&&(d=a.attributes,g.type(d,"object","invalid context attributes")),"extensions"in a&&(h=La(a.extensions)),"optionalExtensions"in a&&(k=La(a.optionalExtensions)),"onDone"in a&&(g.type(a.onDone,"function",
"invalid or missing onDone callback"),ya=a.onDone),"profile"in a&&(l=!!a.profile),"pixelRatio"in a&&(G=+a.pixelRatio,g(0<G,"invalid pixel ratio"))):g.raise("invalid arguments to regl");b&&("canvas"===b.nodeName.toLowerCase()?e=b:c=b);if(!f){if(!e){g("undefined"!==typeof document,"must manually specify webgl context outside of DOM environments");b=fb(c||document.body,ya,G);if(!b)return null;e=b.canvas;R=b.onDestroy}f=ka(e,d)}return f?{gl:f,canvas:e,container:c,extensions:h,optionalExtensions:k,pixelRatio:G,
profile:l,onDone:ya,onDestroy:R}:(R(),ya("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function za(d,a){function b(a){g.type(a,"string","extension name must be string");a=a.toLowerCase();var m;try{m=c[a]=d.getExtension(a)}catch(w){}return!!m}for(var c={},e=0;e<a.extensions.length;++e){var f=a.extensions[e];if(!b(f))return a.onDestroy(),a.onDone('"'+f+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),
null}a.optionalExtensions.forEach(b);return{extensions:c,restore:function(){Object.keys(c).forEach(function(d){if(!b(d))throw Error("(regl): error restoring extension "+d);})}}}function Z(d){return!!d&&"object"===typeof d&&Array.isArray(d.shape)&&Array.isArray(d.stride)&&"number"===typeof d.offset&&d.shape.length===d.stride.length&&(Array.isArray(d.data)||L(d.data))}function la(d,a){for(var b=Array(d),g=0;g<d;++g)b[g]=a(g);return b}function wb(d){var a,b;a=(65535<d)<<4;d>>>=a;b=(255<d)<<3;d>>>=b;
a|=b;b=(15<d)<<2;d>>>=b;a|=b;b=(3<d)<<1;return a|b|d>>>b>>1}function X(d){a:{for(var a=16;268435456>=a;a*=16)if(d<=a){d=a;break a}d=0}a=xb[wb(d)>>2];return 0<a.length?a.pop():new ArrayBuffer(d)}function yb(d){xb[wb(d.byteLength)>>2].push(d)}function zb(d,a,b,g,c,e){for(var f=0;f<a;++f)for(var h=d[f],k=0;k<b;++k)for(var l=h[k],ya=0;ya<g;++ya)c[e++]=l[ya]}function Ab(d,a,b,g,c){for(var e=1,f=b+1;f<a.length;++f)e*=a[f];var h=a[b];if(4===a.length-b){var k=a[b+1],l=a[b+2];a=a[b+3];for(f=0;f<h;++f)zb(d[f],
k,l,a,g,c),c+=e}else for(f=0;f<h;++f)Ab(d[f],a,b+1,g,c),c+=e}function gb(d){return Za[Object.prototype.toString.call(d)]|0}function Bb(d,a){for(var b=0;b<a.length;++b)d[b]=a[b]}function Cb(d,a,b,g,c,e,f){for(var h=0,k=0;k<b;++k)for(var l=0;l<g;++l)d[h++]=a[c*k+e*l+f]}function Vb(d,a,b){function c(a){this.id=k++;this.buffer=d.createBuffer();this.type=a;this.usage=35044;this.byteLength=0;this.dimension=1;this.dtype=5121;this.persistentData=null;b.profile&&(this.stats={size:0})}function e(a,b,g){a.byteLength=
b.byteLength;d.bufferData(a.type,b,g)}function f(d,a,b,c,m,h){d.usage=b;if(Array.isArray(a)){if(d.dtype=c||5126,0<a.length)if(Array.isArray(a[0])){m=Db(a);for(var w=c=1;w<m.length;++w)c*=m[w];d.dimension=c;a=ob(a,m,d.dtype);e(d,a,b);h?d.persistentData=a:T.freeType(a)}else"number"===typeof a[0]?(d.dimension=m,m=T.allocType(d.dtype,a.length),Bb(m,a),e(d,m,b),h?d.persistentData=m:T.freeType(m)):L(a[0])?(d.dimension=a[0].length,d.dtype=c||gb(a[0])||5126,a=ob(a,[a.length,a[0].length],d.dtype),e(d,a,b),
h?d.persistentData=a:T.freeType(a)):g.raise("invalid buffer data")}else if(L(a))d.dtype=c||gb(a),d.dimension=m,e(d,a,b),h&&(d.persistentData=new Uint8Array(new Uint8Array(a.buffer)));else if(Z(a)){m=a.shape;var k=a.stride,w=a.offset,l=0,p=0,G=0,z=0;1===m.length?(l=m[0],p=1,G=k[0],z=0):2===m.length?(l=m[0],p=m[1],G=k[0],z=k[1]):g.raise("invalid shape");d.dtype=c||gb(a.data)||5126;d.dimension=p;m=T.allocType(d.dtype,l*p);Cb(m,a.data,l,p,G,z,w);e(d,m,b);h?d.persistentData=m:T.freeType(m)}else g.raise("invalid buffer data")}
function h(b){a.bufferCount--;var c=b.buffer;g(c,"buffer must not be deleted already");d.deleteBuffer(c);b.buffer=null;delete l[b.id]}var k=0,l={};c.prototype.bind=function(){d.bindBuffer(this.type,this.buffer)};c.prototype.destroy=function(){h(this)};var p=[];b.profile&&(a.getTotalBufferSize=function(){var a=0;Object.keys(l).forEach(function(d){a+=l[d].stats.size});return a});return{create:function(e,k,p,u){function t(a){var c=35044,m=null,e=0,h=0,k=1;Array.isArray(a)||L(a)||Z(a)?m=a:"number"===
typeof a?e=a|0:a&&(g.type(a,"object","buffer arguments must be an object, a number or an array"),"data"in a&&(g(null===m||Array.isArray(m)||L(m)||Z(m),"invalid data for buffer"),m=a.data),"usage"in a&&(g.parameter(a.usage,hb,"invalid buffer usage"),c=hb[a.usage]),"type"in a&&(g.parameter(a.type,$a,"invalid buffer type"),h=$a[a.type]),"dimension"in a&&(g.type(a.dimension,"number","invalid dimension"),k=a.dimension|0),"length"in a&&(g.nni(e,"buffer length must be a nonnegative integer"),e=a.length|
0));F.bind();m?f(F,m,c,h,k,u):(d.bufferData(F.type,e,c),F.dtype=h||5121,F.usage=c,F.dimension=k,F.byteLength=e);b.profile&&(F.stats.size=F.byteLength*ta[F.dtype]);return t}function Q(a,b){g(b+a.byteLength<=F.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+a.byteLength+" starting from offset "+b+" to a buffer of size "+F.byteLength);d.bufferSubData(F.type,b,a)}a.bufferCount++;var F=new c(k);l[F.id]=F;p||t(e);t._reglType="buffer";t._buffer=F;t.subdata=function(a,
d){var b=(d||0)|0,c;F.bind();if(Array.isArray(a)){if(0<a.length)if("number"===typeof a[0]){var m=T.allocType(F.dtype,a.length);Bb(m,a);Q(m,b);T.freeType(m)}else Array.isArray(a[0])||L(a[0])?(c=Db(a),m=ob(a,c,F.dtype),Q(m,b),T.freeType(m)):g.raise("invalid buffer data")}else if(L(a))Q(a,b);else if(Z(a)){c=a.shape;var e=a.stride,f=m=0,h=0,w=0;1===c.length?(m=c[0],f=1,h=e[0],w=0):2===c.length?(m=c[0],f=c[1],h=e[0],w=e[1]):g.raise("invalid shape");c=Array.isArray(a.data)?F.dtype:gb(a.data);c=T.allocType(c,
m*f);Cb(c,a.data,m,f,h,w,a.offset);Q(c,b);T.freeType(c)}else g.raise("invalid data for buffer subdata");return t};b.profile&&(t.stats=F.stats);t.destroy=function(){h(F)};return t},createStream:function(a,d){var b=p.pop();b||(b=new c(a));b.bind();f(b,d,35040,0,1,!1);return b},destroyStream:function(a){p.push(a)},clear:function(){fa(l).forEach(h);p.forEach(h)},getBuffer:function(a){return a&&a._buffer instanceof c?a._buffer:null},restore:function(){fa(l).forEach(function(a){a.buffer=d.createBuffer();
d.bindBuffer(a.type,a.buffer);d.bufferData(a.type,a.persistentData||a.byteLength,a.usage)})},_initBuffer:f}}function Wb(a,b,c,e){function f(a){this.id=p++;l[this.id]=this;this.buffer=a;this.primType=4;this.type=this.vertCount=0}function h(e,f,k,t,l,p,G){e.buffer.bind();if(f){var z=G;G||L(f)&&(!Z(f)||L(f.data))||(z=b.oes_element_index_uint?5125:5123);c._initBuffer(e.buffer,f,k,z,3)}else a.bufferData(34963,p,k),e.buffer.dtype=z||5121,e.buffer.usage=k,e.buffer.dimension=3,e.buffer.byteLength=p;z=G;if(!G){switch(e.buffer.dtype){case 5121:case 5120:z=
5121;break;case 5123:case 5122:z=5123;break;case 5125:case 5124:z=5125;break;default:g.raise("unsupported type for element array")}e.buffer.dtype=z}e.type=z;g(5125!==z||!!b.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");f=l;0>f&&(f=e.buffer.byteLength,5123===z?f>>=1:5125===z&&(f>>=2));e.vertCount=f;f=t;0>t&&(f=4,t=e.buffer.dimension,1===t&&(f=0),2===t&&(f=1),3===t&&(f=4));e.primType=f}function k(a){e.elementsCount--;g(null!==a.buffer,"must not double destroy elements");
delete l[a.id];a.buffer.destroy();a.buffer=null}var l={},p=0,n={uint8:5121,uint16:5123};b.oes_element_index_uint&&(n.uint32=5125);f.prototype.bind=function(){this.buffer.bind()};var r=[];return{create:function(a,d){function b(a){if(a)if("number"===typeof a)m(a),l.primType=4,l.vertCount=a|0,l.type=5121;else{var d=null,c=35044,e=-1,f=-1,k=0,w=0;if(Array.isArray(a)||L(a)||Z(a))d=a;else if(g.type(a,"object","invalid arguments for elements"),"data"in a&&(d=a.data,g(Array.isArray(d)||L(d)||Z(d),"invalid data for element buffer")),
"usage"in a&&(g.parameter(a.usage,hb,"invalid element buffer usage"),c=hb[a.usage]),"primitive"in a&&(g.parameter(a.primitive,Ma,"invalid element buffer primitive"),e=Ma[a.primitive]),"count"in a&&(g("number"===typeof a.count&&0<=a.count,"invalid vertex count for elements"),f=a.count|0),"type"in a&&(g.parameter(a.type,n,"invalid buffer type"),w=n[a.type]),"length"in a)k=a.length|0;else if(k=f,5123===w||5122===w)k*=2;else if(5125===w||5124===w)k*=4;h(l,d,c,e,f,k,w)}else m(),l.primType=4,l.vertCount=
0,l.type=5121;return b}var m=c.create(null,34963,!0),l=new f(m._buffer);e.elementsCount++;b(a);b._reglType="elements";b._elements=l;b.subdata=function(a,d){m.subdata(a,d);return b};b.destroy=function(){k(l)};return b},createStream:function(a){var d=r.pop();d||(d=new f(c.create(null,34963,!0,!1)._buffer));h(d,a,35040,-1,-1,0,0);return d},destroyStream:function(a){r.push(a)},getElements:function(a){return"function"===typeof a&&a._elements instanceof f?a._elements:null},clear:function(){fa(l).forEach(k)}}}
function Eb(a){for(var b=T.allocType(5123,a.length),g=0;g<a.length;++g)if(isNaN(a[g]))b[g]=65535;else if(Infinity===a[g])b[g]=31744;else if(-Infinity===a[g])b[g]=64512;else{Fb[0]=a[g];var c=Xb[0],e=c>>>31<<15,f=(c<<1>>>24)-127,c=c>>13&1023;b[g]=-24>f?e:-14>f?e+(c+1024>>-14-f):15<f?e+31744:e+(f+15<<10)+c}return b}function I(a){return Array.isArray(a)||L(a)}function Gb(a){return Array.isArray(a)&&(0===a.length||"number"===typeof a[0])}function Hb(a){return Array.isArray(a)&&0!==a.length&&I(a[0])?!0:
!1}function Na(a){return Object.prototype.toString.call(a)}function qb(a){if(!a)return!1;var b=Na(a);return 0<=Yb.indexOf(b)?!0:Gb(a)||Hb(a)||Z(a)}function Ib(a,b){36193===a.type?(a.data=Eb(b),T.freeType(b)):a.data=b}function ib(a,b,g,c,e,f){a="undefined"!==typeof E[a]?E[a]:aa[a]*Oa[b];f&&(a*=6);if(e){for(c=0;1<=g;)c+=a*g*g,g/=2;return c}return a*g*c}function Zb(a,b,c,e,f,h,k){function l(){this.format=this.internalformat=6408;this.type=5121;this.flipY=this.premultiplyAlpha=this.compressed=!1;this.unpackAlignment=
1;this.channels=this.height=this.width=this.colorSpace=0}function p(a,d){a.internalformat=d.internalformat;a.format=d.format;a.type=d.type;a.compressed=d.compressed;a.premultiplyAlpha=d.premultiplyAlpha;a.flipY=d.flipY;a.unpackAlignment=d.unpackAlignment;a.colorSpace=d.colorSpace;a.width=d.width;a.height=d.height;a.channels=d.channels}function n(a,d){if("object"===typeof d&&d){"premultiplyAlpha"in d&&(g.type(d.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),a.premultiplyAlpha=d.premultiplyAlpha);
"flipY"in d&&(g.type(d.flipY,"boolean","invalid texture flip"),a.flipY=d.flipY);"alignment"in d&&(g.oneOf(d.alignment,[1,2,4,8],"invalid texture unpack alignment"),a.unpackAlignment=d.alignment);"colorSpace"in d&&(g.parameter(d.colorSpace,Jb,"invalid colorSpace"),a.colorSpace=Jb[d.colorSpace]);if("type"in d){var e=d.type;g(b.oes_texture_float||!("float"===e||"float32"===e),"you must enable the OES_texture_float extension in order to use floating point textures.");g(b.oes_texture_half_float||!("half float"===
e||"float16"===e),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures.");g(b.webgl_depth_texture||!("uint16"===e||"uint32"===e||"depth stencil"===e),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures.");g.parameter(e,V,"invalid texture type");a.type=V[e]}var f=a.width,h=a.height,k=a.channels,e=!1;"shape"in d?(g(Array.isArray(d.shape)&&2<=d.shape.length,"shape must be an array"),f=d.shape[0],h=d.shape[1],3===d.shape.length&&
(k=d.shape[2],g(0<k&&4>=k,"invalid number of channels"),e=!0),g(0<=f&&f<=c.maxTextureSize,"invalid width"),g(0<=h&&h<=c.maxTextureSize,"invalid height")):("radius"in d&&(f=h=d.radius,g(0<=f&&f<=c.maxTextureSize,"invalid radius")),"width"in d&&(f=d.width,g(0<=f&&f<=c.maxTextureSize,"invalid width")),"height"in d&&(h=d.height,g(0<=h&&h<=c.maxTextureSize,"invalid height")),"channels"in d&&(k=d.channels,g(0<k&&4>=k,"invalid number of channels"),e=!0));a.width=f|0;a.height=h|0;a.channels=k|0;f=!1;"format"in
d&&(f=d.format,g(b.webgl_depth_texture||!("depth"===f||"depth stencil"===f),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),g.parameter(f,J,"invalid texture format"),h=a.internalformat=J[f],a.format=sb[h],f in V&&!("type"in d)&&(a.type=V[f]),f in v&&(a.compressed=!0),f=!0);!e&&f?a.channels=aa[a.format]:e&&!f?a.channels!==jb[a.format]&&(a.format=a.internalformat=jb[a.channels]):f&&e&&g(a.channels===aa[a.format],"number of channels inconsistent with specified format")}}
function r(b){a.pixelStorei(37440,b.flipY);a.pixelStorei(37441,b.premultiplyAlpha);a.pixelStorei(37443,b.colorSpace);a.pixelStorei(3317,b.unpackAlignment)}function R(){l.call(this);this.yOffset=this.xOffset=0;this.data=null;this.needsFree=!1;this.element=null;this.needsCopy=!1}function sa(a,d){var b=null;qb(d)?b=d:d&&(g.type(d,"object","invalid pixel data type"),n(a,d),"x"in d&&(a.xOffset=d.x|0),"y"in d&&(a.yOffset=d.y|0),qb(d.data)&&(b=d.data));g(!a.compressed||b instanceof Uint8Array,"compressed texture data must be stored in a uint8array");
if(d.copy){g(!b,"can not specify copy and data field for the same texture");var e=f.viewportWidth,m=f.viewportHeight;a.width=a.width||e-a.xOffset;a.height=a.height||m-a.yOffset;a.needsCopy=!0;g(0<=a.xOffset&&a.xOffset<e&&0<=a.yOffset&&a.yOffset<m&&0<a.width&&a.width<=e&&0<a.height&&a.height<=m,"copy texture read out of bounds")}else if(!b)a.width=a.width||1,a.height=a.height||1,a.channels=a.channels||4;else if(L(b))a.channels=a.channels||4,a.data=b,"type"in d||5121!==a.type||(a.type=Za[Object.prototype.toString.call(b)]|
0);else if(Gb(b)){a.channels=a.channels||4;e=b;m=e.length;switch(a.type){case 5121:case 5123:case 5125:case 5126:m=T.allocType(a.type,m);m.set(e);a.data=m;break;case 36193:a.data=Eb(e);break;default:g.raise("unsupported texture type, must specify a typed array")}a.alignment=1;a.needsFree=!0}else if(Z(b)){e=b.data;Array.isArray(e)||5121!==a.type||(a.type=Za[Object.prototype.toString.call(e)]|0);var m=b.shape,h=b.stride,k,l,q,P;3===m.length?(q=m[2],P=h[2]):(g(2===m.length,"invalid ndarray pixel data, must be 2 or 3D"),
P=q=1);k=m[0];l=m[1];m=h[0];h=h[1];a.alignment=1;a.width=k;a.height=l;a.channels=q;a.format=a.internalformat=jb[q];a.needsFree=!0;k=P;b=b.offset;q=a.width;P=a.height;l=a.channels;for(var na=T.allocType(36193===a.type?5126:a.type,q*P*l),qa=0,Ga=0;Ga<P;++Ga)for(var Ha=0;Ha<q;++Ha)for(var tb=0;tb<l;++tb)na[qa++]=e[m*Ha+h*Ga+k*tb+b];Ib(a,na)}else if("[object HTMLCanvasElement]"===Na(b)||"[object CanvasRenderingContext2D]"===Na(b))"[object HTMLCanvasElement]"===Na(b)?a.element=b:a.element=b.canvas,a.width=
a.element.width,a.height=a.element.height,a.channels=4;else if("[object HTMLImageElement]"===Na(b))a.element=b,a.width=b.naturalWidth,a.height=b.naturalHeight,a.channels=4;else if("[object HTMLVideoElement]"===Na(b))a.element=b,a.width=b.videoWidth,a.height=b.videoHeight,a.channels=4;else if(Hb(b)){e=a.width||b[0].length;m=a.height||b.length;h=a.channels;h=I(b[0][0])?h||b[0][0].length:h||1;k=kb.shape(b);q=1;for(P=0;P<k.length;++P)q*=k[P];q=T.allocType(36193===a.type?5126:a.type,q);kb.flatten(b,k,
"",q);Ib(a,q);a.alignment=1;a.width=e;a.height=m;a.channels=h;a.format=a.internalformat=jb[h];a.needsFree=!0}5126===a.type?g(0<=c.extensions.indexOf("oes_texture_float"),"oes_texture_float extension not enabled"):36193===a.type&&g(0<=c.extensions.indexOf("oes_texture_half_float"),"oes_texture_half_float extension not enabled")}function u(b,g,c,f,m){var h=b.element,k=b.data,l=b.internalformat,q=b.format,P=b.type,na=b.width,qa=b.height;r(b);h?a.texSubImage2D(g,m,c,f,q,P,h):b.compressed?a.compressedTexSubImage2D(g,
m,c,f,l,na,qa,k):b.needsCopy?(e(),a.copyTexSubImage2D(g,m,c,f,b.xOffset,b.yOffset,na,qa)):a.texSubImage2D(g,m,c,f,na,qa,q,P,k)}function t(){return H.pop()||new R}function nb(a){a.needsFree&&T.freeType(a.data);R.call(a);H.push(a)}function F(){l.call(this);this.genMipmaps=!1;this.mipmapHint=4352;this.mipmask=0;this.images=Array(16)}function O(a,d,b){var g=a.images[0]=t();a.mipmask=1;g.width=a.width=d;g.height=a.height=b;g.channels=a.channels=4}function ea(a,d){var b=null;if(qb(d))b=a.images[0]=t(),
p(b,a),sa(b,d),a.mipmask=1;else if(n(a,d),Array.isArray(d.mipmap))for(var c=d.mipmap,e=0;e<c.length;++e)b=a.images[e]=t(),p(b,a),b.width>>=e,b.height>>=e,sa(b,c[e]),a.mipmask|=1<<e;else b=a.images[0]=t(),p(b,a),sa(b,d),a.mipmask=1;p(a,a.images[0]);(a.compressed&&33776===a.internalformat||33777===a.internalformat||33778===a.internalformat||33779===a.internalformat)&&g(0===a.width%4&&0===a.height%4,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}
function C(b,g){for(var c=b.images,f=0;f<c.length&&c[f];++f){var m=c[f],h=g,k=f,l=m.element,q=m.data,P=m.internalformat,na=m.format,qa=m.type,Ga=m.width,Ha=m.height;r(m);l?a.texImage2D(h,k,na,na,qa,l):m.compressed?a.compressedTexImage2D(h,k,P,Ga,Ha,0,q):m.needsCopy?(e(),a.copyTexImage2D(h,k,na,m.xOffset,m.yOffset,Ga,Ha,0)):a.texImage2D(h,k,na,Ga,Ha,0,na,qa,q)}}function Y(){var a=ha.pop()||new F;l.call(a);for(var d=a.mipmask=0;16>d;++d)a.images[d]=null;return a}function x(a){for(var d=a.images,b=0;b<
d.length;++b)d[b]&&nb(d[b]),d[b]=null;ha.push(a)}function M(){this.magFilter=this.minFilter=9728;this.wrapT=this.wrapS=33071;this.anisotropic=1;this.genMipmaps=!1;this.mipmapHint=4352}function W(a,d){if("min"in d){var b=d.min;g.parameter(b,Da);a.minFilter=Da[b];0<=$b.indexOf(a.minFilter)&&(a.genMipmaps=!0)}"mag"in d&&(b=d.mag,g.parameter(b,cb),a.magFilter=cb[b]);var b=a.wrapS,e=a.wrapT;if("wrap"in d){var m=d.wrap;"string"===typeof m?(g.parameter(m,U),b=e=U[m]):Array.isArray(m)&&(g.parameter(m[0],
U),g.parameter(m[1],U),b=U[m[0]],e=U[m[1]])}else"wrapS"in d&&(b=d.wrapS,g.parameter(b,U),b=U[b]),"wrapT"in d&&(e=d.wrapT,g.parameter(e,U),e=U[e]);a.wrapS=b;a.wrapT=e;"anisotropic"in d&&(b=d.anisotropic,g("number"===typeof b&&1<=b&&b<=c.maxAnisotropic,"aniso samples must be between 1 and "),a.anisotropic=d.anisotropic);if("mipmap"in d){b=!1;switch(typeof d.mipmap){case "string":g.parameter(d.mipmap,D,"invalid mipmap hint");a.mipmapHint=D[d.mipmap];b=a.genMipmaps=!0;break;case "boolean":b=a.genMipmaps=
d.mipmap;break;case "object":g(Array.isArray(d.mipmap),"invalid mipmap type");a.genMipmaps=!1;b=!0;break;default:g.raise("invalid mipmap type")}!b||"min"in d||(a.minFilter=9984)}}function y(g,c){a.texParameteri(c,10241,g.minFilter);a.texParameteri(c,10240,g.magFilter);a.texParameteri(c,10242,g.wrapS);a.texParameteri(c,10243,g.wrapT);b.ext_texture_filter_anisotropic&&a.texParameteri(c,34046,g.anisotropic);g.genMipmaps&&(a.hint(33170,g.mipmapHint),a.generateMipmap(c))}function pb(b){l.call(this);this.mipmask=
0;this.internalformat=6408;this.id=ac++;this.refCount=1;this.target=b;this.texture=a.createTexture();this.unit=-1;this.bindCount=0;this.texInfo=new M;k.profile&&(this.stats={size:0})}function Pa(b){a.activeTexture(33984);a.bindTexture(b.target,b.texture)}function Qa(){var b=ua[0];b?a.bindTexture(b.target,b.texture):a.bindTexture(3553,null)}function B(b){var c=b.texture;g(c,"must not double destroy texture");var e=b.unit,m=b.target;0<=e&&(a.activeTexture(33984+e),a.bindTexture(m,null),ua[e]=null);
a.deleteTexture(c);b.texture=null;b.params=null;b.pixels=null;b.refCount=0;delete ba[b.id];h.textureCount--}var D={"don't care":4352,"dont care":4352,nice:4354,fast:4353},U={repeat:10497,clamp:33071,mirror:33648},cb={nearest:9728,linear:9729},Da=S({mipmap:9987,"nearest mipmap nearest":9984,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":9987},cb),Jb={none:0,browser:37444},V={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},J={alpha:6406,luminance:6409,"luminance alpha":6410,
rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},v={};b.ext_srgb&&(J.srgb=35904,J.srgba=35906);b.oes_texture_float&&(V.float32=V["float"]=5126);b.oes_texture_half_float&&(V.float16=V["half float"]=36193);b.webgl_depth_texture&&(S(J,{depth:6402,"depth stencil":34041}),S(V,{uint16:5123,uint32:5125,"depth stencil":34042}));b.webgl_compressed_texture_s3tc&&S(v,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779});b.webgl_compressed_texture_atc&&S(v,
{"rgb atc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798});b.webgl_compressed_texture_pvrtc&&S(v,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,"rgba pvrtc 2bppv1":35843});b.webgl_compressed_texture_etc1&&(v["rgb etc1"]=36196);var ia=Array.prototype.slice.call(a.getParameter(34467));Object.keys(v).forEach(function(a){var d=v[a];0<=ia.indexOf(d)&&(J[a]=d)});var wa=Object.keys(J);c.textureFormats=wa;var Ra=[];Object.keys(J).forEach(function(a){Ra[J[a]]=
a});var A=[];Object.keys(V).forEach(function(a){A[V[a]]=a});var db=[];Object.keys(cb).forEach(function(a){db[cb[a]]=a});var Ia=[];Object.keys(Da).forEach(function(a){Ia[Da[a]]=a});var Ja=[];Object.keys(U).forEach(function(a){Ja[U[a]]=a});var sb=wa.reduce(function(a,d){var b=J[d];6409===b||6406===b||6409===b||6410===b||6402===b||34041===b?a[b]=b:32855===b||0<=d.indexOf("rgba")?a[b]=6408:a[b]=6407;return a},{}),H=[],ha=[],ac=0,ba={},E=c.maxTextureUnits,ua=Array(E).map(function(){return null});S(pb.prototype,
{bind:function(){this.bindCount+=1;var b=this.unit;if(0>b){for(var c=0;c<E;++c){var e=ua[c];if(e){if(0<e.bindCount)continue;e.unit=-1}ua[c]=this;b=c;break}b>=E&&g.raise("insufficient number of texture units");k.profile&&h.maxTextureUnits<b+1&&(h.maxTextureUnits=b+1);this.unit=b;a.activeTexture(33984+b);a.bindTexture(this.target,this.texture)}return b},unbind:function(){--this.bindCount},decRef:function(){0>=--this.refCount&&B(this)}});k.profile&&(h.getTotalTextureSize=function(){var a=0;Object.keys(ba).forEach(function(b){a+=
ba[b].stats.size});return a});return{create2D:function(b,e){function m(a,b){var d=f.texInfo;M.call(d);var e=Y();"number"===typeof a?"number"===typeof b?O(e,a|0,b|0):O(e,a|0,a|0):a?(g.type(a,"object","invalid arguments to regl.texture"),W(d,a),ea(e,a)):O(e,1,1);d.genMipmaps&&(e.mipmask=(e.width<<1)-1);f.mipmask=e.mipmask;p(f,e);g.texture2D(d,e,c);f.internalformat=e.internalformat;m.width=e.width;m.height=e.height;Pa(f);C(e,3553);y(d,3553);Qa();x(e);k.profile&&(f.stats.size=ib(f.internalformat,f.type,
e.width,e.height,d.genMipmaps,!1));m.format=Ra[f.internalformat];m.type=A[f.type];m.mag=db[d.magFilter];m.min=Ia[d.minFilter];m.wrapS=Ja[d.wrapS];m.wrapT=Ja[d.wrapT];return m}var f=new pb(3553);ba[f.id]=f;h.textureCount++;m(b,e);m.subimage=function(a,d,b,c){g(!!a,"must specify image data");d|=0;b|=0;c|=0;var q=t();p(q,f);q.width=0;q.height=0;sa(q,a);q.width=q.width||(f.width>>c)-d;q.height=q.height||(f.height>>c)-b;g(f.type===q.type&&f.format===q.format&&f.internalformat===q.internalformat,"incompatible format for texture.subimage");
g(0<=d&&0<=b&&d+q.width<=f.width&&b+q.height<=f.height,"texture.subimage write out of bounds");g(f.mipmask&1<<c,"missing mipmap data");g(q.data||q.element||q.needsCopy,"missing image data");Pa(f);u(q,3553,d,b,c);Qa();nb(q);return m};m.resize=function(b,g){var c=b|0,e=g|0||c;if(c===f.width&&e===f.height)return m;m.width=f.width=c;m.height=f.height=e;Pa(f);for(var q=0;f.mipmask>>q;++q)a.texImage2D(3553,q,f.format,c>>q,e>>q,0,f.format,f.type,null);Qa();k.profile&&(f.stats.size=ib(f.internalformat,f.type,
c,e,!1,!1));return m};m._reglType="texture2d";m._texture=f;k.profile&&(m.stats=f.stats);m.destroy=function(){f.decRef()};return m},createCube:function(b,e,f,m,l,z){function D(a,b,d,e,f,m){var K,ga=B.texInfo;M.call(ga);for(K=0;6>K;++K)q[K]=Y();if("number"!==typeof a&&a)if("object"===typeof a)if(b)ea(q[0],a),ea(q[1],b),ea(q[2],d),ea(q[3],e),ea(q[4],f),ea(q[5],m);else if(W(ga,a),n(B,a),"faces"in a)for(a=a.faces,g(Array.isArray(a)&&6===a.length,"cube faces must be a length 6 array"),K=0;6>K;++K)g("object"===
typeof a[K]&&!!a[K],"invalid input for cube map face"),p(q[K],B),ea(q[K],a[K]);else for(K=0;6>K;++K)ea(q[K],a);else g.raise("invalid arguments to cube map");else for(a=a|0||1,K=0;6>K;++K)O(q[K],a,a);p(B,q[0]);B.mipmask=ga.genMipmaps?(q[0].width<<1)-1:q[0].mipmask;g.textureCube(B,ga,q,c);B.internalformat=q[0].internalformat;D.width=q[0].width;D.height=q[0].height;Pa(B);for(K=0;6>K;++K)C(q[K],34069+K);y(ga,34067);Qa();k.profile&&(B.stats.size=ib(B.internalformat,B.type,D.width,D.height,ga.genMipmaps,
!0));D.format=Ra[B.internalformat];D.type=A[B.type];D.mag=db[ga.magFilter];D.min=Ia[ga.minFilter];D.wrapS=Ja[ga.wrapS];D.wrapT=Ja[ga.wrapT];for(K=0;6>K;++K)x(q[K]);return D}var B=new pb(34067);ba[B.id]=B;h.cubeCount++;var q=Array(6);D(b,e,f,m,l,z);D.subimage=function(a,b,d,c,q){g(!!b,"must specify image data");g("number"===typeof a&&a===(a|0)&&0<=a&&6>a,"invalid face");d|=0;c|=0;q|=0;var e=t();p(e,B);e.width=0;e.height=0;sa(e,b);e.width=e.width||(B.width>>q)-d;e.height=e.height||(B.height>>q)-c;g(B.type===
e.type&&B.format===e.format&&B.internalformat===e.internalformat,"incompatible format for texture.subimage");g(0<=d&&0<=c&&d+e.width<=B.width&&c+e.height<=B.height,"texture.subimage write out of bounds");g(B.mipmask&1<<q,"missing mipmap data");g(e.data||e.element||e.needsCopy,"missing image data");Pa(B);u(e,34069+a,d,c,q);Qa();nb(e);return D};D.resize=function(b){b|=0;if(b!==B.width){D.width=B.width=b;D.height=B.height=b;Pa(B);for(var g=0;6>g;++g)for(var c=0;B.mipmask>>c;++c)a.texImage2D(34069+g,
c,B.format,b>>c,b>>c,0,B.format,B.type,null);Qa();k.profile&&(B.stats.size=ib(B.internalformat,B.type,D.width,D.height,!1,!0));return D}};D._reglType="textureCube";D._texture=B;k.profile&&(D.stats=B.stats);D.destroy=function(){B.decRef()};return D},clear:function(){for(var b=0;b<E;++b)a.activeTexture(33984+b),a.bindTexture(3553,null),ua[b]=null;fa(ba).forEach(B);h.cubeCount=0;h.textureCount=0},getTexture:function(a){return null},restore:function(){fa(ba).forEach(function(b){b.texture=a.createTexture();
a.bindTexture(b.target,b.texture);for(var c=0;32>c;++c)if(0!==(b.mipmask&1<<c))if(3553===b.target)a.texImage2D(3553,c,b.internalformat,b.width>>c,b.height>>c,0,b.internalformat,b.type,null);else for(var g=0;6>g;++g)a.texImage2D(34069+g,c,b.internalformat,b.width>>c,b.height>>c,0,b.internalformat,b.type,null);y(b.texInfo,b.target)})}}}function bc(a,b,c,e,f,h){function k(a,b,d){this.target=a;this.texture=b;this.renderbuffer=d;var c=a=0;b?(a=b.width,c=b.height):d&&(a=d.width,c=d.height);this.width=a;
this.height=c}function l(a){a&&(a.texture&&a.texture._texture.decRef(),a.renderbuffer&&a.renderbuffer._renderbuffer.decRef())}function p(a,b,d){if(a){if(a.texture){a=a.texture._texture;var c=Math.max(1,a.height);g(Math.max(1,a.width)===b&&c===d,"inconsistent width/height for supplied texture")}else a=a.renderbuffer._renderbuffer,g(a.width===b&&a.height===d,"inconsistent width/height for renderbuffer");a.refCount+=1}}function n(b,c){c&&(c.texture?a.framebufferTexture2D(36160,b,c.target,c.texture._texture.texture,
0):a.framebufferRenderbuffer(36160,b,36161,c.renderbuffer._renderbuffer.renderbuffer))}function r(a){var b=3553,d=null,c=null,e=a;"object"===typeof a&&(e=a.data,"target"in a&&(b=a.target|0));g.type(e,"function","invalid attachment data");a=e._reglType;"texture2d"===a?(d=e,g(3553===b)):"textureCube"===a?(d=e,g(34069<=b&&34075>b,"invalid cube map target")):"renderbuffer"===a?(c=e,b=36161):g.raise("invalid regl object for attachment");return new k(b,d,c)}function R(a,b,d,c,g){if(d)return a=e.create2D({width:a,
height:b,format:c,type:g}),a._texture.refCount=0,new k(3553,a,null);a=f.create({width:a,height:b,format:c});a._renderbuffer.refCount=0;return new k(36161,null,a)}function sa(a){return a&&(a.texture||a.renderbuffer)}function u(a,b,d){a&&(a.texture?a.texture.resize(b,d):a.renderbuffer&&a.renderbuffer.resize(b,d))}function t(){this.id=W++;v[this.id]=this;this.framebuffer=a.createFramebuffer();this.height=this.width=0;this.colorAttachments=[];this.depthStencilAttachment=this.stencilAttachment=this.depthAttachment=
null}function C(a){a.colorAttachments.forEach(l);l(a.depthAttachment);l(a.stencilAttachment);l(a.depthStencilAttachment)}function F(b){var c=b.framebuffer;g(c,"must not double destroy framebuffer");a.deleteFramebuffer(c);b.framebuffer=null;h.framebufferCount--;delete v[b.id]}function O(b){var e;a.bindFramebuffer(36160,b.framebuffer);var f=b.colorAttachments;for(e=0;e<f.length;++e)n(36064+e,f[e]);for(e=f.length;e<c.maxColorAttachments;++e)a.framebufferTexture2D(36160,36064+e,3553,null,0);a.framebufferTexture2D(36160,
33306,3553,null,0);a.framebufferTexture2D(36160,36096,3553,null,0);a.framebufferTexture2D(36160,36128,3553,null,0);n(36096,b.depthAttachment);n(36128,b.stencilAttachment);n(33306,b.depthStencilAttachment);b=a.checkFramebufferStatus(36160);36053!==b&&g.raise("framebuffer configuration not supported, status = "+cc[b]);a.bindFramebuffer(36160,Y.next);Y.cur=Y.next;a.getError()}function ea(a,d){function e(a,d){var h;g(Y.next!==f,"can not update framebuffer which is currently in use");var k=b.webgl_draw_buffers,
l=0,t=0,z=!0,n=!0;h=null;var u=!0,Q="rgba",pa="uint8",ea=1,Wa=null,F=null,eb=null,W=!1;if("number"===typeof a)l=a|0,t=d|0||l;else if(a){g.type(a,"object","invalid arguments for framebuffer");"shape"in a?(t=a.shape,g(Array.isArray(t)&&2<=t.length,"invalid shape for framebuffer"),l=t[0],t=t[1]):("radius"in a&&(l=t=a.radius),"width"in a&&(l=a.width),"height"in a&&(t=a.height));if("color"in a||"colors"in a)h=a.color||a.colors,Array.isArray(h)&&g(1===h.length||k,"multiple render targets not supported");
if(!h){"colorCount"in a&&(ea=a.colorCount|0,g(0<ea,"invalid color buffer count"));"colorTexture"in a&&(u=!!a.colorTexture,Q="rgba4");if("colorType"in a){pa=a.colorType;if(u)g(b.oes_texture_float||!("float"===pa||"float32"===pa),"you must enable OES_texture_float in order to use floating point framebuffer objects"),g(b.oes_texture_half_float||!("half float"===pa||"float16"===pa),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects");else if("half float"===
pa||"float16"===pa)g(b.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),Q="rgba16f";else if("float"===pa||"float32"===pa)g(b.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),Q="rgba32f";g.oneOf(pa,y,"invalid color type")}if("colorFormat"in a)if(Q=a.colorFormat,0<=x.indexOf(Q))u=!0;else if(0<=M.indexOf(Q))u=!1;else if(u)g.oneOf(a.colorFormat,x,"invalid color format for texture");
else g.oneOf(a.colorFormat,M,"invalid color format for renderbuffer")}if("depthTexture"in a||"depthStencilTexture"in a)W=!(!a.depthTexture&&!a.depthStencilTexture),g(!W||b.webgl_depth_texture,"webgl_depth_texture extension not supported");"depth"in a&&("boolean"===typeof a.depth?z=a.depth:(Wa=a.depth,n=!1));"stencil"in a&&("boolean"===typeof a.stencil?n=a.stencil:(F=a.stencil,z=!1));"depthStencil"in a&&("boolean"===typeof a.depthStencil?z=n=a.depthStencil:(eb=a.depthStencil,n=z=!1))}else l=t=1;var v=
k=null,xa=null,A=null;if(Array.isArray(h))k=h.map(r);else if(h)k=[r(h)];else for(k=Array(ea),h=0;h<ea;++h)k[h]=R(l,t,u,Q,pa);g(b.webgl_draw_buffers||1>=k.length,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers.");g(k.length<=c.maxColorAttachments,"too many color attachments, not supported");l=l||k[0].width;t=t||k[0].height;Wa?v=r(Wa):z&&!n&&(v=R(l,t,W,"depth","uint32"));F?xa=r(F):n&&!z&&(xa=R(l,t,!1,"stencil","uint8"));eb?A=r(eb):!Wa&&!F&&n&&z&&(A=R(l,t,W,"depth stencil",
"depth stencil"));g(1>=!!Wa+!!F+!!eb,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");z=null;for(h=0;h<k.length;++h)p(k[h],l,t),g(!k[h]||k[h].texture&&0<=dc.indexOf(k[h].texture._texture.format)||k[h].renderbuffer&&0<=ec.indexOf(k[h].renderbuffer._renderbuffer.format),"framebuffer color attachment "+h+" is invalid"),k[h]&&k[h].texture&&(n=Kb[k[h].texture._texture.format]*lb[k[h].texture._texture.type],null===z?z=n:g(z===n,"all color attachments much have the same number of bits per pixel."));
p(v,l,t);g(!v||v.texture&&6402===v.texture._texture.format||v.renderbuffer&&33189===v.renderbuffer._renderbuffer.format,"invalid depth attachment for framebuffer object");p(xa,l,t);g(!xa||xa.renderbuffer&&36168===xa.renderbuffer._renderbuffer.format,"invalid stencil attachment for framebuffer object");p(A,l,t);g(!A||A.texture&&34041===A.texture._texture.format||A.renderbuffer&&34041===A.renderbuffer._renderbuffer.format,"invalid depth-stencil attachment for framebuffer object");C(f);f.width=l;f.height=
t;f.colorAttachments=k;f.depthAttachment=v;f.stencilAttachment=xa;f.depthStencilAttachment=A;e.color=k.map(sa);e.depth=sa(v);e.stencil=sa(xa);e.depthStencil=sa(A);e.width=f.width;e.height=f.height;O(f);return e}var f=new t;h.framebufferCount++;e(a,d);return S(e,{resize:function(a,b){g(Y.next!==f,"can not resize a framebuffer which is currently in use");var d=a|0,c=b|0||d;if(d===f.width&&c===f.height)return e;for(var m=f.colorAttachments,h=0;h<m.length;++h)u(m[h],d,c);u(f.depthAttachment,d,c);u(f.stencilAttachment,
d,c);u(f.depthStencilAttachment,d,c);f.width=e.width=d;f.height=e.height=c;O(f);return e},_reglType:"framebuffer",_framebuffer:f,destroy:function(){F(f);C(f)},use:function(a){Y.setFBO({framebuffer:e},a)}})}var Y={cur:null,next:null,dirty:!1,setFBO:null},x=["rgba"],M=["rgba4","rgb565","rgb5 a1"];b.ext_srgb&&M.push("srgba");b.ext_color_buffer_half_float&&M.push("rgba16f","rgb16f");b.webgl_color_buffer_float&&M.push("rgba32f");var y=["uint8"];b.oes_texture_half_float&&y.push("half float","float16");
b.oes_texture_float&&y.push("float","float32");var W=0,v={};return S(Y,{getFramebuffer:function(a){return"function"===typeof a&&"framebuffer"===a._reglType&&(a=a._framebuffer,a instanceof t)?a:null},create:ea,createCube:function(a){function d(a){var c;g(0>f.indexOf(Y.next),"can not update framebuffer which is currently in use");var h=b.webgl_draw_buffers,k={color:null},l=0,t=null;c="rgba";var p="uint8",w=1;if("number"===typeof a)l=a|0;else if(a){g.type(a,"object","invalid arguments for framebuffer");
"shape"in a?(l=a.shape,g(Array.isArray(l)&&2<=l.length,"invalid shape for framebuffer"),g(l[0]===l[1],"cube framebuffer must be square"),l=l[0]):("radius"in a&&(l=a.radius|0),"width"in a?(l=a.width|0,"height"in a&&g(a.height===l,"must be square")):"height"in a&&(l=a.height|0));if("color"in a||"colors"in a)t=a.color||a.colors,Array.isArray(t)&&g(1===t.length||h,"multiple render targets not supported");t||("colorCount"in a&&(w=a.colorCount|0,g(0<w,"invalid color buffer count")),"colorType"in a&&(g.oneOf(a.colorType,
y,"invalid color type"),p=a.colorType),"colorFormat"in a&&(c=a.colorFormat,g.oneOf(a.colorFormat,x,"invalid color format for texture")));"depth"in a&&(k.depth=a.depth);"stencil"in a&&(k.stencil=a.stencil);"depthStencil"in a&&(k.depthStencil=a.depthStencil)}else l=1;if(t)if(Array.isArray(t))for(a=[],c=0;c<t.length;++c)a[c]=t[c];else a=[t];else for(a=Array(w),t={radius:l,format:c,type:p},c=0;c<w;++c)a[c]=e.createCube(t);k.color=Array(a.length);for(c=0;c<a.length;++c)w=a[c],g("function"===typeof w&&
"textureCube"===w._reglType,"invalid cube map"),l=l||w.width,g(w.width===l&&w.height===l,"invalid cube map shape"),k.color[c]={target:34069,data:a[c]};for(c=0;6>c;++c){for(w=0;w<a.length;++w)k.color[w].target=34069+c;0<c&&(k.depth=f[0].depth,k.stencil=f[0].stencil,k.depthStencil=f[0].depthStencil);if(f[c])f[c](k);else f[c]=ea(k)}return S(d,{width:l,height:l,color:a})}var f=Array(6);d(a);return S(d,{faces:f,resize:function(a){var b=a|0;g(0<b&&b<=c.maxCubeMapSize,"invalid radius for cube fbo");if(b===
d.width)return d;var e=d.color;for(a=0;a<e.length;++a)e[a].resize(b);for(a=0;6>a;++a)f[a].resize(b);d.width=d.height=b;return d},_reglType:"framebufferCube",destroy:function(){f.forEach(function(a){a.destroy()})}})},clear:function(){fa(v).forEach(F)},restore:function(){fa(v).forEach(function(b){b.framebuffer=a.createFramebuffer();O(b)})}})}function Lb(){this.w=this.z=this.y=this.x=this.state=0;this.buffer=null;this.size=0;this.normalized=!1;this.type=5126;this.divisor=this.stride=this.offset=0}function fc(a,
b,c,e,g){a=c.maxAttributes;b=Array(a);for(c=0;c<a;++c)b[c]=new Lb;return{Record:Lb,scope:{},state:b}}function gc(a,b,c,e){function f(a,b,d,c){this.name=a;this.id=b;this.location=d;this.info=c}function h(a,b){for(var d=0;d<a.length;++d)if(a[d].id===b.id){a[d].location=b.location;return}a.push(b)}function k(c,e,f){var h=35632===c?n:r,l=h[e];if(!l){var p=b.str(e),l=a.createShader(c);a.shaderSource(l,p);a.compileShader(l);g.shaderError(a,l,p,c,f);h[e]=l}return l}function l(a,b){this.id=u++;this.fragId=
a;this.vertId=b;this.program=null;this.uniforms=[];this.attributes=[];e.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function p(c,l){var w,n;w=k(35632,c.fragId);n=k(35633,c.vertId);var r=c.program=a.createProgram();a.attachShader(r,w);a.attachShader(r,n);a.linkProgram(r);g.linkError(a,r,b.str(c.fragId),b.str(c.vertId),l);var G=a.getProgramParameter(r,35718);e.profile&&(c.stats.uniformsCount=G);var u=c.uniforms;for(w=0;w<G;++w)if(n=a.getActiveUniform(r,w))if(1<n.size)for(var R=0;R<n.size;++R){var Q=
n.name.replace("[0]","["+R+"]");h(u,new f(Q,b.id(Q),a.getUniformLocation(r,Q),n))}else h(u,new f(n.name,b.id(n.name),a.getUniformLocation(r,n.name),n));G=a.getProgramParameter(r,35721);e.profile&&(c.stats.attributesCount=G);u=c.attributes;for(w=0;w<G;++w)(n=a.getActiveAttrib(r,w))&&h(u,new f(n.name,b.id(n.name),a.getAttribLocation(r,n.name),n))}var n={},r={},R={},C=[],u=0;e.profile&&(c.getMaxUniformsCount=function(){var a=0;C.forEach(function(b){b.stats.uniformsCount>a&&(a=b.stats.uniformsCount)});
return a},c.getMaxAttributesCount=function(){var a=0;C.forEach(function(b){b.stats.attributesCount>a&&(a=b.stats.attributesCount)});return a});return{clear:function(){var b=a.deleteShader.bind(a);fa(n).forEach(b);n={};fa(r).forEach(b);r={};C.forEach(function(b){a.deleteProgram(b.program)});C.length=0;R={};c.shaderCount=0},program:function(a,b,d){g.command(0<=a,"missing vertex shader",d);g.command(0<=b,"missing fragment shader",d);var e=R[b];e||(e=R[b]={});var f=e[a];f||(f=new l(b,a),c.shaderCount++,
p(f,d),e[a]=f,C.push(f));return f},restore:function(){n={};r={};for(var a=0;a<C.length;++a)p(C[a])},shader:k,frag:-1,vert:-1}}function hc(a,b,c,e,f,h){function k(l){var p;null===b.next?(g(f.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),p=5121):(g(null!==b.next.colorAttachments[0].texture,"You cannot read from a renderbuffer"),p=b.next.colorAttachments[0].texture._texture.type,h.oes_texture_float?g(5121===
p||5126===p,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"):g(5121===p,"Reading from a framebuffer is only allowed for the type 'uint8'"));var n=0,r=0,Q=e.framebufferWidth,u=e.framebufferHeight,t=null;L(l)?t=l:l&&(g.type(l,"object","invalid arguments to regl.read()"),n=l.x|0,r=l.y|0,g(0<=n&&n<e.framebufferWidth,"invalid x offset for regl.read"),g(0<=r&&r<e.framebufferHeight,"invalid y offset for regl.read"),Q=(l.width||e.framebufferWidth-n)|0,u=(l.height||e.framebufferHeight-
r)|0,t=l.data||null);t&&(5121===p?g(t instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):5126===p&&g(t instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'"));g(0<Q&&Q+n<=e.framebufferWidth,"invalid width for read pixels");g(0<u&&u+r<=e.framebufferHeight,"invalid height for read pixels");c();l=Q*u*4;t||(5121===p?t=new Uint8Array(l):5126===p&&(t=t||new Float32Array(l)));g.isTypedArray(t,"data buffer for regl.read() must be a typedarray");
g(t.byteLength>=l,"data buffer for regl.read() too small");a.pixelStorei(3333,4);a.readPixels(n,r,Q,u,6408,p,t);return t}function l(a){var d;b.setFBO({framebuffer:a.framebuffer},function(){d=k(a)});return d}return function(a){return a&&"framebuffer"in a?l(a):k(a)}}function Sa(a){return Array.prototype.slice.call(a)}function Ta(a){return Sa(a).join("")}function ic(){function a(){var b=[],d=[];return S(function(){b.push.apply(b,Sa(arguments))},{def:function(){var a="v"+c++;d.push(a);0<arguments.length&&
(b.push(a,"="),b.push.apply(b,Sa(arguments)),b.push(";"));return a},toString:function(){return Ta([0<d.length?"var "+d+";":"",Ta(b)])}})}function b(){function c(a,b){f(a,b,"=",e.def(a,b),";")}var e=a(),f=a(),g=e.toString,m=f.toString;return S(function(){e.apply(e,Sa(arguments))},{def:e.def,entry:e,exit:f,save:c,set:function(a,b,d){c(a,b);e(a,b,"=",d,";")},toString:function(){return g()+m()}})}var c=0,e=[],f=[],g=a(),h={};return{global:g,link:function(a){for(var b=0;b<f.length;++b)if(f[b]===a)return e[b];
b="g"+c++;e.push(b);f.push(a);return b},block:a,proc:function(a,d){function c(){var a="a"+e.length;e.push(a);return a}var e=[];d=d||0;for(var f=0;f<d;++f)c();var f=b(),g=f.toString;return h[a]=S(f,{arg:c,toString:function(){return Ta(["function(",e.join(),"){",g(),"}"])}})},scope:b,cond:function(){var a=Ta(arguments),d=b(),c=b(),e=d.toString,f=c.toString;return S(d,{then:function(){d.apply(d,Sa(arguments));return this},"else":function(){c.apply(c,Sa(arguments));return this},toString:function(){var b=
f();b&&(b="else{"+b+"}");return Ta(["if(",a,"){",e(),"}",b])}})},compile:function(){var a=['"use strict";',g,"return {"];Object.keys(h).forEach(function(b){a.push('"',b,'":',h[b].toString(),",")});a.push("}");var b=Ta(a).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,e.concat(b)).apply(null,f)}}}function mb(a){return Array.isArray(a)||L(a)||Z(a)}function Mb(a){return a.sort(function(a,b){return"viewport"===a?-1:"viewport"===b?1:a<b?-1:1})}function oa(a,b,c,
e){this.thisDep=a;this.contextDep=b;this.propDep=c;this.append=e}function Ea(a){return a&&!(a.thisDep||a.contextDep||a.propDep)}function H(a){return new oa(!1,!1,!1,a)}function ma(a,b){var c=a.type;return 0===c?(c=a.data.length,new oa(!0,1<=c,2<=c,b)):4===c?(c=a.data,new oa(c.thisDep,c.contextDep,c.propDep,b)):new oa(3===c,2===c,1===c,b)}function jc(a,b,c,e,f,h,k,l,p,n,r,C,Y,u,t){function v(a){return a.replace(".","_")}function M(a,b,d){var c=v(a);bb.push(a);ab[c]=Aa[c]=!!d;Ba[c]=b}function O(a,b,
d){var c=v(a);bb.push(a);Array.isArray(d)?(Aa[c]=d.slice(),ab[c]=d.slice()):Aa[c]=ab[c]=d;Ca[c]=b}function x(){var a=ic(),d=a.link,c=a.global;a.id=ta++;a.batchId="0";var e=d(rb),f=a.shared={props:"a0"};Object.keys(rb).forEach(function(a){f[a]=c.def(e,".",a)});g.optional(function(){a.CHECK=d(g);a.commandStr=g.guessCommand();a.command=d(a.commandStr);a.assert=function(a,b,c){a("if(!(",b,"))",this.CHECK,".commandRaise(",d(c),",",this.command,");")};X.invalidBlendCombinations=Ob});var h=a.next={},k=a.current=
{};Object.keys(Ca).forEach(function(a){Array.isArray(Aa[a])&&(h[a]=c.def(f.next,".",a),k[a]=c.def(f.current,".",a))});var l=a.constants={};Object.keys(X).forEach(function(a){l[a]=c.def(JSON.stringify(X[a]))});a.invoke=function(b,c){switch(c.type){case 0:var e=["this",f.context,f.props,a.batchId];return b.def(d(c.data),".call(",e.slice(0,Math.max(c.data.length+1,4)),")");case 1:return b.def(f.props,c.data);case 2:return b.def(f.context,c.data);case 3:return b.def("this",c.data);case 4:return c.data.append(a,
b),c.data.ref}};a.attribCache={};var ga={};a.scopeAttrib=function(a){a=b.id(a);if(a in ga)return ga[a];var c=n.scope[a];c||(c=n.scope[a]=new Z);return ga[a]=d(c)};return a}function W(a){var b=a["static"];a=a.dynamic;var d;if("profile"in b){var c=!!b.profile;d=H(function(a,b){return c});d.enable=c}else if("profile"in a){var e=a.profile;d=ma(e,function(a,b){return a.invoke(b,e)})}return d}function y(a,b){var d=a["static"],c=a.dynamic;if("framebuffer"in d){var e=d.framebuffer;return e?(e=l.getFramebuffer(e),
g.command(e,"invalid framebuffer object"),H(function(a,b){var d=a.link(e),c=a.shared;b.set(c.framebuffer,".next",d);c=c.context;b.set(c,".framebufferWidth",d+".width");b.set(c,".framebufferHeight",d+".height");return d})):H(function(a,b){var d=a.shared;b.set(d.framebuffer,".next","null");d=d.context;b.set(d,".framebufferWidth",d+".drawingBufferWidth");b.set(d,".framebufferHeight",d+".drawingBufferHeight");return"null"})}if("framebuffer"in c){var f=c.framebuffer;return ma(f,function(a,b){var d=a.invoke(b,
f),c=a.shared,e=c.framebuffer,q=b.def(e,".getFramebuffer(",d,")");g.optional(function(){a.assert(b,"!"+d+"||"+q,"invalid framebuffer object")});b.set(e,".next",q);c=c.context;b.set(c,".framebufferWidth",q+"?"+q+".width:"+c+".drawingBufferWidth");b.set(c,".framebufferHeight",q+"?"+q+".height:"+c+".drawingBufferHeight");return q})}return null}function A(a,b,d){function c(a){if(a in e){var q=e[a];g.commandType(q,"object","invalid "+a,d.commandStr);var h=!0,Nb=q.x|0,k=q.y|0,m,l;"width"in q?(m=q.width|
0,g.command(0<=m,"invalid "+a,d.commandStr)):h=!1;"height"in q?(l=q.height|0,g.command(0<=l,"invalid "+a,d.commandStr)):h=!1;return new oa(!h&&b&&b.thisDep,!h&&b&&b.contextDep,!h&&b&&b.propDep,function(a,b){var d=a.shared.context,c=m;"width"in q||(c=b.def(d,".","framebufferWidth","-",Nb));var e=l;"height"in q||(e=b.def(d,".","framebufferHeight","-",k));return[Nb,k,c,e]})}if(a in f){var p=f[a],h=ma(p,function(b,d){var c=b.invoke(d,p);g.optional(function(){b.assert(d,c+"&&typeof "+c+'==="object"',"invalid "+
a)});var e=b.shared.context,f=d.def(c,".x|0"),q=d.def(c,".y|0"),ga=d.def('"width" in ',c,"?",c,".width|0:","(",e,".","framebufferWidth","-",f,")"),h=d.def('"height" in ',c,"?",c,".height|0:","(",e,".","framebufferHeight","-",q,")");g.optional(function(){b.assert(d,ga+">=0&&"+h+">=0","invalid "+a)});return[f,q,ga,h]});b&&(h.thisDep=h.thisDep||b.thisDep,h.contextDep=h.contextDep||b.contextDep,h.propDep=h.propDep||b.propDep);return h}return b?new oa(b.thisDep,b.contextDep,b.propDep,function(a,b){var d=
a.shared.context;return[0,0,b.def(d,".","framebufferWidth"),b.def(d,".","framebufferHeight")]}):null}var e=a["static"],f=a.dynamic;if(a=c("viewport")){var h=a;a=new oa(a.thisDep,a.contextDep,a.propDep,function(a,b){var d=h.append(a,b),c=a.shared.context;b.set(c,".viewportWidth",d[2]);b.set(c,".viewportHeight",d[3]);return d})}return{viewport:a,scissor_box:c("scissor.box")}}function wa(a){function d(a){if(a in c){var f=b.id(c[a]);g.optional(function(){r.shader(Pb[a],f,g.guessCommand())});var q=H(function(){return f});
q.id=f;return q}if(a in e){var h=e[a];return ma(h,function(b,d){var c=b.invoke(d,h),e=d.def(b.shared.strings,".id(",c,")");g.optional(function(){d(b.shared.shader,".shader(",Pb[a],",",e,",",b.command,");")});return e})}return null}var c=a["static"],e=a.dynamic,f=d("frag"),h=d("vert"),k=null;Ea(f)&&Ea(h)?(k=r.program(h.id,f.id),a=H(function(a,b){return a.link(k)})):a=new oa(f&&f.thisDep||h&&h.thisDep,f&&f.contextDep||h&&h.contextDep,f&&f.propDep||h&&h.propDep,function(a,b){var d=a.shared.shader,c;
c=f?f.append(a,b):b.def(d,".","frag");var e;e=h?h.append(a,b):b.def(d,".","vert");var q=d+".program("+e+","+c;g.optional(function(){q+=","+a.command});return b.def(q+")")});return{frag:f,vert:h,progVar:a,program:k}}function ia(a,b){function d(a,q){if(a in c){var h=c[a]|0;g.command(!q||0<=h,"invalid "+a,b.commandStr);return H(function(a,b){q&&(a.OFFSET=h);return h})}if(a in e){var k=e[a];return ma(k,function(b,d){var c=b.invoke(d,k);q&&(b.OFFSET=c,g.optional(function(){b.assert(d,c+">=0","invalid "+
a)}));return c})}return q&&f?H(function(a,b){a.OFFSET="0";return 0}):null}var c=a["static"],e=a.dynamic,f=function(){if("elements"in c){var a=c.elements;mb(a)?a=h.getElements(h.create(a,!0)):a&&(a=h.getElements(a),g.command(a,"invalid elements",b.commandStr));var d=H(function(b,d){if(a){var c=b.link(a);return b.ELEMENTS=c}return b.ELEMENTS=null});d.value=a;return d}if("elements"in e){var f=e.elements;return ma(f,function(a,b){var d=a.shared,c=d.isBufferArgs,d=d.elements,e=a.invoke(b,f),q=b.def("null"),
c=b.def(c,"(",e,")"),h=a.cond(c).then(q,"=",d,".createStream(",e,");")["else"](q,"=",d,".getElements(",e,");");g.optional(function(){a.assert(h["else"],"!"+e+"||"+q,"invalid elements")});b.entry(h);b.exit(a.cond(c).then(d,".destroyStream(",q,");"));return a.ELEMENTS=q})}return null}(),k=d("offset",!0);return{elements:f,primitive:function(){if("primitive"in c){var a=c.primitive;g.commandParameter(a,Ma,"invalid primitve",b.commandStr);return H(function(b,d){return Ma[a]})}if("primitive"in e){var d=
e.primitive;return ma(d,function(a,b){var c=a.constants.primTypes,e=a.invoke(b,d);g.optional(function(){a.assert(b,e+" in "+c,"invalid primitive, must be one of "+Object.keys(Ma))});return b.def(c,"[",e,"]")})}return f?Ea(f)?f.value?H(function(a,b){return b.def(a.ELEMENTS,".primType")}):H(function(){return 4}):new oa(f.thisDep,f.contextDep,f.propDep,function(a,b){var d=a.ELEMENTS;return b.def(d,"?",d,".primType:",4)}):null}(),count:function(){if("count"in c){var a=c.count|0;g.command("number"===typeof a&&
0<=a,"invalid vertex count",b.commandStr);return H(function(){return a})}if("count"in e){var d=e.count;return ma(d,function(a,b){var c=a.invoke(b,d);g.optional(function(){a.assert(b,"typeof "+c+'==="number"&&'+c+">=0&&"+c+"===("+c+"|0)","invalid vertex count")});return c})}if(f){if(Ea(f)){if(f)return k?new oa(k.thisDep,k.contextDep,k.propDep,function(a,b){var d=b.def(a.ELEMENTS,".vertCount-",a.OFFSET);g.optional(function(){a.assert(b,d+">=0","invalid vertex offset/element buffer too small")});return d}):
H(function(a,b){return b.def(a.ELEMENTS,".vertCount")});var q=H(function(){return-1});g.optional(function(){q.MISSING=!0});return q}var h=new oa(f.thisDep||k.thisDep,f.contextDep||k.contextDep,f.propDep||k.propDep,function(a,b){var d=a.ELEMENTS;return a.OFFSET?b.def(d,"?",d,".vertCount-",a.OFFSET,":-1"):b.def(d,"?",d,".vertCount:-1")});g.optional(function(){h.DYNAMIC=!0});return h}return null}(),instances:d("instances",!1),offset:k}}function ha(a,b){var d=a["static"],c=a.dynamic,f={};bb.forEach(function(a){function q(b,
e){if(a in d){var g=b(d[a]);f[h]=H(function(){return g})}else if(a in c){var k=c[a];f[h]=ma(k,function(a,b){return e(a,b,a.invoke(b,k))})}}var h=v(a);switch(a){case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "depth.mask":return q(function(d){g.commandType(d,"boolean",a,b.commandStr);return d},function(b,d,c){g.optional(function(){b.assert(d,"typeof "+c+'==="boolean"',
"invalid flag "+a,b.commandStr)});return c});case "depth.func":return q(function(d){g.commandParameter(d,Ua,"invalid "+a,b.commandStr);return Ua[d]},function(b,d,c){var e=b.constants.compareFuncs;g.optional(function(){b.assert(d,c+" in "+e,"invalid "+a+", must be one of "+Object.keys(Ua))});return d.def(e,"[",c,"]")});case "depth.range":return q(function(a){g.command(I(a)&&2===a.length&&"number"===typeof a[0]&&"number"===typeof a[1]&&a[0]<=a[1],"depth range is 2d array",b.commandStr);return a},function(a,
b,d){g.optional(function(){a.assert(b,a.shared.isArrayLike+"("+d+")&&"+d+".length===2&&typeof "+d+'[0]==="number"&&typeof '+d+'[1]==="number"&&'+d+"[0]<="+d+"[1]","depth range must be a 2d array")});var c=b.def("+",d,"[0]"),e=b.def("+",d,"[1]");return[c,e]});case "blend.func":return q(function(a){g.commandType(a,"object","blend.func",b.commandStr);var d="srcRGB"in a?a.srcRGB:a.src,c="srcAlpha"in a?a.srcAlpha:a.src,e="dstRGB"in a?a.dstRGB:a.dst;a="dstAlpha"in a?a.dstAlpha:a.dst;g.commandParameter(d,
va,h+".srcRGB",b.commandStr);g.commandParameter(c,va,h+".srcAlpha",b.commandStr);g.commandParameter(e,va,h+".dstRGB",b.commandStr);g.commandParameter(a,va,h+".dstAlpha",b.commandStr);g.command(-1===Ob.indexOf(d+", "+e),"unallowed blending combination (srcRGB, dstRGB) = ("+d+", "+e+")",b.commandStr);return[va[d],va[e],va[c],va[a]]},function(b,d,c){function e(q,h){var k=d.def('"',q,h,'" in ',c,"?",c,".",q,h,":",c,".",q);g.optional(function(){b.assert(d,k+" in "+f,"invalid "+a+"."+q+h+", must be one of "+
Object.keys(va))});return k}var f=b.constants.blendFuncs;g.optional(function(){b.assert(d,c+"&&typeof "+c+'==="object"',"invalid blend func, must be an object")});var q=e("src","RGB"),h=e("dst","RGB");g.optional(function(){b.assert(d,b.constants.invalidBlendCombinations+".indexOf("+q+'+", "+'+h+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var k=d.def(f,"[",q,"]"),m=d.def(f,"[",e("src","Alpha"),"]"),l=d.def(f,"[",h,"]"),P=d.def(f,"[",e("dst","Alpha"),"]");return[k,l,m,P]});
case "blend.equation":return q(function(d){if("string"===typeof d)return g.commandParameter(d,ba,"invalid "+a,b.commandStr),[ba[d],ba[d]];if("object"===typeof d)return g.commandParameter(d.rgb,ba,a+".rgb",b.commandStr),g.commandParameter(d.alpha,ba,a+".alpha",b.commandStr),[ba[d.rgb],ba[d.alpha]];g.commandRaise("invalid blend.equation",b.commandStr)},function(b,d,c){var e=b.constants.blendEquations,f=d.def(),q=d.def(),h=b.cond("typeof ",c,'==="string"');g.optional(function(){function d(a,c,f){b.assert(a,
f+" in "+e,"invalid "+c+", must be one of "+Object.keys(ba))}d(h.then,a,c);b.assert(h["else"],c+"&&typeof "+c+'==="object"',"invalid "+a);d(h["else"],a+".rgb",c+".rgb");d(h["else"],a+".alpha",c+".alpha")});h.then(f,"=",q,"=",e,"[",c,"];");h["else"](f,"=",e,"[",c,".rgb];",q,"=",e,"[",c,".alpha];");d(h);return[f,q]});case "blend.color":return q(function(a){g.command(I(a)&&4===a.length,"blend.color must be a 4d array",b.commandStr);return la(4,function(b){return+a[b]})},function(a,b,d){g.optional(function(){a.assert(b,
a.shared.isArrayLike+"("+d+")&&"+d+".length===4","blend.color must be a 4d array")});return la(4,function(a){return b.def("+",d,"[",a,"]")})});case "stencil.mask":return q(function(a){g.commandType(a,"number",h,b.commandStr);return a|0},function(a,b,d){g.optional(function(){a.assert(b,"typeof "+d+'==="number"',"invalid stencil.mask")});return b.def(d,"|0")});case "stencil.func":return q(function(d){g.commandType(d,"object",h,b.commandStr);var c=d.cmp||"keep",e=d.ref||0;d="mask"in d?d.mask:-1;g.commandParameter(c,
Ua,a+".cmp",b.commandStr);g.commandType(e,"number",a+".ref",b.commandStr);g.commandType(d,"number",a+".mask",b.commandStr);return[Ua[c],e,d]},function(a,b,d){var c=a.constants.compareFuncs;g.optional(function(){function e(){a.assert(b,Array.prototype.join.call(arguments,""),"invalid stencil.func")}e(d+"&&typeof ",d,'==="object"');e('!("cmp" in ',d,")||(",d,".cmp in ",c,")")});var e=b.def('"cmp" in ',d,"?",c,"[",d,".cmp]",":",7680),f=b.def(d,".ref|0"),q=b.def('"mask" in ',d,"?",d,".mask|0:-1");return[e,
f,q]});case "stencil.opFront":case "stencil.opBack":return q(function(d){g.commandType(d,"object",h,b.commandStr);var c=d.fail||"keep",e=d.zfail||"keep";d=d.zpass||"keep";g.commandParameter(c,Fa,a+".fail",b.commandStr);g.commandParameter(e,Fa,a+".zfail",b.commandStr);g.commandParameter(d,Fa,a+".zpass",b.commandStr);return["stencil.opBack"===a?1029:1028,Fa[c],Fa[e],Fa[d]]},function(b,d,c){function e(q){g.optional(function(){b.assert(d,'!("'+q+'" in '+c+")||("+c+"."+q+" in "+f+")","invalid "+a+"."+
q+", must be one of "+Object.keys(Fa))});return d.def('"',q,'" in ',c,"?",f,"[",c,".",q,"]:",7680)}var f=b.constants.stencilOps;g.optional(function(){b.assert(d,c+"&&typeof "+c+'==="object"',"invalid "+a)});return["stencil.opBack"===a?1029:1028,e("fail"),e("zfail"),e("zpass")]});case "polygonOffset.offset":return q(function(a){g.commandType(a,"object",h,b.commandStr);var d=a.factor|0;a=a.units|0;g.commandType(d,"number",h+".factor",b.commandStr);g.commandType(a,"number",h+".units",b.commandStr);return[d,
a]},function(b,d,c){g.optional(function(){b.assert(d,c+"&&typeof "+c+'==="object"',"invalid "+a)});var e=d.def(c,".factor|0"),f=d.def(c,".units|0");return[e,f]});case "cull.face":return q(function(a){var d=0;"front"===a?d=1028:"back"===a&&(d=1029);g.command(!!d,h,b.commandStr);return d},function(a,b,d){g.optional(function(){a.assert(b,d+'==="front"||'+d+'==="back"',"invalid cull.face")});return b.def(d,'==="front"?',1028,":",1029)});case "lineWidth":return q(function(a){g.command("number"===typeof a&&
a>=e.lineWidthDims[0]&&a<=e.lineWidthDims[1],"invalid line width, must positive number between "+e.lineWidthDims[0]+" and "+e.lineWidthDims[1],b.commandStr);return a},function(a,b,d){g.optional(function(){a.assert(b,"typeof "+d+'==="number"&&'+d+">="+e.lineWidthDims[0]+"&&"+d+"<="+e.lineWidthDims[1],"invalid line width")});return d});case "frontFace":return q(function(a){g.commandParameter(a,ub,h,b.commandStr);return ub[a]},function(a,b,d){g.optional(function(){a.assert(b,d+'==="cw"||'+d+'==="ccw"',
"invalid frontFace, must be one of cw,ccw")});return b.def(d+'==="cw"?2304:2305')});case "colorMask":return q(function(a){g.command(I(a)&&4===a.length,"color.mask must be length 4 array",b.commandStr);return a.map(function(a){return!!a})},function(a,b,d){g.optional(function(){a.assert(b,a.shared.isArrayLike+"("+d+")&&"+d+".length===4","invalid color.mask")});return la(4,function(a){return"!!"+d+"["+a+"]"})});case "sample.coverage":return q(function(a){g.command("object"===typeof a&&a,h,b.commandStr);
var d="value"in a?a.value:1;a=!!a.invert;g.command("number"===typeof d&&0<=d&&1>=d,"sample.coverage.value must be a number between 0 and 1",b.commandStr);return[d,a]},function(a,b,d){g.optional(function(){a.assert(b,d+"&&typeof "+d+'==="object"',"invalid sample.coverage")});var c=b.def('"value" in ',d,"?+",d,".value:1"),e=b.def("!!",d,".invert");return[c,e]})}});return f}function S(a,b){var d=a["static"],c=a.dynamic,e={};Object.keys(d).forEach(function(a){var c=d[a],f;if("number"===typeof c||"boolean"===
typeof c)f=H(function(){return c});else if("function"===typeof c){var q=c._reglType;"texture2d"===q||"textureCube"===q?f=H(function(a){return a.link(c)}):"framebuffer"===q||"framebufferCube"===q?(g.command(0<c.color.length,'missing color attachment for framebuffer sent to uniform "'+a+'"',b.commandStr),f=H(function(a){return a.link(c.color[0])})):g.commandRaise('invalid data for uniform "'+a+'"',b.commandStr)}else I(c)?f=H(function(b){return b.global.def("[",la(c.length,function(d){g.command("number"===
typeof c[d]||"boolean"===typeof c[d],"invalid uniform "+a,b.commandStr);return c[d]}),"]")}):g.commandRaise('invalid or missing data for uniform "'+a+'"',b.commandStr);f.value=c;e[a]=f});Object.keys(c).forEach(function(a){var b=c[a];e[a]=ma(b,function(a,d){return a.invoke(d,b)})});return e}function E(a,d){var c=a["static"],e=a.dynamic,h={};Object.keys(c).forEach(function(a){var e=c[a],q=b.id(a),k=new Z;if(mb(e))k.state=1,k.buffer=f.getBuffer(f.create(e,34962,!1,!0)),k.type=0;else{var l=f.getBuffer(e);
if(l)k.state=1,k.buffer=l,k.type=0;else if(g.command("object"===typeof e&&e,"invalid data for attribute "+a,d.commandStr),e.constant){var p=e.constant;k.buffer="null";k.state=2;"number"===typeof p?k.x=p:(g.command(I(p)&&0<p.length&&4>=p.length,"invalid constant for attribute "+a,d.commandStr),Va.forEach(function(a,b){b<p.length&&(k[a]=p[b])}))}else{l=mb(e.buffer)?f.getBuffer(f.create(e.buffer,34962,!1,!0)):f.getBuffer(e.buffer);g.command(!!l,'missing buffer for attribute "'+a+'"',d.commandStr);var n=
e.offset|0;g.command(0<=n,'invalid offset for attribute "'+a+'"',d.commandStr);var t=e.stride|0;g.command(0<=t&&256>t,'invalid stride for attribute "'+a+'", must be integer betweeen [0, 255]',d.commandStr);var r=e.size|0;g.command(!("size"in e)||0<r&&4>=r,'invalid size for attribute "'+a+'", must be 1,2,3,4',d.commandStr);var w=!!e.normalized,qa=0;"type"in e&&(g.commandParameter(e.type,$a,"invalid type for attribute "+a,d.commandStr),qa=$a[e.type]);var u=e.divisor|0;"divisor"in e&&(g.command(0===
u||za,'cannot specify divisor for attribute "'+a+'", instancing not supported',d.commandStr),g.command(0<=u,'invalid divisor for attribute "'+a+'"',d.commandStr));g.optional(function(){var b=d.commandStr,c="buffer offset divisor normalized type size stride".split(" ");Object.keys(e).forEach(function(d){g.command(0<=c.indexOf(d),'unknown parameter "'+d+'" for attribute pointer "'+a+'" (valid parameters are '+c+")",b)})});k.buffer=l;k.state=1;k.size=r;k.normalized=w;k.type=qa||l.dtype;k.offset=n;k.stride=
t;k.divisor=u}}h[a]=H(function(a,b){var d=a.attribCache;if(q in d)return d[q];var c={isStream:!1};Object.keys(k).forEach(function(a){c[a]=k[a]});k.buffer&&(c.buffer=a.link(k.buffer),c.type=c.type||c.buffer+".dtype");return d[q]=c})});Object.keys(e).forEach(function(a){var b=e[a];h[a]=ma(b,function(d,c){function e(a){c(l[a],"=",f,".",a,"|0;")}var f=d.invoke(c,b),q=d.shared,h=q.isBufferArgs,k=q.buffer;g.optional(function(){d.assert(c,f+"&&(typeof "+f+'==="object"||typeof '+f+'==="function")&&('+h+"("+
f+")||"+k+".getBuffer("+f+")||"+k+".getBuffer("+f+".buffer)||"+h+"("+f+'.buffer)||("constant" in '+f+"&&(typeof "+f+'.constant==="number"||'+q.isArrayLike+"("+f+".constant))))",'invalid dynamic attribute "'+a+'"')});var l={isStream:c.def(!1)},m=new Z;m.state=1;Object.keys(m).forEach(function(a){l[a]=c.def(""+m[a])});var P=l.buffer,p=l.type;c("if(",h,"(",f,")){",l.isStream,"=true;",P,"=",k,".createStream(",34962,",",f,");",p,"=",P,".dtype;","}else{",P,"=",k,".getBuffer(",f,");","if(",P,"){",p,"=",
P,".dtype;",'}else if("constant" in ',f,"){",l.state,"=",2,";","if(typeof "+f+'.constant === "number"){',l[Va[0]],"=",f,".constant;",Va.slice(1).map(function(a){return l[a]}).join("="),"=0;","}else{",Va.map(function(a,b){return l[a]+"="+f+".constant.length>="+b+"?"+f+".constant["+b+"]:0;"}).join(""),"}}else{","if(",h,"(",f,".buffer)){",P,"=",k,".createStream(",34962,",",f,".buffer);","}else{",P,"=",k,".getBuffer(",f,".buffer);","}",p,'="type" in ',f,"?",q.glTypes,"[",f,".type]:",P,".dtype;",l.normalized,
"=!!",f,".normalized;");e("size");e("offset");e("stride");e("divisor");c("}}");c.exit("if(",l.isStream,"){",k,".destroyStream(",P,");","}");return l})});return h}function T(a){var b=a["static"],d=a.dynamic,c={};Object.keys(b).forEach(function(a){var d=b[a];c[a]=H(function(a,b){return"number"===typeof d||"boolean"===typeof d?""+d:a.link(d)})});Object.keys(d).forEach(function(a){var b=d[a];c[a]=ma(b,function(a,d){return a.invoke(d,b)})});return c}function B(a,b,d,c,e){function f(a){var b=m[a];b&&(n[a]=
b)}var h=a["static"],k=a.dynamic;g.optional(function(){function a(d){Object.keys(d).forEach(function(a){g.command(0<=b.indexOf(a),'unknown parameter "'+a+'"',e.commandStr)})}var b="framebuffer vert frag elements primitive offset count instances profile".split(" ").concat(bb);a(h);a(k)});var l=y(a,e),m=A(a,l,e),p=ia(a,e),n=ha(a,e),t=wa(a,e);f("viewport");f(v("scissor.box"));var r=0<Object.keys(n).length,l={framebuffer:l,draw:p,shader:t,state:n,dirty:r};l.profile=W(a,e);l.uniforms=S(d,e);l.attributes=
E(b,e);l.context=T(c,e);return l}function D(a,b,d){var c=a.shared.context,e=a.scope();Object.keys(d).forEach(function(f){b.save(c,"."+f);e(c,".",f,"=",d[f].append(a,b),";")});b(e)}function U(a,b,d,c){var e=a.shared,f=e.gl,g=e.framebuffer,h;ua&&(h=b.def(e.extensions,".webgl_draw_buffers"));var k=a.constants,e=k.drawBuffer,k=k.backBuffer;a=d?d.append(a,b):b.def(g,".next");c||b("if(",a,"!==",g,".cur){");b("if(",a,"){",f,".bindFramebuffer(",36160,",",a,".framebuffer);");ua&&b(h,".drawBuffersWEBGL(",e,
"[",a,".colorAttachments.length]);");b("}else{",f,".bindFramebuffer(",36160,",null);");ua&&b(h,".drawBuffersWEBGL(",k,");");b("}",g,".cur=",a,";");c||b("}")}function L(a,b,d){var c=a.shared,e=c.gl,f=a.current,g=a.next,h=c.current,k=c.next,l=a.cond(h,".dirty");bb.forEach(function(b){b=v(b);if(!(b in d.state)){var c,m;if(b in g){c=g[b];m=f[b];var p=la(Aa[b].length,function(a){return l.def(c,"[",a,"]")});l(a.cond(p.map(function(a,b){return a+"!=="+m+"["+b+"]"}).join("||")).then(e,".",Ca[b],"(",p,");",
p.map(function(a,b){return m+"["+b+"]="+a}).join(";"),";"))}else c=l.def(k,".",b),p=a.cond(c,"!==",h,".",b),l(p),b in Ba?p(a.cond(c).then(e,".enable(",Ba[b],");")["else"](e,".disable(",Ba[b],");"),h,".",b,"=",c,";"):p(e,".",Ca[b],"(",c,");",h,".",b,"=",c,";")}});0===Object.keys(d.state).length&&l(h,".dirty=false;");b(l)}function Da(a,b,d,c){var e=a.shared,f=a.current,g=e.current,h=e.gl;Mb(Object.keys(d)).forEach(function(e){var k=d[e];if(!c||c(k)){var l=k.append(a,b);if(Ba[e]){var m=Ba[e];Ea(k)?l?
b(h,".enable(",m,");"):b(h,".disable(",m,");"):b(a.cond(l).then(h,".enable(",m,");")["else"](h,".disable(",m,");"));b(g,".",e,"=",l,";")}else if(I(l)){var p=f[e];b(h,".",Ca[e],"(",l,");",l.map(function(a,b){return p+"["+b+"]="+a}).join(";"),";")}else b(h,".",Ca[e],"(",l,");",g,".",e,"=",l,";")}})}function N(a,b){za&&(a.instancing=b.def(a.shared.extensions,".angle_instanced_arrays"))}function V(a,b,d,c,e){function f(){return"undefined"===typeof performance?"Date.now()":"performance.now()"}function g(a){t=
b.def();a(t,"=",f(),";");"string"===typeof e?a(m,".count+=",e,";"):a(m,".count++;");u&&(c?(r=b.def(),a(r,"=",n,".getNumPendingQueries();")):a(n,".beginQuery(",m,");"))}function h(a){a(m,".cpuTime+=",f(),"-",t,";");u&&(c?a(n,".pushScopeStats(",r,",",n,".getNumPendingQueries(),",m,");"):a(n,".endQuery();"))}function k(a){var d=b.def(p,".profile");b(p,".profile=",a,";");b.exit(p,".profile=",d,";")}var l=a.shared,m=a.stats,p=l.current,n=l.timer;d=d.profile;var t,r;if(d){if(Ea(d)){d.enable?(g(b),h(b.exit),
k("true")):k("false");return}d=d.append(a,b);k(d)}else d=b.def(p,".profile");l=a.block();g(l);b("if(",d,"){",l,"}");a=a.block();h(a);b.exit("if(",d,"){",a,"}")}function J(a,b,d,c,e){function f(a){switch(a){case 35664:case 35667:case 35671:return 2;case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;default:return 1}}function h(d,c,e){function f(){b("if(!",p,".buffer){",l,".enableVertexAttribArray(",m,");}");var d=e.type,g;g=e.size?b.def(e.size,"||",c):c;b("if(",p,".type!==",
d,"||",p,".size!==",g,"||",r.map(function(a){return p+"."+a+"!=="+e[a]}).join("||"),"){",l,".bindBuffer(",34962,",",n,".buffer);",l,".vertexAttribPointer(",[m,g,d,e.normalized,e.stride,e.offset],");",p,".type=",d,";",p,".size=",g,";",r.map(function(a){return p+"."+a+"="+e[a]+";"}).join(""),"}");za&&(d=e.divisor,b("if(",p,".divisor!==",d,"){",a.instancing,".vertexAttribDivisorANGLE(",[m,d],");",p,".divisor=",d,";}"))}function g(){b("if(",p,".buffer){",l,".disableVertexAttribArray(",m,");","}if(",Va.map(function(a,
b){return p+"."+a+"!=="+t[b]}).join("||"),"){",l,".vertexAttrib4f(",m,",",t,");",Va.map(function(a,b){return p+"."+a+"="+t[b]+";"}).join(""),"}")}var l=k.gl,m=b.def(d,".location"),p=b.def(k.attributes,"[",m,"]");d=e.state;var n=e.buffer,t=[e.x,e.y,e.z,e.w],r=["buffer","normalized","offset","stride"];1===d?f():2===d?g():(b("if(",d,"===",1,"){"),f(),b("}else{"),g(),b("}"))}var k=a.shared;c.forEach(function(c){var k=c.name,l=d.attributes[k],m;if(l){if(!e(l))return;m=l.append(a,b)}else{if(!e(Qb))return;
var p=a.scopeAttrib(k);g.optional(function(){a.assert(b,p+".state","missing attribute "+k)});m={};Object.keys(new Z).forEach(function(a){m[a]=b.def(p,".",a)})}h(a.link(c),f(c.info.type),m)})}function da(a,d,c,e,f){for(var h=a.shared,k=h.gl,l,p=0;p<e.length;++p){var n=e[p],t=n.name,r=n.info.type,w=c.uniforms[t],n=a.link(n)+".location",u;if(w){if(!f(w))continue;if(Ea(w)){var z=w.value;g.command(null!==z&&"undefined"!==typeof z,'missing uniform "'+t+'"',a.commandStr);if(35678===r||35680===r)g.command("function"===
typeof z&&(35678===r&&("texture2d"===z._reglType||"framebuffer"===z._reglType)||35680===r&&("textureCube"===z._reglType||"framebufferCube"===z._reglType)),"invalid texture for uniform "+t,a.commandStr),w=a.link(z._texture||z.color[0]._texture),d(k,".uniform1i(",n,",",w+".bind());"),d.exit(w,".unbind();");else if(35674===r||35675===r||35676===r){g.optional(function(){g.command(I(z),"invalid matrix for uniform "+t,a.commandStr);g.command(35674===r&&4===z.length||35675===r&&9===z.length||35676===r&&
16===z.length,"invalid length for matrix uniform "+t,a.commandStr)});var w=a.global.def("new Float32Array(["+Array.prototype.slice.call(z)+"])"),C=2;35675===r?C=3:35676===r&&(C=4);d(k,".uniformMatrix",C,"fv(",n,",false,",w,");")}else{switch(r){case 5126:g.commandType(z,"number","uniform "+t,a.commandStr);l="1f";break;case 35664:g.command(I(z)&&2===z.length,"uniform "+t,a.commandStr);l="2f";break;case 35665:g.command(I(z)&&3===z.length,"uniform "+t,a.commandStr);l="3f";break;case 35666:g.command(I(z)&&
4===z.length,"uniform "+t,a.commandStr);l="4f";break;case 35670:g.commandType(z,"boolean","uniform "+t,a.commandStr);l="1i";break;case 5124:g.commandType(z,"number","uniform "+t,a.commandStr);l="1i";break;case 35671:g.command(I(z)&&2===z.length,"uniform "+t,a.commandStr);l="2i";break;case 35667:g.command(I(z)&&2===z.length,"uniform "+t,a.commandStr);l="2i";break;case 35672:g.command(I(z)&&3===z.length,"uniform "+t,a.commandStr);l="3i";break;case 35668:g.command(I(z)&&3===z.length,"uniform "+t,a.commandStr);
l="3i";break;case 35673:g.command(I(z)&&4===z.length,"uniform "+t,a.commandStr);l="4i";break;case 35669:g.command(I(z)&&4===z.length,"uniform "+t,a.commandStr),l="4i"}d(k,".uniform",l,"(",n,",",I(z)?Array.prototype.slice.call(z):z,");")}continue}else u=w.append(a,d)}else{if(!f(Qb))continue;u=d.def(h.uniforms,"[",b.id(t),"]")}35678===r?d("if(",u,"&&",u,'._reglType==="framebuffer"){',u,"=",u,".color[0];","}"):35680===r&&d("if(",u,"&&",u,'._reglType==="framebufferCube"){',u,"=",u,".color[0];","}");g.optional(function(){function b(c,
e){a.assert(d,c,'bad data or missing for uniform "'+t+'".  '+e)}function c(a){b("typeof "+u+'==="'+a+'"',"invalid type, expected "+a)}function e(d,c){b(h.isArrayLike+"("+u+")&&"+u+".length==="+d,"invalid vector, should have length "+d,a.commandStr)}function f(d){b("typeof "+u+'==="function"&&'+u+'._reglType==="texture'+(3553===d?"2d":"Cube")+'"',"invalid texture type",a.commandStr)}switch(r){case 5124:c("number");break;case 35667:e(2,"number");break;case 35668:e(3,"number");break;case 35669:e(4,"number");
break;case 5126:c("number");break;case 35664:e(2,"number");break;case 35665:e(3,"number");break;case 35666:e(4,"number");break;case 35670:c("boolean");break;case 35671:e(2,"boolean");break;case 35672:e(3,"boolean");break;case 35673:e(4,"boolean");break;case 35674:e(4,"number");break;case 35675:e(9,"number");break;case 35676:e(16,"number");break;case 35678:f(3553);break;case 35680:f(34067)}});w=1;switch(r){case 35678:case 35680:w=d.def(u,"._texture");d(k,".uniform1i(",n,",",w,".bind());");d.exit(w,
".unbind();");continue;case 5124:case 35670:l="1i";break;case 35667:case 35671:l="2i";w=2;break;case 35668:case 35672:l="3i";w=3;break;case 35669:case 35673:l="4i";w=4;break;case 5126:l="1f";break;case 35664:l="2f";w=2;break;case 35665:l="3f";w=3;break;case 35666:l="4f";w=4;break;case 35674:l="Matrix2fv";break;case 35675:l="Matrix3fv";break;case 35676:l="Matrix4fv"}d(k,".uniform",l,"(",n,",");if("M"===l.charAt(0)){var n=Math.pow(r-35674+2,2),R=a.global.def("new Float32Array(",n,")");d("false,(Array.isArray(",
u,")||",u," instanceof Float32Array)?",u,":(",la(n,function(a){return R+"["+a+"]="+u+"["+a+"]"}),",",R,")")}else 1<w?d(la(w,function(a){return u+"["+a+"]"})):d(u);d(");")}}function aa(a,b,d,c){function e(f){var g=p[f];return g?g.contextDep&&c.contextDynamic||g.propDep?g.append(a,d):g.append(a,b):b.def(m,".",f)}function f(){function a(){d(z,".drawElementsInstancedANGLE(",[t,w,C,r+"<<(("+C+"-5121)>>1)",u],");")}function b(){d(z,".drawArraysInstancedANGLE(",[t,r,w,u],");")}n?R?a():(d("if(",n,"){"),a(),
d("}else{"),b(),d("}")):b()}function h(){function a(){d(l+".drawElements("+[t,w,C,r+"<<(("+C+"-5121)>>1)"]+");")}function b(){d(l+".drawArrays("+[t,r,w]+");")}n?R?a():(d("if(",n,"){"),a(),d("}else{"),b(),d("}")):b()}var k=a.shared,l=k.gl,m=k.draw,p=c.draw,n=function(){var e=p.elements,f=b;if(e){if(e.contextDep&&c.contextDynamic||e.propDep)f=d;e=e.append(a,f)}else e=f.def(m,".","elements");e&&f("if("+e+")"+l+".bindBuffer(34963,"+e+".buffer.buffer);");return e}(),t=e("primitive"),r=e("offset"),w=function(){var e=
p.count,f,h=b;if(e){if(e.contextDep&&c.contextDynamic||e.propDep)h=d;f=e.append(a,h);g.optional(function(){e.MISSING&&a.assert(b,"false","missing vertex count");e.DYNAMIC&&a.assert(h,f+">=0","missing vertex count")})}else f=h.def(m,".","count"),g.optional(function(){a.assert(h,f+">=0","missing vertex count")});return f}();if("number"===typeof w){if(0===w)return}else d("if(",w,"){"),d.exit("}");var u,z;za&&(u=e("instances"),z=a.instancing);var C=n+".type",R=p.elements&&Ea(p.elements);za&&("number"!==
typeof u||0<=u)?"string"===typeof u?(d("if(",u,">0){"),f(),d("}else if(",u,"<0){"),h(),d("}")):f():h()}function ca(a,b,d,c,e){var f=x();e=f.proc("body",e);g.optional(function(){f.commandStr=b.commandStr;f.command=f.link(b.commandStr)});za&&(f.instancing=e.def(f.shared.extensions,".angle_instanced_arrays"));a(f,e,d,c);return f.compile().body}function Ra(a,b,d,c){N(a,b);J(a,b,d,c.attributes,function(){return!0});da(a,b,d,c.uniforms,function(){return!0});aa(a,b,b,d)}function ja(a,b){var d=a.proc("draw",
1);N(a,d);D(a,d,b.context);U(a,d,b.framebuffer);L(a,d,b);Da(a,d,b.state);V(a,d,b,!1,!0);var c=b.shader.progVar.append(a,d);d(a.shared.gl,".useProgram(",c,".program);");if(b.shader.program)Ra(a,d,b,b.shader.program);else{var e=a.global.def("{}"),f=d.def(c,".id"),g=d.def(e,"[",f,"]");d(a.cond(g).then(g,".call(this,a0);")["else"](g,"=",e,"[",f,"]=",a.link(function(d){return ca(Ra,a,b,d,1)}),"(",c,");",g,".call(this,a0);"))}0<Object.keys(b.state).length&&d(a.shared.current,".dirty=true;")}function db(a,
b,d,c){function e(){return!0}a.batchId="a1";N(a,b);J(a,b,d,c.attributes,e);da(a,b,d,c.uniforms,e);aa(a,b,b,d)}function Ia(a,b,d,c){function e(a){return a.contextDep&&g||a.propDep}function f(a){return!e(a)}N(a,b);var g=d.contextDep,h=b.def(),k=b.def();a.shared.props=k;a.batchId=h;var l=a.scope(),m=a.scope();b(l.entry,"for(",h,"=0;",h,"<","a1",";++",h,"){",k,"=","a0","[",h,"];",m,"}",l.exit);d.needsContext&&D(a,m,d.context);d.needsFramebuffer&&U(a,m,d.framebuffer);Da(a,m,d.state,e);d.profile&&e(d.profile)&&
V(a,m,d,!1,!0);c?(J(a,l,d,c.attributes,f),J(a,m,d,c.attributes,e),da(a,l,d,c.uniforms,f),da(a,m,d,c.uniforms,e),aa(a,l,m,d)):(b=a.global.def("{}"),c=d.shader.progVar.append(a,m),k=m.def(c,".id"),l=m.def(b,"[",k,"]"),m(a.shared.gl,".useProgram(",c,".program);","if(!",l,"){",l,"=",b,"[",k,"]=",a.link(function(b){return ca(db,a,d,b,2)}),"(",c,");}",l,".call(this,a0[",h,"],",h,");"))}function Ja(a,b){function d(a){return a.contextDep&&e||a.propDep}var c=a.proc("batch",2);a.batchId="0";N(a,c);var e=!1,
f=!0;Object.keys(b.context).forEach(function(a){e=e||b.context[a].propDep});e||(D(a,c,b.context),f=!1);var g=b.framebuffer,h=!1;g?(g.propDep?e=h=!0:g.contextDep&&e&&(h=!0),h||U(a,c,g)):U(a,c,null);b.state.viewport&&b.state.viewport.propDep&&(e=!0);L(a,c,b);Da(a,c,b.state,function(a){return!d(a)});b.profile&&d(b.profile)||V(a,c,b,!1,"a1");b.contextDep=e;b.needsContext=f;b.needsFramebuffer=h;f=b.shader.progVar;if(f.contextDep&&e||f.propDep)Ia(a,c,b,null);else if(f=f.append(a,c),c(a.shared.gl,".useProgram(",
f,".program);"),b.shader.program)Ia(a,c,b,b.shader.program);else{var g=a.global.def("{}"),h=c.def(f,".id"),l=c.def(g,"[",h,"]");c(a.cond(l).then(l,".call(this,a0,a1);")["else"](l,"=",g,"[",h,"]=",a.link(function(d){return ca(Ia,a,b,d,2)}),"(",f,");",l,".call(this,a0,a1);"))}0<Object.keys(b.state).length&&c(a.shared.current,".dirty=true;")}function sb(a,d){function c(b){var g=d.shader[b];g&&e.set(f.shader,"."+b,g.append(a,e))}var e=a.proc("scope",3);a.batchId="a2";var f=a.shared,g=f.current;D(a,e,
d.context);d.framebuffer&&d.framebuffer.append(a,e);Mb(Object.keys(d.state)).forEach(function(b){var c=d.state[b].append(a,e);I(c)?c.forEach(function(d,c){e.set(a.next[b],"["+c+"]",d)}):e.set(f.next,"."+b,c)});V(a,e,d,!0,!0);["elements","offset","count","instances","primitive"].forEach(function(b){var c=d.draw[b];c&&e.set(f.draw,"."+b,""+c.append(a,e))});Object.keys(d.uniforms).forEach(function(c){e.set(f.uniforms,"["+b.id(c)+"]",d.uniforms[c].append(a,e))});Object.keys(d.attributes).forEach(function(b){var c=
d.attributes[b].append(a,e),f=a.scopeAttrib(b);Object.keys(new Z).forEach(function(a){e.set(f,"."+a,c[a])})});c("vert");c("frag");0<Object.keys(d.state).length&&(e(g,".dirty=true;"),e.exit(g,".dirty=true;"));e("a1(",a.shared.context,",a0,",a.batchId,");")}function ka(a){if("object"===typeof a&&!I(a)){for(var b=Object.keys(a),d=0;d<b.length;++d)if(ra.isDynamic(a[b[d]]))return!0;return!1}}function fa(a,b,d){function c(a,b){g.forEach(function(d){var c=e[d];ra.isDynamic(c)&&(c=a.invoke(b,c),b(m,".",d,
"=",c,";"))})}var e=b["static"][d];if(e&&ka(e)){var f=a.global,g=Object.keys(e),h=!1,l=!1,k=!1,m=a.global.def("{}");g.forEach(function(b){var d=e[b];if(ra.isDynamic(d))"function"===typeof d&&(d=e[b]=ra.unbox(d)),b=ma(d,null),h=h||b.thisDep,k=k||b.propDep,l=l||b.contextDep;else{f(m,".",b,"=");switch(typeof d){case "number":f(d);break;case "string":f('"',d,'"');break;case "object":Array.isArray(d)&&f("[",d.join(),"]");break;default:f(a.link(d))}f(";")}});b.dynamic[d]=new ra.DynamicVariable(4,{thisDep:h,
contextDep:l,propDep:k,ref:m,append:c});delete b["static"][d]}}var Z=n.Record,ba={add:32774,subtract:32778,"reverse subtract":32779};c.ext_blend_minmax&&(ba.min=32775,ba.max=32776);var za=c.angle_instanced_arrays,ua=c.webgl_draw_buffers,Aa={dirty:!0,profile:t.profile},ab={},bb=[],Ba={},Ca={};M("dither",3024);M("blend.enable",3042);O("blend.color","blendColor",[0,0,0,0]);O("blend.equation","blendEquationSeparate",[32774,32774]);O("blend.func","blendFuncSeparate",[1,0,1,0]);M("depth.enable",2929,!0);
O("depth.func","depthFunc",513);O("depth.range","depthRange",[0,1]);O("depth.mask","depthMask",!0);O("colorMask","colorMask",[!0,!0,!0,!0]);M("cull.enable",2884);O("cull.face","cullFace",1029);O("frontFace","frontFace",2305);O("lineWidth","lineWidth",1);M("polygonOffset.enable",32823);O("polygonOffset.offset","polygonOffset",[0,0]);M("sample.alpha",32926);M("sample.enable",32928);O("sample.coverage","sampleCoverage",[1,!1]);M("stencil.enable",2960);O("stencil.mask","stencilMask",-1);O("stencil.func",
"stencilFunc",[519,0,-1]);O("stencil.opFront","stencilOpSeparate",[1028,7680,7680,7680]);O("stencil.opBack","stencilOpSeparate",[1029,7680,7680,7680]);M("scissor.enable",3089);O("scissor.box","scissor",[0,0,a.drawingBufferWidth,a.drawingBufferHeight]);O("viewport","viewport",[0,0,a.drawingBufferWidth,a.drawingBufferHeight]);var rb={gl:a,context:Y,strings:b,next:ab,current:Aa,draw:C,elements:h,buffer:f,shader:r,attributes:n.state,uniforms:p,framebuffer:l,extensions:c,timer:u,isBufferArgs:mb},X={primTypes:Ma,
compareFuncs:Ua,blendFuncs:va,blendEquations:ba,stencilOps:Fa,glTypes:$a,orientationType:ub};g.optional(function(){rb.isArrayLike=I});ua&&(X.backBuffer=[1029],X.drawBuffer=la(e.maxDrawbuffers,function(a){return 0===a?[0]:la(a,function(a){return 36064+a})}));var ta=0;return{next:ab,current:Aa,procs:function(){var b=x(),c=b.proc("poll"),f=b.proc("refresh"),g=b.block();c(g);f(g);var h=b.shared,l=h.gl,k=h.next,m=h.current;g(m,".dirty=false;");U(b,c);U(b,f,null,!0);var p=a.getExtension("angle_instanced_arrays"),
n;p&&(n=b.link(p));for(var t=0;t<e.maxAttributes;++t){var r=f.def(h.attributes,"[",t,"]"),w=b.cond(r,".buffer");w.then(l,".enableVertexAttribArray(",t,");",l,".bindBuffer(",34962,",",r,".buffer.buffer);",l,".vertexAttribPointer(",t,",",r,".size,",r,".type,",r,".normalized,",r,".stride,",r,".offset);")["else"](l,".disableVertexAttribArray(",t,");",l,".vertexAttrib4f(",t,",",r,".x,",r,".y,",r,".z,",r,".w);",r,".buffer=null;");f(w);p&&f(n,".vertexAttribDivisorANGLE(",t,",",r,".divisor);")}Object.keys(Ba).forEach(function(a){var d=
Ba[a],e=g.def(k,".",a),h=b.block();h("if(",e,"){",l,".enable(",d,")}else{",l,".disable(",d,")}",m,".",a,"=",e,";");f(h);c("if(",e,"!==",m,".",a,"){",h,"}")});Object.keys(Ca).forEach(function(a){var d=Ca[a],e=Aa[a],h,p,n=b.block();n(l,".",d,"(");I(e)?(d=e.length,h=b.global.def(k,".",a),p=b.global.def(m,".",a),n(la(d,function(a){return h+"["+a+"]"}),");",la(d,function(a){return p+"["+a+"]="+h+"["+a+"];"}).join("")),c("if(",la(d,function(a){return h+"["+a+"]!=="+p+"["+a+"]"}).join("||"),"){",n,"}")):
(h=g.def(k,".",a),p=g.def(m,".",a),n(h,");",m,".",a,"=",h,";"),c("if(",h,"!==",p,"){",n,"}"));f(n)});return b.compile()}(),compile:function(a,b,d,c,e){var f=x();f.stats=f.link(e);Object.keys(b["static"]).forEach(function(a){fa(f,b,a)});kc.forEach(function(b){fa(f,a,b)});d=B(a,b,d,c,f);ja(f,d);sb(f,d);Ja(f,d);return f.compile()}}}function Rb(a,b){for(var c=0;c<a.length;++c)if(a[c]===b)return c;return-1}var Za={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,
"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},L=function(a){return Object.prototype.toString.call(a)in Za},S=function(a,b){for(var c=Object.keys(b),e=0;e<c.length;++e)a[c[e]]=b[c[e]];return a},Sb="gl canvas container attributes pixelRatio extensions optionalExtensions profile onDone".split(" "),N={};N[5120]=N[5121]=1;N[5122]=N[5123]=N[36193]=N[33635]=N[32819]=N[32820]=
2;N[5124]=N[5125]=N[5126]=N[34042]=4;var g=S(a,{optional:function(a){a()},raise:c,commandRaise:x,command:function(a,b,c){a||x(b,c||p())},parameter:function(a,e,f){a in e||c("unknown parameter ("+a+")"+b(f)+". possible values: "+Object.keys(e).join())},commandParameter:function(a,c,e,f){a in c||x("unknown parameter ("+a+")"+b(e)+". possible values: "+Object.keys(c).join(),f||p())},constructor:function(a){Object.keys(a).forEach(function(a){0>Sb.indexOf(a)&&c('invalid regl constructor argument "'+a+
'". must be one of '+Sb)})},type:function(a,e,f){typeof a!==e&&c("invalid parameter type"+b(f)+". expected "+e+", got "+typeof a)},commandType:y,isTypedArray:function(a,e){L(a)||c("invalid parameter type"+b(e)+". must be a typed array")},nni:function(a,e){0<=a&&(a|0)===a||c("invalid parameter type, ("+a+")"+b(e)+". must be a nonnegative integer")},oneOf:e,shaderError:function(b,c,e,h,g){if(!b.getShaderParameter(c,b.COMPILE_STATUS)){c=b.getShaderInfoLog(c);b=h===b.FRAGMENT_SHADER?"fragment":"vertex";
y(e,"string",b+" shader source must be a string",g);var l=C(e,g);e=M(c);W(l,e);Object.keys(l).forEach(function(a){function b(a,d){c.push(a);e.push(d||"")}var d=l[a];if(d.hasErrors){var c=[""],e=[""];b("file number "+a+": "+d.name+"\n","color:red;text-decoration:underline;font-weight:bold");d.lines.forEach(function(a){if(0<a.errors.length){b(f(a.number,4)+"|  ","background-color:yellow; font-weight:bold");b(a.line+"\n","color:red; background-color:yellow; font-weight:bold");var d=0;a.errors.forEach(function(c){c=
c.message;var e=/^\s*\'(.*)\'\s*\:\s*(.*)$/.exec(c);if(e){var h=e[1];c=e[2];switch(h){case "assign":h="="}d=Math.max(a.line.indexOf(h,d),0)}else d=0;b(f("| ",6));b(f("^^^",d+3)+"\n","font-weight:bold");b(f("| ",6));b(c+"\n","font-weight:bold")});b(f("| ",6)+"\n")}else b(f(a.number,4)+"|  "),b(a.line+"\n","color:red")});"undefined"!==typeof document?(e[0]=c.join("%c"),console.log.apply(console,e)):console.log(c.join(""))}});a.raise("Error compiling "+b+" shader, "+l[0].name)}},linkError:function(b,
c,e,f,h){b.getProgramParameter(c,b.LINK_STATUS)||(b=b.getProgramInfoLog(c),e=C(e,h),f='Error linking program with vertex shader, "'+C(f,h)[0].name+'", and fragment shader "'+e[0].name+'"',"undefined"!==typeof document?console.log("%c"+f+"\n%c"+b,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(f+"\n"+b),a.raise(f))},callSite:n,saveCommandRef:Y,saveDrawInfo:function(a,b,c,e){function f(a){return a?e.id(a):0}function h(a,b){Object.keys(b).forEach(function(b){a[e.id(b)]=
!0})}Y(a);a._fragId=f(a["static"].frag);a._vertId=f(a["static"].vert);var g=a._uniformSet={};h(g,b["static"]);h(g,b.dynamic);b=a._attributeSet={};h(b,c["static"]);h(b,c.dynamic);a._hasCount="count"in a["static"]||"count"in a.dynamic||"elements"in a["static"]||"elements"in a.dynamic},framebufferFormat:function(a,b,c){a.texture?e(a.texture._texture.internalformat,b,"unsupported texture format for attachment"):e(a.renderbuffer._renderbuffer.format,c,"unsupported renderbuffer format for attachment")},
guessCommand:p,texture2D:function(b,c,e){var f=c.width,h=c.height,g=c.channels;a(0<f&&f<=e.maxTextureSize&&0<h&&h<=e.maxTextureSize,"invalid texture shape");33071===b.wrapS&&33071===b.wrapT||a(!(f&f-1)&&!!f&&!(h&h-1)&&!!h,"incompatible wrap mode for texture, both width and height must be power of 2");1===c.mipmask?1!==f&&1!==h&&a(9984!==b.minFilter&&9986!==b.minFilter&&9985!==b.minFilter&&9987!==b.minFilter,"min filter requires mipmap"):(a(!(f&f-1)&&!!f&&!(h&h-1)&&!!h,"texture must be a square power of 2 to support mipmapping"),
a(c.mipmask===(f<<1)-1,"missing or incomplete mipmap data"));5126===c.type&&(0>e.extensions.indexOf("oes_texture_float_linear")&&a(9728===b.minFilter&&9728===b.magFilter,"filter not supported, must enable oes_texture_float_linear"),a(!b.genMipmaps,"mipmap generation not supported with float textures"));var l=c.images;for(e=0;16>e;++e)if(l[e]){var k=f>>e,p=h>>e;a(c.mipmask&1<<e,"missing mipmap data");var n=l[e];a(n.width===k&&n.height===p,"invalid shape for mip images");a(n.format===c.format&&n.internalformat===
c.internalformat&&n.type===c.type,"incompatible type for mip image");!n.compressed&&n.data&&(k=Math.ceil(v(n.type,g)*k/n.unpackAlignment)*n.unpackAlignment,a(n.data.byteLength===k*p,"invalid data for image, buffer size is inconsistent with image format"))}else b.genMipmaps||a(0===(c.mipmask&1<<e),"extra mipmap data");c.compressed&&a(!b.genMipmaps,"mipmap generation for compressed images not supported")},textureCube:function(b,c,e,f){var h=b.width,g=b.height,l=b.channels;a(0<h&&h<=f.maxTextureSize&&
0<g&&g<=f.maxTextureSize,"invalid texture shape");a(h===g,"cube map must be square");a(33071===c.wrapS&&33071===c.wrapT,"wrap mode not supported by cube map");for(f=0;f<e.length;++f){var k=e[f];a(k.width===h&&k.height===g,"inconsistent cube map face shape");c.genMipmaps&&(a(!k.compressed,"can not generate mipmap for compressed textures"),a(1===k.mipmask,"can not specify mipmaps and generate mipmaps"));for(var p=k.images,n=0;16>n;++n){var r=p[n];if(r){var C=h>>n,M=g>>n;a(k.mipmask&1<<n,"missing mipmap data");
a(r.width===C&&r.height===M,"invalid shape for mip images");a(r.format===b.format&&r.internalformat===b.internalformat&&r.type===b.type,"incompatible type for mip image");r.compressed||r.data&&a(r.data.byteLength===C*M*Math.max(v(r.type,l),r.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format")}}}}}),Ub=0,ra={DynamicVariable:A,define:function(a,b){return new A(a,Ka(b+""))},isDynamic:function(a){return"function"===typeof a&&!a._reglType||a instanceof A},unbox:function(a,
b){return"function"===typeof a?new A(0,a):a},accessor:Ka},vb={next:"function"===typeof requestAnimationFrame?function(a){return requestAnimationFrame(a)}:function(a){return setTimeout(a,16)},cancel:"function"===typeof cancelAnimationFrame?function(a){return cancelAnimationFrame(a)}:clearTimeout},Tb="undefined"!==typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date},lc=function(a,b){var c=1;b.ext_texture_filter_anisotropic&&(c=a.getParameter(34047));var e=
1,f=1;b.webgl_draw_buffers&&(e=a.getParameter(34852),f=a.getParameter(36063));return{colorBits:[a.getParameter(3410),a.getParameter(3411),a.getParameter(3412),a.getParameter(3413)],depthBits:a.getParameter(3414),stencilBits:a.getParameter(3415),subpixelBits:a.getParameter(3408),extensions:Object.keys(b).filter(function(a){return!!b[a]}),maxAnisotropic:c,maxDrawbuffers:e,maxColorAttachments:f,pointSizeDims:a.getParameter(33901),lineWidthDims:a.getParameter(33902),maxViewportDims:a.getParameter(3386),
maxCombinedTextureUnits:a.getParameter(35661),maxCubeMapSize:a.getParameter(34076),maxRenderbufferSize:a.getParameter(34024),maxTextureUnits:a.getParameter(34930),maxTextureSize:a.getParameter(3379),maxAttributes:a.getParameter(34921),maxVertexUniforms:a.getParameter(36347),maxVertexTextureUnits:a.getParameter(35660),maxVaryingVectors:a.getParameter(36348),maxFragmentUniforms:a.getParameter(36349),glsl:a.getParameter(35724),renderer:a.getParameter(7937),vendor:a.getParameter(7936),version:a.getParameter(7938)}},
fa=function(a){return Object.keys(a).map(function(b){return a[b]})},xb=la(8,function(){return[]}),T={alloc:X,free:yb,allocType:function(a,b){var c=null;switch(a){case 5120:c=new Int8Array(X(b),0,b);break;case 5121:c=new Uint8Array(X(b),0,b);break;case 5122:c=new Int16Array(X(2*b),0,b);break;case 5123:c=new Uint16Array(X(2*b),0,b);break;case 5124:c=new Int32Array(X(4*b),0,b);break;case 5125:c=new Uint32Array(X(4*b),0,b);break;case 5126:c=new Float32Array(X(4*b),0,b);break;default:return null}return c.length!==
b?c.subarray(0,b):c},freeType:function(a){yb(a.buffer)}},kb={shape:function(a){for(var b=[];a.length;a=a[0])b.push(a.length);return b},flatten:function(a,b,c,e){var f=1;if(b.length)for(var h=0;h<b.length;++h)f*=b[h];else f=0;c=e||T.allocType(c,f);switch(b.length){case 0:break;case 1:e=b[0];for(b=0;b<e;++b)c[b]=a[b];break;case 2:e=b[0];b=b[1];for(h=f=0;h<e;++h)for(var g=a[h],l=0;l<b;++l)c[f++]=g[l];break;case 3:zb(a,b[0],b[1],b[2],c,0);break;default:Ab(a,b,0,c,0)}return c}},$a={int8:5120,int16:5122,
int32:5124,uint8:5121,uint16:5123,uint32:5125,"float":5126,float32:5126},hb={dynamic:35048,stream:35040,"static":35044},ob=kb.flatten,Db=kb.shape,ta=[];ta[5120]=1;ta[5122]=2;ta[5124]=4;ta[5121]=1;ta[5123]=2;ta[5125]=4;ta[5126]=4;var Ma={points:0,point:0,lines:1,line:1,triangles:4,triangle:4,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},Fb=new Float32Array(1),Xb=new Uint32Array(Fb.buffer),$b=[9984,9986,9985,9987],jb=[0,6409,6410,6407,6408],aa={};aa[6409]=aa[6406]=aa[6402]=1;aa[34041]=
aa[6410]=2;aa[6407]=aa[35904]=3;aa[6408]=aa[35906]=4;var Yb=Object.keys(Za).concat(["[object HTMLCanvasElement]","[object CanvasRenderingContext2D]","[object HTMLImageElement]","[object HTMLVideoElement]"]),Oa=[];Oa[5121]=1;Oa[5126]=4;Oa[36193]=2;Oa[5123]=2;Oa[5125]=4;var E=[];E[32854]=2;E[32855]=2;E[36194]=2;E[34041]=4;E[33776]=.5;E[33777]=.5;E[33778]=1;E[33779]=1;E[35986]=.5;E[35987]=1;E[34798]=1;E[35840]=.5;E[35841]=.25;E[35842]=.5;E[35843]=.25;E[36196]=.5;var ca=[];ca[32854]=2;ca[32855]=2;ca[36194]=
2;ca[33189]=2;ca[36168]=1;ca[34041]=4;ca[35907]=4;ca[34836]=16;ca[34842]=8;ca[34843]=6;var mc=function(a,b,c,e,f){function h(a){this.id=n++;this.refCount=1;this.renderbuffer=a;this.format=32854;this.height=this.width=0;f.profile&&(this.stats={size:0})}function l(b){var c=b.renderbuffer;g(c,"must not double destroy renderbuffer");a.bindRenderbuffer(36161,null);a.deleteRenderbuffer(c);b.renderbuffer=null;b.refCount=0;delete r[b.id];e.renderbufferCount--}var k={rgba4:32854,rgb565:36194,"rgb5 a1":32855,
depth:33189,stencil:36168,"depth stencil":34041};b.ext_srgb&&(k.srgba=35907);b.ext_color_buffer_half_float&&(k.rgba16f=34842,k.rgb16f=34843);b.webgl_color_buffer_float&&(k.rgba32f=34836);var p=[];Object.keys(k).forEach(function(a){p[k[a]]=a});var n=0,r={};h.prototype.decRef=function(){0>=--this.refCount&&l(this)};f.profile&&(e.getTotalRenderbufferSize=function(){var a=0;Object.keys(r).forEach(function(b){a+=r[b].stats.size});return a});return{create:function(b,l){function m(b,e){var h=0,l=0,r=32854;
"object"===typeof b&&b?("shape"in b?(l=b.shape,g(Array.isArray(l)&&2<=l.length,"invalid renderbuffer shape"),h=l[0]|0,l=l[1]|0):("radius"in b&&(h=l=b.radius|0),"width"in b&&(h=b.width|0),"height"in b&&(l=b.height|0)),"format"in b&&(g.parameter(b.format,k,"invalid renderbuffer format"),r=k[b.format])):"number"===typeof b?(h=b|0,l="number"===typeof e?e|0:h):b?g.raise("invalid arguments to renderbuffer constructor"):h=l=1;g(0<h&&0<l&&h<=c.maxRenderbufferSize&&l<=c.maxRenderbufferSize,"invalid renderbuffer size");
if(h!==n.width||l!==n.height||r!==n.format)return m.width=n.width=h,m.height=n.height=l,n.format=r,a.bindRenderbuffer(36161,n.renderbuffer),a.renderbufferStorage(36161,r,h,l),f.profile&&(n.stats.size=ca[n.format]*n.width*n.height),m.format=p[n.format],m}var n=new h(a.createRenderbuffer());r[n.id]=n;e.renderbufferCount++;m(b,l);m.resize=function(b,e){var h=b|0,l=e|0||h;if(h===n.width&&l===n.height)return m;g(0<h&&0<l&&h<=c.maxRenderbufferSize&&l<=c.maxRenderbufferSize,"invalid renderbuffer size");
m.width=n.width=h;m.height=n.height=l;a.bindRenderbuffer(36161,n.renderbuffer);a.renderbufferStorage(36161,n.format,h,l);f.profile&&(n.stats.size=ca[n.format]*n.width*n.height);return m};m._reglType="renderbuffer";m._renderbuffer=n;f.profile&&(m.stats=n.stats);m.destroy=function(){n.decRef()};return m},clear:function(){fa(r).forEach(l)},restore:function(){fa(r).forEach(function(b){b.renderbuffer=a.createRenderbuffer();a.bindRenderbuffer(36161,b.renderbuffer);a.renderbufferStorage(36161,b.format,b.width,
b.height)});a.bindRenderbuffer(36161,null)}}},dc=[6408],Kb=[];Kb[6408]=4;var lb=[];lb[5121]=1;lb[5126]=4;lb[36193]=2;var ec=[32854,32855,36194,35907,34842,34843,34836],cc={36053:"complete",36054:"incomplete attachment",36057:"incomplete dimensions",36055:"incomplete, missing attachment",36061:"unsupported"},Va=["x","y","z","w"],kc="blend.func blend.equation stencil.func stencil.opFront stencil.opBack sample.coverage viewport scissor.box polygonOffset.offset".split(" "),va={0:0,1:1,zero:0,one:1,"src color":768,
"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Ob="constant color, constant alpha;one minus constant color, constant alpha;constant color, one minus constant alpha;one minus constant color, one minus constant alpha;constant alpha, constant color;constant alpha, one minus constant color;one minus constant alpha, constant color;one minus constant alpha, one minus constant color".split(";"),
Ua={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Fa={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},Pb={frag:35632,vert:35633},ub={cw:2304,ccw:2305},Qb=new oa(!1,!1,!1,function(){}),nc=function(a,b){function c(){this.endQueryIndex=this.startQueryIndex=-1;this.sum=0;this.stats=null}function e(a,b,d){var f=
l.pop()||new c;f.startQueryIndex=a;f.endQueryIndex=b;f.sum=0;f.stats=d;k.push(f)}var f=b.ext_disjoint_timer_query;if(!f)return null;var h=[],g=[],l=[],k=[],p=[],n=[];return{beginQuery:function(a){var b=h.pop()||f.createQueryEXT();f.beginQueryEXT(35007,b);g.push(b);e(g.length-1,g.length,a)},endQuery:function(){f.endQueryEXT(35007)},pushScopeStats:e,update:function(){var a,b;a=g.length;if(0!==a){n.length=Math.max(n.length,a+1);p.length=Math.max(p.length,a+1);p[0]=0;var d=n[0]=0;for(b=a=0;b<g.length;++b){var c=
g[b];f.getQueryObjectEXT(c,34919)?(d+=f.getQueryObjectEXT(c,34918),h.push(c)):g[a++]=c;p[b+1]=d;n[b+1]=a}g.length=a;for(b=a=0;b<k.length;++b){var d=k[b],e=d.startQueryIndex,c=d.endQueryIndex;d.sum+=p[c]-p[e];e=n[e];c=n[c];c===e?(d.stats.gpuTime+=d.sum/1E6,l.push(d)):(d.startQueryIndex=e,d.endQueryIndex=c,k[a++]=d)}k.length=a}},getNumPendingQueries:function(){return g.length},clear:function(){h.push.apply(h,g);for(var a=0;a<h.length;a++)f.deleteQueryEXT(h[a]);g.length=0;h.length=0},restore:function(){g.length=
0;h.length=0}}};return function(a){function b(){if(0===J.length)A&&A.update(),X=null;else{X=vb.next(b);r();for(var a=J.length-1;0<=a;--a){var d=J[a];d&&d(E,null,0)}u.flush();A&&A.update()}}function c(){!X&&0<J.length&&(X=vb.next(b))}function e(){X&&(vb.cancel(b),X=null)}function f(a){a.preventDefault();Y=!0;e();Z.forEach(function(a){a()})}function h(a){u.getError();Y=!1;v.restore();B.restore();I.restore();D.restore();U.restore();N.restore();A&&A.restore();L.procs.refresh();c();aa.forEach(function(a){a()})}
function l(a){function b(a){var d={},c={};Object.keys(a).forEach(function(b){var e=a[b];ra.isDynamic(e)?c[b]=ra.unbox(e,b):d[b]=e});return{dynamic:c,"static":d}}function d(a){for(;m.length<a;)m.push(null);return m}g(!!a,"invalid args to regl({...})");g.type(a,"object","invalid args to regl({...})");var c=b(a.context||{}),e=b(a.uniforms||{}),f=b(a.attributes||{}),h=b(function(a){function b(a){if(a in d){var c=d[a];delete d[a];Object.keys(c).forEach(function(b){d[a+"."+b]=c[b]})}}var d=S({},a);delete d.uniforms;
delete d.attributes;delete d.context;"stencil"in d&&d.stencil.op&&(d.stencil.opBack=d.stencil.opFront=d.stencil.op,delete d.stencil.op);b("blend");b("depth");b("cull");b("stencil");b("polygonOffset");b("scissor");b("sample");return d}(a));a={gpuTime:0,cpuTime:0,count:0};var c=L.compile(h,f,e,c,a),k=c.draw,p=c.batch,n=c.scope,m=[];return S(function(a,b){var c;Y&&g.raise("context lost");if("function"===typeof a)return n.call(this,null,a,0);if("function"===typeof b)if("number"===typeof a)for(c=0;c<a;++c)n.call(this,
null,b,c);else if(Array.isArray(a))for(c=0;c<a.length;++c)n.call(this,a[c],b,c);else return n.call(this,a,b,0);else if("number"===typeof a){if(0<a)return p.call(this,d(a|0),a|0)}else if(Array.isArray(a)){if(a.length)return p.call(this,a,a.length)}else return k.call(this,a)},{stats:a})}function k(a,b){var d=0;L.procs.poll();var c=b.color;c&&(u.clearColor(+c[0]||0,+c[1]||0,+c[2]||0,+c[3]||0),d|=16384);"depth"in b&&(u.clearDepth(+b.depth),d|=256);"stencil"in b&&(u.clearStencil(b.stencil|0),d|=1024);
g(!!d,"called regl.clear with no buffer specified");u.clear(d)}function p(a){g.type(a,"function","regl.frame() callback must be a function");J.push(a);c();return{cancel:function(){function b(){var a=Rb(J,b);J[a]=J[J.length-1];--J.length;0>=J.length&&e()}var d=Rb(J,a);g(0<=d,"cannot cancel a frame twice");J[d]=b}}}function n(){var a=da.viewport,b=da.scissor_box;a[0]=a[1]=b[0]=b[1]=0;E.viewportWidth=E.framebufferWidth=E.drawingBufferWidth=a[2]=b[2]=u.drawingBufferWidth;E.viewportHeight=E.framebufferHeight=
E.drawingBufferHeight=a[3]=b[3]=u.drawingBufferHeight}function r(){E.tick+=1;E.time=M();n();L.procs.poll()}function C(){n();L.procs.refresh();A&&A.update()}function M(){return(Tb()-wa)/1E3}a=Ya(a);if(!a)return null;var u=a.gl,t=u.getContextAttributes(),Y=u.isContextLost(),v=za(u,a);if(!v)return null;var x=ja(),W={bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0},y=v.extensions,A=nc(u,y),wa=Tb(),ia=u.drawingBufferWidth,
ha=u.drawingBufferHeight,E={tick:0,time:0,viewportWidth:ia,viewportHeight:ha,framebufferWidth:ia,framebufferHeight:ha,drawingBufferWidth:ia,drawingBufferHeight:ha,pixelRatio:a.pixelRatio},H=lc(u,y),I=Vb(u,W,a),T=Wb(u,y,I,W),ia=fc(u,y,H,I,x),B=gc(u,x,W,a),D=Zb(u,y,H,function(){L.procs.poll()},E,W,a),U=mc(u,y,H,W,a),N=bc(u,y,H,D,U,W),L=jc(u,x,y,H,I,T,D,N,{},ia,B,{elements:null,primitive:4,count:-1,offset:0,instances:-1},E,A,a),x=hc(u,N,L.procs.poll,E,t,y),da=L.next,V=u.canvas,J=[],Z=[],aa=[],ca=[a.onDestroy],
X=null;V&&(V.addEventListener("webglcontextlost",f,!1),V.addEventListener("webglcontextrestored",h,!1));var fa=N.setFBO=l({framebuffer:ra.define.call(null,1,"framebuffer")});C();t=S(l,{clear:function(a){g("object"===typeof a&&a,"regl.clear() takes an object as input");if("framebuffer"in a)if(a.framebuffer&&"framebufferCube"===a.framebuffer_reglType)for(var b=0;6>b;++b)fa(S({framebuffer:a.framebuffer.faces[b]},a),k);else fa(a,k);else k(null,a)},prop:ra.define.bind(null,1),context:ra.define.bind(null,
2),"this":ra.define.bind(null,3),draw:l({}),buffer:function(a){return I.create(a,34962,!1,!1)},elements:function(a){return T.create(a,!1)},texture:D.create2D,cube:D.createCube,renderbuffer:U.create,framebuffer:N.create,framebufferCube:N.createCube,attributes:t,frame:p,on:function(a,b){g.type(b,"function","listener callback must be a function");var d;switch(a){case "frame":return p(b);case "lost":d=Z;break;case "restore":d=aa;break;case "destroy":d=ca;break;default:g.raise("invalid event, must be one of frame,lost,restore,destroy")}d.push(b);
return{cancel:function(){for(var a=0;a<d.length;++a)if(d[a]===b){d[a]=d[d.length-1];d.pop();break}}}},limits:H,hasExtension:function(a){return 0<=H.extensions.indexOf(a.toLowerCase())},read:x,destroy:function(){J.length=0;e();V&&(V.removeEventListener("webglcontextlost",f),V.removeEventListener("webglcontextrestored",h));B.clear();N.clear();U.clear();D.clear();T.clear();I.clear();A&&A.clear();ca.forEach(function(a){a()})},_gl:u,_refresh:C,poll:function(){r();A&&A.update()},now:M,stats:W});a.onDone(null,
t);return t}})},{}],3:[function(x,y,v){var k={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};k.localCName=k.generateIdentifier();k.splitLines=function(c){return c.trim().split("\n").map(function(a){return a.trim()})};k.splitSections=function(c){return c.split("\nm=").map(function(a,b){return(0<b?"m="+a:a).trim()+"\r\n"})};k.matchPrefix=function(c,a){return k.splitLines(c).filter(function(b){return 0===b.indexOf(a)})};k.parseCandidate=function(c){c=0===c.indexOf("a=candidate:")?
c.substring(12).split(" "):c.substring(10).split(" ");for(var a={foundation:c[0],component:c[1],protocol:c[2].toLowerCase(),priority:parseInt(c[3],10),ip:c[4],port:parseInt(c[5],10),type:c[7]},b=8;b<c.length;b+=2)switch(c[b]){case "raddr":a.relatedAddress=c[b+1];break;case "rport":a.relatedPort=parseInt(c[b+1],10);break;case "tcptype":a.tcpType=c[b+1]}return a};k.writeCandidate=function(c){var a=[];a.push(c.foundation);a.push(c.component);a.push(c.protocol.toUpperCase());a.push(c.priority);a.push(c.ip);
a.push(c.port);var b=c.type;a.push("typ");a.push(b);"host"!==b&&c.relatedAddress&&c.relatedPort&&(a.push("raddr"),a.push(c.relatedAddress),a.push("rport"),a.push(c.relatedPort));c.tcpType&&"tcp"===c.protocol.toLowerCase()&&(a.push("tcptype"),a.push(c.tcpType));return"candidate:"+a.join(" ")};k.parseRtpMap=function(c){c=c.substr(9).split(" ");var a={payloadType:parseInt(c.shift(),10)};c=c[0].split("/");a.name=c[0];a.clockRate=parseInt(c[1],10);a.numChannels=3===c.length?parseInt(c[2],10):1;return a};
k.writeRtpMap=function(c){var a=c.payloadType;void 0!==c.preferredPayloadType&&(a=c.preferredPayloadType);return"a=rtpmap:"+a+" "+c.name+"/"+c.clockRate+(1!==c.numChannels?"/"+c.numChannels:"")+"\r\n"};k.parseExtmap=function(c){c=c.substr(9).split(" ");return{id:parseInt(c[0],10),uri:c[1]}};k.writeExtmap=function(c){return"a=extmap:"+(c.id||c.preferredId)+" "+c.uri+"\r\n"};k.parseFmtp=function(c){for(var a={},b=c.substr(c.indexOf(" ")+1).split(";"),e=0;e<b.length;e++)c=b[e].trim().split("="),a[c[0].trim()]=
c[1];return a};k.writeFmtp=function(c){var a="",b=c.payloadType;void 0!==c.preferredPayloadType&&(b=c.preferredPayloadType);if(c.parameters&&Object.keys(c.parameters).length){var e=[];Object.keys(c.parameters).forEach(function(a){e.push(a+"="+c.parameters[a])});a+="a=fmtp:"+b+" "+e.join(";")+"\r\n"}return a};k.parseRtcpFb=function(c){c=c.substr(c.indexOf(" ")+1).split(" ");return{type:c.shift(),parameter:c.join(" ")}};k.writeRtcpFb=function(c){var a="",b=c.payloadType;void 0!==c.preferredPayloadType&&
(b=c.preferredPayloadType);c.rtcpFeedback&&c.rtcpFeedback.length&&c.rtcpFeedback.forEach(function(c){a+="a=rtcp-fb:"+b+" "+c.type+(c.parameter&&c.parameter.length?" "+c.parameter:"")+"\r\n"});return a};k.parseSsrcMedia=function(c){var a=c.indexOf(" "),b={ssrc:parseInt(c.substr(7,a-7),10)},e=c.indexOf(":",a);-1<e?(b.attribute=c.substr(a+1,e-a-1),b.value=c.substr(e+1)):b.attribute=c.substr(a+1);return b};k.getDtlsParameters=function(c,a){var b=k.splitLines(c),b=b.concat(k.splitLines(a)),b=b.filter(function(a){return 0===
a.indexOf("a=fingerprint:")})[0].substr(14);return{role:"auto",fingerprints:[{algorithm:b.split(" ")[0],value:b.split(" ")[1]}]}};k.writeDtlsParameters=function(c,a){var b="a=setup:"+a+"\r\n";c.fingerprints.forEach(function(a){b+="a=fingerprint:"+a.algorithm+" "+a.value+"\r\n"});return b};k.getIceParameters=function(c,a){var b=k.splitLines(c),b=b.concat(k.splitLines(a));return{usernameFragment:b.filter(function(a){return 0===a.indexOf("a=ice-ufrag:")})[0].substr(12),password:b.filter(function(a){return 0===
a.indexOf("a=ice-pwd:")})[0].substr(10)}};k.writeIceParameters=function(c){return"a=ice-ufrag:"+c.usernameFragment+"\r\na=ice-pwd:"+c.password+"\r\n"};k.parseRtpParameters=function(c){for(var a={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},b=k.splitLines(c)[0].split(" "),e=3;e<b.length;e++){var f=b[e],h=k.matchPrefix(c,"a=rtpmap:"+f+" ")[0];if(h){var h=k.parseRtpMap(h),l=k.matchPrefix(c,"a=fmtp:"+f+" ");h.parameters=l.length?k.parseFmtp(l[0]):{};h.rtcpFeedback=k.matchPrefix(c,"a=rtcp-fb:"+
f+" ").map(k.parseRtcpFb);a.codecs.push(h);switch(h.name.toUpperCase()){case "RED":case "ULPFEC":a.fecMechanisms.push(h.name.toUpperCase())}}}k.matchPrefix(c,"a=extmap:").forEach(function(b){a.headerExtensions.push(k.parseExtmap(b))});return a};k.writeRtpDescription=function(c,a){var b="",b=b+("m="+c+" "),b=b+(0<a.codecs.length?"9":"0"),b=b+" UDP/TLS/RTP/SAVPF ",b=b+(a.codecs.map(function(a){return void 0!==a.preferredPayloadType?a.preferredPayloadType:a.payloadType}).join(" ")+"\r\n"),b=b+"c=IN IP4 0.0.0.0\r\n",
b=b+"a=rtcp:9 IN IP4 0.0.0.0\r\n";a.codecs.forEach(function(a){b+=k.writeRtpMap(a);b+=k.writeFmtp(a);b+=k.writeRtcpFb(a)});b+="a=rtcp-mux\r\n";a.headerExtensions.forEach(function(a){b+=k.writeExtmap(a)});return b};k.parseRtpEncodingParameters=function(c){var a=[],b=k.parseRtpParameters(c),e=-1!==b.fecMechanisms.indexOf("RED"),f=-1!==b.fecMechanisms.indexOf("ULPFEC"),h=k.matchPrefix(c,"a=ssrc:").map(function(a){return k.parseSsrcMedia(a)}).filter(function(a){return"cname"===a.attribute}),l=0<h.length&&
h[0].ssrc,r,h=k.matchPrefix(c,"a=ssrc-group:FID").map(function(a){a=a.split(" ");a.shift();return a.map(function(a){return parseInt(a,10)})});0<h.length&&1<h[0].length&&h[0][0]===l&&(r=h[0][1]);b.codecs.forEach(function(b){"RTX"===b.name.toUpperCase()&&b.parameters.apt&&(b={ssrc:l,codecPayloadType:parseInt(b.parameters.apt,10),rtx:{payloadType:b.payloadType,ssrc:r}},a.push(b),e&&(b=JSON.parse(JSON.stringify(b)),b.fec={ssrc:r,mechanism:f?"red+ulpfec":"red"},a.push(b)))});0===a.length&&l&&a.push({ssrc:l});
var p=k.matchPrefix(c,"b=");p.length&&(0===p[0].indexOf("b=TIAS:")?p=parseInt(p[0].substr(7),10):0===p[0].indexOf("b=AS:")&&(p=parseInt(p[0].substr(5),10)),a.forEach(function(a){a.maxBitrate=p}));return a};k.writeSessionBoilerplate=function(){return"v=0\r\no=thisisadapterortc 8169639915646943137 2 IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"};k.writeMediaSection=function(c,a,b,e){a=k.writeRtpDescription(c.kind,a);a+=k.writeIceParameters(c.iceGatherer.getLocalParameters());a+=k.writeDtlsParameters(c.dtlsTransport.getLocalParameters(),
"offer"===b?"actpass":"active");a+="a=mid:"+c.mid+"\r\n";a=c.rtpSender&&c.rtpReceiver?a+"a=sendrecv\r\n":c.rtpSender?a+"a=sendonly\r\n":c.rtpReceiver?a+"a=recvonly\r\n":a+"a=inactive\r\n";c.rtpSender&&(b="msid:"+e.id+" "+c.rtpSender.track.id+"\r\n",a=a+("a="+b)+("a=ssrc:"+c.sendEncodingParameters[0].ssrc+" "+b));return a+="a=ssrc:"+c.sendEncodingParameters[0].ssrc+" cname:"+k.localCName+"\r\n"};k.getDirection=function(c,a){for(var b=k.splitLines(c),e=0;e<b.length;e++)switch(b[e]){case "a=sendrecv":case "a=sendonly":case "a=recvonly":case "a=inactive":return b[e].substr(2)}return a?
k.getDirection(a):"sendrecv"};y.exports=k},{}],4:[function(x,y,v){v=x("./utils").log;var k=x("./utils").browserDetails;y.exports.browserDetails=k;y.exports.extractVersion=x("./utils").extractVersion;y.exports.disableLog=x("./utils").disableLog;var c=x("./chrome/chrome_shim")||null,a=x("./edge/edge_shim")||null,b=x("./firefox/firefox_shim")||null;x=x("./safari/safari_shim")||null;switch(k.browser){case "opera":case "chrome":if(!c||!c.shimPeerConnection){v("Chrome shim is not included in this adapter release.");
break}v("adapter.js shimming chrome.");y.exports.browserShim=c;c.shimGetUserMedia();c.shimMediaStream();c.shimSourceObject();c.shimPeerConnection();c.shimOnTrack();break;case "firefox":if(!b||!b.shimPeerConnection){v("Firefox shim is not included in this adapter release.");break}v("adapter.js shimming firefox.");y.exports.browserShim=b;b.shimGetUserMedia();b.shimSourceObject();b.shimPeerConnection();b.shimOnTrack();break;case "edge":if(!a||!a.shimPeerConnection){v("MS edge shim is not included in this adapter release.");
break}v("adapter.js shimming edge.");y.exports.browserShim=a;a.shimGetUserMedia();a.shimPeerConnection();break;case "safari":if(!x){v("Safari shim is not included in this adapter release.");break}v("adapter.js shimming safari.");y.exports.browserShim=x;x.shimGetUserMedia();break;default:v("Unsupported browser!")}},{"./chrome/chrome_shim":5,"./edge/edge_shim":7,"./firefox/firefox_shim":9,"./safari/safari_shim":11,"./utils":12}],5:[function(x,y,v){var k=x("../utils.js").log,c=x("../utils.js").browserDetails;
y.exports={shimMediaStream:function(){window.MediaStream=window.MediaStream||window.webkitMediaStream},shimOnTrack:function(){"object"!==typeof window||!window.RTCPeerConnection||"ontrack"in window.RTCPeerConnection.prototype||Object.defineProperty(window.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(a){var b=this;this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly));this.addEventListener("track",
this._ontrack=a);this.addEventListener("addstream",this._ontrackpoly=function(a){a.stream.addEventListener("addtrack",function(c){var h=new Event("track");h.track=c.track;h.receiver={track:c.track};h.streams=[a.stream];b.dispatchEvent(h)});a.stream.getTracks().forEach(function(b){var c=new Event("track");c.track=b;c.receiver={track:b};c.streams=[a.stream];this.dispatchEvent(c)}.bind(this))}.bind(this))}})},shimSourceObject:function(){"object"===typeof window&&(!window.HTMLMediaElement||"srcObject"in
window.HTMLMediaElement.prototype||Object.defineProperty(window.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(a){var b=this;this._srcObject=a;this.src&&URL.revokeObjectURL(this.src);a?(this.src=URL.createObjectURL(a),a.addEventListener("addtrack",function(){b.src&&URL.revokeObjectURL(b.src);b.src=URL.createObjectURL(a)}),a.addEventListener("removetrack",function(){b.src&&URL.revokeObjectURL(b.src);b.src=URL.createObjectURL(a)})):this.src=""}}))},shimPeerConnection:function(){window.RTCPeerConnection=
function(a,c){k("PeerConnection");a&&a.iceTransportPolicy&&(a.iceTransports=a.iceTransportPolicy);var f=new webkitRTCPeerConnection(a,c),h=f.getStats.bind(f);f.getStats=function(a,b,c){var e=this,f=arguments;if(0<arguments.length&&"function"===typeof a)return h(a,b);var k=function(a){var b={};a.result().forEach(function(a){var c={id:a.id,timestamp:a.timestamp,type:a.type};a.names().forEach(function(b){c[b]=a.stat(b)});b[c.id]=c});return b},v=function(a,b){var c=new Map(Object.keys(a).map(function(b){return[b,
a[b]]}));b=b||a;Object.keys(b).forEach(function(a){c[a]=b[a]});return c};return 2<=arguments.length?h.apply(this,[function(a){f[1](v(k(a)))},arguments[0]]):(new Promise(function(b,c){1===f.length&&"object"===typeof a?h.apply(e,[function(a){b(v(k(a)))},c]):h.apply(e,[function(a){b(v(k(a),a.result()))},c])})).then(b,c)};return f};window.RTCPeerConnection.prototype=webkitRTCPeerConnection.prototype;webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(window.RTCPeerConnection,"generateCertificate",
{get:function(){return webkitRTCPeerConnection.generateCertificate}});["createOffer","createAnswer"].forEach(function(a){var c=webkitRTCPeerConnection.prototype[a];webkitRTCPeerConnection.prototype[a]=function(){var a=this;if(1>arguments.length||1===arguments.length&&"object"===typeof arguments[0]){var b=1===arguments.length?arguments[0]:void 0;return new Promise(function(l,k){c.apply(a,[l,k,b])})}return c.apply(this,arguments)}});51>c.version&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(a){var c=
webkitRTCPeerConnection.prototype[a];webkitRTCPeerConnection.prototype[a]=function(){var a=arguments,b=this,l=new Promise(function(l,k){c.apply(b,[a[0],l,k])});return 2>a.length?l:l.then(function(){a[1].apply(null,[])},function(b){3<=a.length&&a[2].apply(null,[b])})}});var a=RTCPeerConnection.prototype.addIceCandidate;RTCPeerConnection.prototype.addIceCandidate=function(){return null===arguments[0]?Promise.resolve():a.apply(this,arguments)};["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(a){var c=
webkitRTCPeerConnection.prototype[a];webkitRTCPeerConnection.prototype[a]=function(){arguments[0]=new ("addIceCandidate"===a?RTCIceCandidate:RTCSessionDescription)(arguments[0]);return c.apply(this,arguments)}})},shimGetUserMedia:x("./getusermedia"),attachMediaStream:function(a,b){k("DEPRECATED, attachMediaStream will soon be removed.");43<=c.version?a.srcObject=b:"undefined"!==typeof a.src?a.src=URL.createObjectURL(b):k("Error attaching stream to element.")},reattachMediaStream:function(a,b){k("DEPRECATED, reattachMediaStream will soon be removed.");
43<=c.version?a.srcObject=b.srcObject:a.src=b.src}}},{"../utils.js":12,"./getusermedia":6}],6:[function(x,y,v){var k=x("../utils.js").log;y.exports=function(){var c=function(a){if("object"!==typeof a||a.mandatory||a.optional)return a;var b={};Object.keys(a).forEach(function(c){if("require"!==c&&"advanced"!==c&&"mediaSource"!==c){var e="object"===typeof a[c]?a[c]:{ideal:a[c]};void 0!==e.exact&&"number"===typeof e.exact&&(e.min=e.max=e.exact);var f=function(a,b){return a?a+b.charAt(0).toUpperCase()+
b.slice(1):"deviceId"===b?"sourceId":b};if(void 0!==e.ideal){b.optional=b.optional||[];var k={};"number"===typeof e.ideal?(k[f("min",c)]=e.ideal,b.optional.push(k),k={},k[f("max",c)]=e.ideal):k[f("",c)]=e.ideal;b.optional.push(k)}void 0!==e.exact&&"number"!==typeof e.exact?(b.mandatory=b.mandatory||{},b.mandatory[f("",c)]=e.exact):["min","max"].forEach(function(a){void 0!==e[a]&&(b.mandatory=b.mandatory||{},b.mandatory[f(a,c)]=e[a])})}});a.advanced&&(b.optional=(b.optional||[]).concat(a.advanced));
return b},a=function(a,b){(a=JSON.parse(JSON.stringify(a)))&&a.audio&&(a.audio=c(a.audio));if(a&&"object"===typeof a.video){var e=a.video.facingMode,e=e&&("object"===typeof e?e:{ideal:e});if(!(!e||"user"!==e.exact&&"environment"!==e.exact&&"user"!==e.ideal&&"environment"!==e.ideal||navigator.mediaDevices.getSupportedConstraints&&navigator.mediaDevices.getSupportedConstraints().facingMode)&&(delete a.video.facingMode,"environment"===e.exact||"environment"===e.ideal))return navigator.mediaDevices.enumerateDevices().then(function(f){f=
f.filter(function(a){return"videoinput"===a.kind});if(f=f.find(function(a){return-1!==a.label.toLowerCase().indexOf("back")})||f.length&&f[f.length-1])a.video.deviceId=e.exact?{exact:f.deviceId}:{ideal:f.deviceId};a.video=c(a.video);k("chrome: "+JSON.stringify(a));return b(a)});a.video=c(a.video)}k("chrome: "+JSON.stringify(a));return b(a)},b=function(a){return{name:{PermissionDeniedError:"NotAllowedError",ConstraintNotSatisfiedError:"OverconstrainedError"}[a.name]||a.name,message:a.message,constraint:a.constraintName,
toString:function(){return this.name+(this.message&&": ")+this.message}}};navigator.getUserMedia=function(c,e,f){a(c,function(a){navigator.webkitGetUserMedia(a,e,function(a){f(b(a))})})};var e=function(a){return new Promise(function(b,c){navigator.getUserMedia(a,b,c)})};navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:e,enumerateDevices:function(){return new Promise(function(a){var b={audio:"audioinput",video:"videoinput"};return MediaStreamTrack.getSources(function(c){a(c.map(function(a){return{label:a.label,
kind:b[a.kind],deviceId:a.id,groupId:""}}))})})}});if(navigator.mediaDevices.getUserMedia){var f=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(c){return a(c,function(a){return f(a)["catch"](function(a){return Promise.reject(b(a))})})}}else navigator.mediaDevices.getUserMedia=function(a){return e(a)};"undefined"===typeof navigator.mediaDevices.addEventListener&&(navigator.mediaDevices.addEventListener=function(){k("Dummy mediaDevices.addEventListener called.")});
"undefined"===typeof navigator.mediaDevices.removeEventListener&&(navigator.mediaDevices.removeEventListener=function(){k("Dummy mediaDevices.removeEventListener called.")})}},{"../utils.js":12}],7:[function(x,y,v){var k=x("sdp"),c=x("../utils").log;y.exports={shimPeerConnection:function(){window.RTCIceGatherer&&(window.RTCIceCandidate||(window.RTCIceCandidate=function(a){return a}),window.RTCSessionDescription||(window.RTCSessionDescription=function(a){return a}));window.RTCPeerConnection=function(a){var b=
this,c=document.createDocumentFragment();["addEventListener","removeEventListener","dispatchEvent"].forEach(function(a){b[a]=c[a].bind(c)});this.ondatachannel=this.onnegotiationneeded=this.oniceconnectionstatechange=this.onsignalingstatechange=this.onremovestream=this.ontrack=this.onaddstream=this.onicecandidate=null;this.localStreams=[];this.remoteStreams=[];this.getLocalStreams=function(){return b.localStreams};this.getRemoteStreams=function(){return b.remoteStreams};this.localDescription=new RTCSessionDescription({type:"",
sdp:""});this.remoteDescription=new RTCSessionDescription({type:"",sdp:""});this.signalingState="stable";this.iceGatheringState=this.iceConnectionState="new";this.iceOptions={gatherPolicy:"all",iceServers:[]};if(a&&a.iceTransportPolicy)switch(a.iceTransportPolicy){case "all":case "relay":this.iceOptions.gatherPolicy=a.iceTransportPolicy;break;case "none":throw new TypeError('iceTransportPolicy "none" not supported');}this.usingBundle=a&&"max-bundle"===a.bundlePolicy;a&&a.iceServers&&(a=JSON.parse(JSON.stringify(a.iceServers)),
this.iceOptions.iceServers=a.filter(function(a){return a&&a.urls?(a=a.urls,"string"===typeof a&&(a=[a]),a=a.filter(function(a){return 0===a.indexOf("turn:")&&-1!==a.indexOf("transport=udp")})[0],!!a):!1}));this.transceivers=[];this._localIceCandidatesBuffer=[]};window.RTCPeerConnection.prototype._emitBufferedCandidates=function(){var a=this,b=k.splitSections(a.localDescription.sdp);this._localIceCandidatesBuffer.forEach(function(c){if(c.candidate&&0!==Object.keys(c.candidate).length)-1===c.candidate.candidate.indexOf("typ endOfCandidates")&&
(b[c.candidate.sdpMLineIndex+1]+="a="+c.candidate.candidate+"\r\n");else for(var f=1;f<b.length;f++)-1===b[f].indexOf("\r\na=end-of-candidates\r\n")&&(b[f]+="a=end-of-candidates\r\n");a.localDescription.sdp=b.join("");a.dispatchEvent(c);if(null!==a.onicecandidate)a.onicecandidate(c);!c.candidate&&"complete"!==a.iceGatheringState&&a.transceivers.every(function(a){return a.iceGatherer&&"completed"===a.iceGatherer.state})&&(a.iceGatheringState="complete")});this._localIceCandidatesBuffer=[]};window.RTCPeerConnection.prototype.addStream=
function(a){this.localStreams.push(a.clone());this._maybeFireNegotiationNeeded()};window.RTCPeerConnection.prototype.removeStream=function(a){a=this.localStreams.indexOf(a);-1<a&&(this.localStreams.splice(a,1),this._maybeFireNegotiationNeeded())};window.RTCPeerConnection.prototype.getSenders=function(){return this.transceivers.filter(function(a){return!!a.rtpSender}).map(function(a){return a.rtpSender})};window.RTCPeerConnection.prototype.getReceivers=function(){return this.transceivers.filter(function(a){return!!a.rtpReceiver}).map(function(a){return a.rtpReceiver})};
window.RTCPeerConnection.prototype._getCommonCapabilities=function(a,b){var c={codecs:[],headerExtensions:[],fecMechanisms:[]};a.codecs.forEach(function(a){for(var h=0;h<b.codecs.length;h++){var k=b.codecs[h];if(a.name.toLowerCase()===k.name.toLowerCase()&&a.clockRate===k.clockRate&&a.numChannels===k.numChannels){c.codecs.push(k);break}}});a.headerExtensions.forEach(function(a){for(var h=0;h<b.headerExtensions.length;h++){var k=b.headerExtensions[h];if(a.uri===k.uri){c.headerExtensions.push(k);break}}});
return c};window.RTCPeerConnection.prototype._createIceAndDtlsTransports=function(a,b){var c=this,f=new RTCIceGatherer(c.iceOptions),h=new RTCIceTransport(f);f.onlocalcandidate=function(l){var p=new Event("icecandidate");p.candidate={sdpMid:a,sdpMLineIndex:b};var n=l.candidate;(l=!n||0===Object.keys(n).length)?(void 0===f.state&&(f.state="completed"),p.candidate.candidate="candidate:1 1 udp 1 0.0.0.0 9 typ endOfCandidates"):(n.component="RTCP"===h.component?2:1,p.candidate.candidate=k.writeCandidate(n));
n=k.splitSections(c.localDescription.sdp);-1===p.candidate.candidate.indexOf("typ endOfCandidates")?n[p.candidate.sdpMLineIndex+1]+="a="+p.candidate.candidate+"\r\n":n[p.candidate.sdpMLineIndex+1]+="a=end-of-candidates\r\n";c.localDescription.sdp=n.join("");n=c.transceivers.every(function(a){return a.iceGatherer&&"completed"===a.iceGatherer.state});switch(c.iceGatheringState){case "new":c._localIceCandidatesBuffer.push(p);l&&n&&c._localIceCandidatesBuffer.push(new Event("icecandidate"));break;case "gathering":c._emitBufferedCandidates();
c.dispatchEvent(p);if(null!==c.onicecandidate)c.onicecandidate(p);if(n){c.dispatchEvent(new Event("icecandidate"));if(null!==c.onicecandidate)c.onicecandidate(new Event("icecandidate"));c.iceGatheringState="complete"}}};h.onicestatechange=function(){c._updateConnectionState()};var l=new RTCDtlsTransport(h);l.ondtlsstatechange=function(){c._updateConnectionState()};l.onerror=function(){l.state="failed";c._updateConnectionState()};return{iceGatherer:f,iceTransport:h,dtlsTransport:l}};window.RTCPeerConnection.prototype._transceive=
function(a,b,c){var f=this._getCommonCapabilities(a.localCapabilities,a.remoteCapabilities);b&&a.rtpSender&&(f.encodings=a.sendEncodingParameters,f.rtcp={cname:k.localCName},a.recvEncodingParameters.length&&(f.rtcp.ssrc=a.recvEncodingParameters[0].ssrc),a.rtpSender.send(f));c&&a.rtpReceiver&&(f.encodings=a.recvEncodingParameters,f.rtcp={cname:a.cname},a.sendEncodingParameters.length&&(f.rtcp.ssrc=a.sendEncodingParameters[0].ssrc),a.rtpReceiver.receive(f))};window.RTCPeerConnection.prototype.setLocalDescription=
function(a){var b=this,c,f;if("offer"===a.type)this._pendingOffer&&(c=k.splitSections(a.sdp),f=c.shift(),c.forEach(function(a,c){var e=k.parseRtpParameters(a);b._pendingOffer[c].localCapabilities=e}),this.transceivers=this._pendingOffer,delete this._pendingOffer);else if("answer"===a.type){c=k.splitSections(b.remoteDescription.sdp);f=c.shift();var h=0<k.matchPrefix(f,"a=ice-lite").length;c.forEach(function(a,c){var e=b.transceivers[c],l=e.iceGatherer,r=e.iceTransport,v=e.dtlsTransport,x=e.localCapabilities,
y=e.remoteCapabilities;if("0"!==a.split("\n",1)[0].split(" ",2)[1]){var ha=k.getIceParameters(a,f);if(h){var A=k.matchPrefix(a,"a=candidate:").map(function(a){return k.parseCandidate(a)}).filter(function(a){return"1"===a.component});A.length&&r.setRemoteCandidates(A)}A=k.getDtlsParameters(a,f);h&&(A.role="server");b.usingBundle&&0!==c||(r.start(l,ha,h?"controlling":"controlled"),v.start(A));l=b._getCommonCapabilities(x,y);b._transceive(e,0<l.codecs.length,!1)}})}this.localDescription={type:a.type,
sdp:a.sdp};switch(a.type){case "offer":this._updateSignalingState("have-local-offer");break;case "answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+a.type+'"');}var l=1<arguments.length&&"function"===typeof arguments[1];if(l){var r=arguments[1];window.setTimeout(function(){r();"new"===b.iceGatheringState&&(b.iceGatheringState="gathering");b._emitBufferedCandidates()},0)}c=Promise.resolve();c.then(function(){l||("new"===b.iceGatheringState&&(b.iceGatheringState=
"gathering"),window.setTimeout(b._emitBufferedCandidates.bind(b),500))});return c};window.RTCPeerConnection.prototype.setRemoteDescription=function(a){var b=this,c=new MediaStream,f=[],h=k.splitSections(a.sdp),l=h.shift(),r=0<k.matchPrefix(l,"a=ice-lite").length;this.usingBundle=0<k.matchPrefix(l,"a=group:BUNDLE ").length;h.forEach(function(h,n){var C=k.splitLines(h)[0].substr(2).split(" "),v=C[0],x="0"===C[1],C=k.getDirection(h,l),y,ia,wa,ha,A,da,Ka,ja,fb=k.parseRtpParameters(h),ka;x||(ka=k.getIceParameters(h,
l),ja=k.getDtlsParameters(h,l),ja.role="client");da=k.parseRtpEncodingParameters(h);y=k.matchPrefix(h,"a=mid:");y=y.length?y[0].substr(6):k.generateIdentifier();var La;if(A=k.matchPrefix(h,"a=ssrc:").map(function(a){return k.parseSsrcMedia(a)}).filter(function(a){return"cname"===a.attribute})[0])La=A.value;var Xa=0<k.matchPrefix(h,"a=end-of-candidates").length,Ya=k.matchPrefix(h,"a=candidate:").map(function(a){return k.parseCandidate(a)}).filter(function(a){return"1"===a.component});"offer"!==a.type||
x?"answer"!==a.type||x||(v=b.transceivers[n],y=v.iceGatherer,ia=v.iceTransport,wa=v.dtlsTransport,ha=v.rtpSender,x=v.rtpReceiver,A=v.sendEncodingParameters,Ka=v.localCapabilities,b.transceivers[n].recvEncodingParameters=da,b.transceivers[n].remoteCapabilities=fb,b.transceivers[n].cname=La,(r||Xa)&&Ya.length&&ia.setRemoteCandidates(Ya),b.usingBundle&&0!==n||(ia.start(y,ka,"controlling"),wa.start(ja)),b._transceive(v,"sendrecv"===C||"recvonly"===C,"sendrecv"===C||"sendonly"===C),!x||"sendrecv"!==C&&
"sendonly"!==C?delete v.rtpReceiver:(ja=x.track,f.push([ja,x]),c.addTrack(ja))):(ka=b.usingBundle&&0<n?{iceGatherer:b.transceivers[0].iceGatherer,iceTransport:b.transceivers[0].iceTransport,dtlsTransport:b.transceivers[0].dtlsTransport}:b._createIceAndDtlsTransports(y,n),Xa&&ka.iceTransport.setRemoteCandidates(Ya),Ka=RTCRtpReceiver.getCapabilities(v),A=[{ssrc:1001*(2*n+2)}],x=new RTCRtpReceiver(ka.dtlsTransport,v),ja=x.track,f.push([ja,x]),c.addTrack(ja),0<b.localStreams.length&&b.localStreams[0].getTracks().length>=
n&&(ha=b.localStreams[0].getTracks()[n],ha=new RTCRtpSender(ha,ka.dtlsTransport)),b.transceivers[n]={iceGatherer:ka.iceGatherer,iceTransport:ka.iceTransport,dtlsTransport:ka.dtlsTransport,localCapabilities:Ka,remoteCapabilities:fb,rtpSender:ha,rtpReceiver:x,kind:v,mid:y,cname:La,sendEncodingParameters:A,recvEncodingParameters:da},b._transceive(b.transceivers[n],!1,"sendrecv"===C||"sendonly"===C))});this.remoteDescription={type:a.type,sdp:a.sdp};switch(a.type){case "offer":this._updateSignalingState("have-remote-offer");
break;case "answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+a.type+'"');}c.getTracks().length&&(b.remoteStreams.push(c),window.setTimeout(function(){var a=new Event("addstream");a.stream=c;b.dispatchEvent(a);null!==b.onaddstream&&window.setTimeout(function(){b.onaddstream(a)},0);f.forEach(function(f){var h=f[0];f=f[1];var k=new Event("track");k.track=h;k.receiver=f;k.streams=[c];b.dispatchEvent(a);null!==b.ontrack&&window.setTimeout(function(){b.ontrack(k)},
0)})},0));1<arguments.length&&"function"===typeof arguments[1]&&window.setTimeout(arguments[1],0);return Promise.resolve()};window.RTCPeerConnection.prototype.close=function(){this.transceivers.forEach(function(a){a.iceTransport&&a.iceTransport.stop();a.dtlsTransport&&a.dtlsTransport.stop();a.rtpSender&&a.rtpSender.stop();a.rtpReceiver&&a.rtpReceiver.stop()});this._updateSignalingState("closed")};window.RTCPeerConnection.prototype._updateSignalingState=function(a){this.signalingState=a;a=new Event("signalingstatechange");
this.dispatchEvent(a);if(null!==this.onsignalingstatechange)this.onsignalingstatechange(a)};window.RTCPeerConnection.prototype._maybeFireNegotiationNeeded=function(){var a=new Event("negotiationneeded");this.dispatchEvent(a);if(null!==this.onnegotiationneeded)this.onnegotiationneeded(a)};window.RTCPeerConnection.prototype._updateConnectionState=function(){var a,b={"new":0,closed:0,connecting:0,checking:0,connected:0,completed:0,failed:0};this.transceivers.forEach(function(a){b[a.iceTransport.state]++;
b[a.dtlsTransport.state]++});b.connected+=b.completed;a="new";if(0<b.failed)a="failed";else if(0<b.connecting||0<b.checking)a="connecting";else if(0<b.disconnected)a="disconnected";else if(0<b["new"])a="new";else if(0<b.connected||0<b.completed)a="connected";if(a!==this.iceConnectionState&&(this.iceConnectionState=a,a=new Event("iceconnectionstatechange"),this.dispatchEvent(a),null!==this.oniceconnectionstatechange))this.oniceconnectionstatechange(a)};window.RTCPeerConnection.prototype.createOffer=
function(){var a=this;if(this._pendingOffer)throw Error("createOffer called while there is a pending offer.");var b;1===arguments.length&&"function"!==typeof arguments[0]?b=arguments[0]:3===arguments.length&&(b=arguments[2]);var c=[],f=0,h=0;this.localStreams.length&&(f=this.localStreams[0].getAudioTracks().length,h=this.localStreams[0].getVideoTracks().length);if(b){if(b.mandatory||b.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==b.offerToReceiveAudio&&
(f=b.offerToReceiveAudio);void 0!==b.offerToReceiveVideo&&(h=b.offerToReceiveVideo)}for(this.localStreams.length&&this.localStreams[0].getTracks().forEach(function(a){c.push({kind:a.kind,track:a,wantReceive:"audio"===a.kind?0<f:0<h});"audio"===a.kind?f--:"video"===a.kind&&h--});0<f||0<h;)0<f&&(c.push({kind:"audio",wantReceive:!0}),f--),0<h&&(c.push({kind:"video",wantReceive:!0}),h--);var l=k.writeSessionBoilerplate(),r=[];c.forEach(function(b,c){var e=b.track,f=b.kind,h=k.generateIdentifier(),l=a.usingBundle&&
0<c?{iceGatherer:r[0].iceGatherer,iceTransport:r[0].iceTransport,dtlsTransport:r[0].dtlsTransport}:a._createIceAndDtlsTransports(h,c),v=RTCRtpSender.getCapabilities(f),x,y,A=[{ssrc:1001*(2*c+1)}];e&&(x=new RTCRtpSender(e,l.dtlsTransport));b.wantReceive&&(y=new RTCRtpReceiver(l.dtlsTransport,f));r[c]={iceGatherer:l.iceGatherer,iceTransport:l.iceTransport,dtlsTransport:l.dtlsTransport,localCapabilities:v,remoteCapabilities:null,rtpSender:x,rtpReceiver:y,kind:f,mid:h,sendEncodingParameters:A,recvEncodingParameters:null}});
this.usingBundle&&(l+="a=group:BUNDLE "+r.map(function(a){return a.mid}).join(" ")+"\r\n");c.forEach(function(b,c){var e=r[c];l+=k.writeMediaSection(e,e.localCapabilities,"offer",a.localStreams[0])});this._pendingOffer=r;b=new RTCSessionDescription({type:"offer",sdp:l});arguments.length&&"function"===typeof arguments[0]&&window.setTimeout(arguments[0],0,b);return Promise.resolve(b)};window.RTCPeerConnection.prototype.createAnswer=function(){var a=this,b=k.writeSessionBoilerplate();this.usingBundle&&
(b+="a=group:BUNDLE "+this.transceivers.map(function(a){return a.mid}).join(" ")+"\r\n");this.transceivers.forEach(function(c){var e=a._getCommonCapabilities(c.localCapabilities,c.remoteCapabilities);b+=k.writeMediaSection(c,e,"answer",a.localStreams[0])});var c=new RTCSessionDescription({type:"answer",sdp:b});arguments.length&&"function"===typeof arguments[0]&&window.setTimeout(arguments[0],0,c);return Promise.resolve(c)};window.RTCPeerConnection.prototype.addIceCandidate=function(a){if(null===a)this.transceivers.forEach(function(a){a.iceTransport.addRemoteCandidate({})});
else{var b=a.sdpMLineIndex;if(a.sdpMid)for(var c=0;c<this.transceivers.length;c++)if(this.transceivers[c].mid===a.sdpMid){b=c;break}var f=this.transceivers[b];if(f){c=0<Object.keys(a.candidate).length?k.parseCandidate(a.candidate):{};if("tcp"===c.protocol&&0===c.port||"1"!==c.component)return;"endOfCandidates"===c.type&&(c={});f.iceTransport.addRemoteCandidate(c);f=k.splitSections(this.remoteDescription.sdp);f[b+1]+=(c.type?a.candidate.trim():"a=end-of-candidates")+"\r\n";this.remoteDescription.sdp=
f.join("")}}1<arguments.length&&"function"===typeof arguments[1]&&window.setTimeout(arguments[1],0);return Promise.resolve()};window.RTCPeerConnection.prototype.getStats=function(){var a=[];this.transceivers.forEach(function(b){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(c){b[c]&&a.push(b[c].getStats())})});var b=1<arguments.length&&"function"===typeof arguments[1]&&arguments[1];return new Promise(function(c){var f=new Map;Promise.all(a).then(function(a){a.forEach(function(a){Object.keys(a).forEach(function(b){f.set(b,
a[b]);f[b]=a[b]})});b&&window.setTimeout(b,0,f);c(f)})})}},shimGetUserMedia:x("./getusermedia"),attachMediaStream:function(a,b){c("DEPRECATED, attachMediaStream will soon be removed.");a.srcObject=b},reattachMediaStream:function(a,b){c("DEPRECATED, reattachMediaStream will soon be removed.");a.srcObject=b.srcObject}}},{"../utils":12,"./getusermedia":8,sdp:3}],8:[function(x,y,v){y.exports=function(){var k=function(a){return{name:{PermissionDeniedError:"NotAllowedError"}[a.name]||a.name,message:a.message,
constraint:a.constraint,toString:function(){return this.name}}},c=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(a){return c(a)["catch"](function(a){return Promise.reject(k(a))})}}},{}],9:[function(x,y,v){var k=x("../utils").log,c=x("../utils").browserDetails;y.exports={shimOnTrack:function(){"object"!==typeof window||!window.RTCPeerConnection||"ontrack"in window.RTCPeerConnection.prototype||Object.defineProperty(window.RTCPeerConnection.prototype,
"ontrack",{get:function(){return this._ontrack},set:function(a){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly));this.addEventListener("track",this._ontrack=a);this.addEventListener("addstream",this._ontrackpoly=function(a){a.stream.getTracks().forEach(function(c){var f=new Event("track");f.track=c;f.receiver={track:c};f.streams=[a.stream];this.dispatchEvent(f)}.bind(this))}.bind(this))}})},shimSourceObject:function(){"object"===
typeof window&&(!window.HTMLMediaElement||"srcObject"in window.HTMLMediaElement.prototype||Object.defineProperty(window.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(a){this.mozSrcObject=a}}))},shimPeerConnection:function(){if("object"===typeof window&&(window.RTCPeerConnection||window.mozRTCPeerConnection)){window.RTCPeerConnection||(window.RTCPeerConnection=function(a,b){if(38>c.version&&a&&a.iceServers){for(var e=[],k=0;k<a.iceServers.length;k++){var p=
a.iceServers[k];if(p.hasOwnProperty("urls"))for(var n=0;n<p.urls.length;n++){var v={url:p.urls[n]};0===p.urls[n].indexOf("turn")&&(v.username=p.username,v.credential=p.credential);e.push(v)}else e.push(a.iceServers[k])}a.iceServers=e}return new mozRTCPeerConnection(a,b)},window.RTCPeerConnection.prototype=mozRTCPeerConnection.prototype,mozRTCPeerConnection.generateCertificate&&Object.defineProperty(window.RTCPeerConnection,"generateCertificate",{get:function(){return mozRTCPeerConnection.generateCertificate}}),
window.RTCSessionDescription=mozRTCSessionDescription,window.RTCIceCandidate=mozRTCIceCandidate);["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(a){var b=RTCPeerConnection.prototype[a];RTCPeerConnection.prototype[a]=function(){arguments[0]=new ("addIceCandidate"===a?RTCIceCandidate:RTCSessionDescription)(arguments[0]);return b.apply(this,arguments)}});var a=RTCPeerConnection.prototype.addIceCandidate;RTCPeerConnection.prototype.addIceCandidate=function(){return null===
arguments[0]?Promise.resolve():a.apply(this,arguments)};var b=function(a){var b=new Map;Object.keys(a).forEach(function(c){b.set(c,a[c]);b[c]=a[c]});return b},e=RTCPeerConnection.prototype.getStats;RTCPeerConnection.prototype.getStats=function(a,c,k){return e.apply(this,[a||null]).then(function(a){return b(a)}).then(c,k)}}},shimGetUserMedia:x("./getusermedia"),attachMediaStream:function(a,b){k("DEPRECATED, attachMediaStream will soon be removed.");a.srcObject=b},reattachMediaStream:function(a,b){k("DEPRECATED, reattachMediaStream will soon be removed.");
a.srcObject=b.srcObject}}},{"../utils":12,"./getusermedia":10}],10:[function(x,y,v){var k=x("../utils").log,c=x("../utils").browserDetails;y.exports=function(){var a=function(a){return{name:{SecurityError:"NotAllowedError",PermissionDeniedError:"NotAllowedError"}[a.name]||a.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[a.message]||a.message,constraint:a.constraint,toString:function(){return this.name+(this.message&&
": ")+this.message}}},b=function(b,e,f){var h=function(a){if("object"!==typeof a||a.require)return a;var b=[];Object.keys(a).forEach(function(c){if("require"!==c&&"advanced"!==c&&"mediaSource"!==c){var e=a[c]="object"===typeof a[c]?a[c]:{ideal:a[c]};void 0===e.min&&void 0===e.max&&void 0===e.exact||b.push(c);void 0!==e.exact&&("number"===typeof e.exact?e.min=e.max=e.exact:a[c]=e.exact,delete e.exact);if(void 0!==e.ideal){a.advanced=a.advanced||[];var f={};f[c]="number"===typeof e.ideal?{min:e.ideal,
max:e.ideal}:e.ideal;a.advanced.push(f);delete e.ideal;Object.keys(e).length||delete a[c]}}});b.length&&(a.require=b);return a};b=JSON.parse(JSON.stringify(b));38>c.version&&(k("spec: "+JSON.stringify(b)),b.audio&&(b.audio=h(b.audio)),b.video&&(b.video=h(b.video)),k("ff37: "+JSON.stringify(b)));return navigator.mozGetUserMedia(b,e,function(b){f(a(b))})},e=function(a){return new Promise(function(c,e){b(a,c,e)})};navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:e,addEventListener:function(){},
removeEventListener:function(){}});navigator.mediaDevices.enumerateDevices=navigator.mediaDevices.enumerateDevices||function(){return new Promise(function(a){a([{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])})};if(41>c.version){var f=navigator.mediaDevices.enumerateDevices.bind(navigator.mediaDevices);navigator.mediaDevices.enumerateDevices=function(){return f().then(void 0,function(a){if("NotFoundError"===a.name)return[];throw a;
})}}if(49>c.version){var h=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(b){return h(b)["catch"](function(b){return Promise.reject(a(b))})}}navigator.getUserMedia=function(a,e,f){if(44>c.version)return b(a,e,f);console.warn("navigator.getUserMedia has been replaced by navigator.mediaDevices.getUserMedia");navigator.mediaDevices.getUserMedia(a).then(e,f)}}},{"../utils":12}],11:[function(x,y,v){y.exports={shimGetUserMedia:function(){navigator.getUserMedia=
navigator.webkitGetUserMedia}}},{}],12:[function(x,y,v){var k=!0,c={disableLog:function(a){return"boolean"!==typeof a?Error("Argument type: "+typeof a+". Please use a boolean."):(k=a)?"adapter.js logging disabled":"adapter.js logging enabled"},log:function(){"object"!==typeof window||k||"undefined"!==typeof console&&"function"===typeof console.log&&console.log.apply(console,arguments)},extractVersion:function(a,b,c){return(a=a.match(b))&&a.length>=c&&parseInt(a[c],10)},detectBrowser:function(){var a=
{browser:null,version:null,minVersion:null};if("undefined"===typeof window||!window.navigator)return a.browser="Not a browser.",a;if(navigator.mozGetUserMedia)a.browser="firefox",a.version=this.extractVersion(navigator.userAgent,/Firefox\/([0-9]+)\./,1),a.minVersion=31;else if(navigator.webkitGetUserMedia)if(window.webkitRTCPeerConnection)a.browser="chrome",a.version=this.extractVersion(navigator.userAgent,/Chrom(e|ium)\/([0-9]+)\./,2),a.minVersion=38;else if(navigator.userAgent.match(/Version\/(\d+).(\d+)/))a.browser=
"safari",a.version=this.extractVersion(navigator.userAgent,/AppleWebKit\/([0-9]+)\./,1),a.minVersion=602;else return a.browser="Unsupported webkit-based browser with GUM support but no WebRTC support.",a;else if(navigator.mediaDevices&&navigator.userAgent.match(/Edge\/(\d+).(\d+)$/))a.browser="edge",a.version=this.extractVersion(navigator.userAgent,/Edge\/(\d+).(\d+)$/,2),a.minVersion=10547;else return a.browser="Not a supported browser.",a;a.version<a.minVersion&&c.log("Browser: "+a.browser+" Version: "+
a.version+" < minimum supported version: "+a.minVersion+"\n some things might not work!");return a}};y.exports={log:c.log,disableLog:c.disableLog,browserDetails:c.detectBrowser(),extractVersion:c.extractVersion}},{}],13:[function(x,y,v){var k=x("regl")();x("getusermedia")({audio:!0},function(c,a){if(!c){var b=new AudioContext,e=b.createAnalyser();b.createMediaStreamSource(a).connect(e);var b=e.frequencyBinCount,f=new Uint8Array(b),h=k.buffer({length:b,type:"uint8",usage:"dynamic"}),l=k({vert:"\n    precision mediump float;\n\n    #define FFT_SIZE "+
b+"\n    #define PI "+Math.PI+"\n\n    attribute float index, frequency;\n\n    void main() {\n      float theta = 2.0 * PI * index / float(FFT_SIZE);\n      gl_Position = vec4(\n        0.5 * cos(theta) * (1.0 + frequency),\n        0.5 * sin(theta) * (1.0 + frequency),\n        0,\n        1);\n    }",frag:"\n    void main() {\n      gl_FragColor = vec4(1, 1, 1, 1);\n    }",attributes:{index:Array(b).fill().map(function(a,b){return b}),frequency:{buffer:h,normalized:!0}},elements:null,instances:-1,
lineWidth:1,depth:{enable:!1},count:b,primitive:"line loop"});k.frame(function(a){k.clear({color:[0,0,0,1],depth:1});e.getByteFrequencyData(f);h.subdata(f);l()})}})},{getusermedia:1,regl:2}]},{},[13]);
