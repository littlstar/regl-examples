<!DOCTYPE html>
      <html>
        <head>
          <title>src/particles.js</title>
          <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
          <meta charset=utf-8>
        </head>
        <body>
        <script type='text/javascript'>
        (function e$$0(e,r,a){function b(c,m){if(!r[c]){if(!e[c]){var l="function"==typeof require&&require;if(!m&&l)return l(c,!0);if(f)return f(c,!0);l=Error("Cannot find module '"+c+"'");throw l.code="MODULE_NOT_FOUND",l;}l=r[c]={exports:{}};e[c][0].call(l.exports,function(a){var f=e[c][1][a];return b(f?f:a)},l,l.exports,e$$0,e,r,a)}return r[c].exports}for(var f="function"==typeof require&&require,c=0;c<a.length;c++)b(a[c]);return b})({1:[function(k,e,r){e.exports=function(a,b){var f=b[0],c=b[1],h=b[2],
m=b[3],l=b[4],z=b[5],p=b[6],w=b[7],ma=b[8],B=b[9],y=b[10],e=b[11],k=b[12],E=b[13],A=b[14],H=b[15];a[0]=z*(y*H-e*A)-B*(p*H-w*A)+E*(p*e-w*y);a[1]=-(c*(y*H-e*A)-B*(h*H-m*A)+E*(h*e-m*y));a[2]=c*(p*H-w*A)-z*(h*H-m*A)+E*(h*w-m*p);a[3]=-(c*(p*e-w*y)-z*(h*e-m*y)+B*(h*w-m*p));a[4]=-(l*(y*H-e*A)-ma*(p*H-w*A)+k*(p*e-w*y));a[5]=f*(y*H-e*A)-ma*(h*H-m*A)+k*(h*e-m*y);a[6]=-(f*(p*H-w*A)-l*(h*H-m*A)+k*(h*w-m*p));a[7]=f*(p*e-w*y)-l*(h*e-m*y)+ma*(h*w-m*p);a[8]=l*(B*H-e*E)-ma*(z*H-w*E)+k*(z*e-w*B);a[9]=-(f*(B*H-e*E)-
ma*(c*H-m*E)+k*(c*e-m*B));a[10]=f*(z*H-w*E)-l*(c*H-m*E)+k*(c*w-m*z);a[11]=-(f*(z*e-w*B)-l*(c*e-m*B)+ma*(c*w-m*z));a[12]=-(l*(B*A-y*E)-ma*(z*A-p*E)+k*(z*y-p*B));a[13]=f*(B*A-y*E)-ma*(c*A-h*E)+k*(c*y-h*B);a[14]=-(f*(z*A-p*E)-l*(c*A-h*E)+k*(c*p-h*z));a[15]=f*(z*y-p*B)-l*(c*y-h*B)+ma*(c*p-h*z);return a}},{}],2:[function(k,e,r){e.exports=function(a){var b=new Float32Array(16);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=
a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b}},{}],3:[function(k,e,r){e.exports=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];a[9]=b[9];a[10]=b[10];a[11]=b[11];a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15];return a}},{}],4:[function(k,e,r){e.exports=function(){var a=new Float32Array(16);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a}},{}],5:[function(k,
e,r){e.exports=function(a){var b=a[0],f=a[1],c=a[2],h=a[3],m=a[4],l=a[5],z=a[6],p=a[7],w=a[8],e=a[9],B=a[10],k=a[11],r=a[12],I=a[13],E=a[14];a=a[15];return(b*l-f*m)*(B*a-k*E)-(b*z-c*m)*(e*a-k*I)+(b*p-h*m)*(e*E-B*I)+(f*z-c*l)*(w*a-k*r)-(f*p-h*l)*(w*E-B*r)+(c*p-h*z)*(w*I-e*r)}},{}],6:[function(k,e,r){e.exports=function(a,b){var f=b[0],c=b[1],h=b[2],m=b[3],l=f+f,z=c+c,p=h+h,f=f*l,w=c*l,c=c*z,e=h*l,B=h*z,h=h*p,l=m*l,z=m*z,m=m*p;a[0]=1-c-h;a[1]=w+m;a[2]=e-z;a[3]=0;a[4]=w-m;a[5]=1-f-h;a[6]=B+l;a[7]=0;a[8]=
e+z;a[9]=B-l;a[10]=1-f-c;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a}},{}],7:[function(k,e,r){e.exports=function(a,b,f){var c=b[0],h=b[1],m=b[2],l=b[3],z=c+c,p=h+h,w=m+m;b=c*z;var e=c*p,c=c*w,B=h*p,h=h*w,m=m*w,z=l*z,p=l*p,l=l*w;a[0]=1-(B+m);a[1]=e+l;a[2]=c-p;a[3]=0;a[4]=e-l;a[5]=1-(b+m);a[6]=h+z;a[7]=0;a[8]=c+p;a[9]=h-z;a[10]=1-(b+B);a[11]=0;a[12]=f[0];a[13]=f[1];a[14]=f[2];a[15]=1;return a}},{}],8:[function(k,e,r){e.exports=function(a,b,f,c,h,m,l){var z=1/(f-b),p=1/(h-c),w=1/(m-l);a[0]=2*m*
z;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=2*m*p;a[6]=0;a[7]=0;a[8]=(f+b)*z;a[9]=(h+c)*p;a[10]=(l+m)*w;a[11]=-1;a[12]=0;a[13]=0;a[14]=l*m*2*w;a[15]=0;return a}},{}],9:[function(k,e,r){e.exports=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a}},{}],10:[function(k,e,r){e.exports={create:k("./create"),clone:k("./clone"),copy:k("./copy"),identity:k("./identity"),transpose:k("./transpose"),invert:k("./invert"),adjoint:k("./adjoint"),
determinant:k("./determinant"),multiply:k("./multiply"),translate:k("./translate"),scale:k("./scale"),rotate:k("./rotate"),rotateX:k("./rotateX"),rotateY:k("./rotateY"),rotateZ:k("./rotateZ"),fromRotationTranslation:k("./fromRotationTranslation"),fromQuat:k("./fromQuat"),frustum:k("./frustum"),perspective:k("./perspective"),perspectiveFromFieldOfView:k("./perspectiveFromFieldOfView"),ortho:k("./ortho"),lookAt:k("./lookAt"),str:k("./str")}},{"./adjoint":1,"./clone":2,"./copy":3,"./create":4,"./determinant":5,
"./fromQuat":6,"./fromRotationTranslation":7,"./frustum":8,"./identity":9,"./invert":11,"./lookAt":12,"./multiply":13,"./ortho":14,"./perspective":15,"./perspectiveFromFieldOfView":16,"./rotate":17,"./rotateX":18,"./rotateY":19,"./rotateZ":20,"./scale":21,"./str":22,"./translate":23,"./transpose":24}],11:[function(k,e,r){e.exports=function(a,b){var f=b[0],c=b[1],h=b[2],m=b[3],l=b[4],z=b[5],p=b[6],w=b[7],e=b[8],B=b[9],k=b[10],r=b[11],I=b[12],E=b[13],A=b[14],H=b[15],C=f*z-c*l,D=f*p-h*l,J=f*w-m*l,L=
c*p-h*z,Z=c*w-m*z,fa=h*w-m*p,S=e*E-B*I,ba=e*A-k*I,ja=e*H-r*I,Ia=B*A-k*E,T=B*H-r*E,U=k*H-r*A,K=C*U-D*T+J*Ia+L*ja-Z*ba+fa*S;if(!K)return null;K=1/K;a[0]=(z*U-p*T+w*Ia)*K;a[1]=(h*T-c*U-m*Ia)*K;a[2]=(E*fa-A*Z+H*L)*K;a[3]=(k*Z-B*fa-r*L)*K;a[4]=(p*ja-l*U-w*ba)*K;a[5]=(f*U-h*ja+m*ba)*K;a[6]=(A*J-I*fa-H*D)*K;a[7]=(e*fa-k*J+r*D)*K;a[8]=(l*T-z*ja+w*S)*K;a[9]=(c*ja-f*T-m*S)*K;a[10]=(I*Z-E*J+H*C)*K;a[11]=(B*J-e*Z-r*C)*K;a[12]=(z*ba-l*Ia-p*S)*K;a[13]=(f*Ia-c*ba+h*S)*K;a[14]=(E*D-I*L-A*C)*K;a[15]=(e*L-B*D+k*C)*
K;return a}},{}],12:[function(k,e,r){var a=k("./identity");e.exports=function(b,f,c,h){var m,l,z,p,w,e,k,y,r=f[0],I=f[1];f=f[2];z=h[0];p=h[1];l=h[2];k=c[0];h=c[1];m=c[2];if(1E-6>Math.abs(r-k)&&1E-6>Math.abs(I-h)&&1E-6>Math.abs(f-m))return a(b);c=r-k;h=I-h;k=f-m;y=1/Math.sqrt(c*c+h*h+k*k);c*=y;h*=y;k*=y;m=p*k-l*h;l=l*c-z*k;z=z*h-p*c;(y=Math.sqrt(m*m+l*l+z*z))?(y=1/y,m*=y,l*=y,z*=y):z=l=m=0;p=h*z-k*l;w=k*m-c*z;e=c*l-h*m;(y=Math.sqrt(p*p+w*w+e*e))?(y=1/y,p*=y,w*=y,e*=y):e=w=p=0;b[0]=m;b[1]=p;b[2]=c;
b[3]=0;b[4]=l;b[5]=w;b[6]=h;b[7]=0;b[8]=z;b[9]=e;b[10]=k;b[11]=0;b[12]=-(m*r+l*I+z*f);b[13]=-(p*r+w*I+e*f);b[14]=-(c*r+h*I+k*f);b[15]=1;return b}},{"./identity":9}],13:[function(k,e,r){e.exports=function(a,b,f){var c=b[0],h=b[1],m=b[2],l=b[3],z=b[4],p=b[5],e=b[6],k=b[7],B=b[8],y=b[9],r=b[10],I=b[11],E=b[12],A=b[13],H=b[14];b=b[15];var C=f[0],D=f[1],J=f[2],L=f[3];a[0]=C*c+D*z+J*B+L*E;a[1]=C*h+D*p+J*y+L*A;a[2]=C*m+D*e+J*r+L*H;a[3]=C*l+D*k+J*I+L*b;C=f[4];D=f[5];J=f[6];L=f[7];a[4]=C*c+D*z+J*B+L*E;a[5]=
C*h+D*p+J*y+L*A;a[6]=C*m+D*e+J*r+L*H;a[7]=C*l+D*k+J*I+L*b;C=f[8];D=f[9];J=f[10];L=f[11];a[8]=C*c+D*z+J*B+L*E;a[9]=C*h+D*p+J*y+L*A;a[10]=C*m+D*e+J*r+L*H;a[11]=C*l+D*k+J*I+L*b;C=f[12];D=f[13];J=f[14];L=f[15];a[12]=C*c+D*z+J*B+L*E;a[13]=C*h+D*p+J*y+L*A;a[14]=C*m+D*e+J*r+L*H;a[15]=C*l+D*k+J*I+L*b;return a}},{}],14:[function(k,e,r){e.exports=function(a,b,f,c,h,m,l){var e=1/(b-f),p=1/(c-h),k=1/(m-l);a[0]=-2*e;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=-2*p;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=2*k;a[11]=0;a[12]=(b+f)*
e;a[13]=(h+c)*p;a[14]=(l+m)*k;a[15]=1;return a}},{}],15:[function(k,e,r){e.exports=function(a,b,f,c,h){b=1/Math.tan(b/2);var m=1/(c-h);a[0]=b/f;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=b;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=(h+c)*m;a[11]=-1;a[12]=0;a[13]=0;a[14]=2*h*c*m;a[15]=0;return a}},{}],16:[function(k,e,r){e.exports=function(a,b,f,c){var h=Math.tan(b.upDegrees*Math.PI/180),m=Math.tan(b.downDegrees*Math.PI/180),l=Math.tan(b.leftDegrees*Math.PI/180);b=Math.tan(b.rightDegrees*Math.PI/180);var e=2/(l+b),p=
2/(h+m);a[0]=e;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=p;a[6]=0;a[7]=0;a[8]=-((l-b)*e*.5);a[9]=(h-m)*p*.5;a[10]=c/(f-c);a[11]=-1;a[12]=0;a[13]=0;a[14]=c*f/(f-c);a[15]=0;return a}},{}],17:[function(k,e,r){e.exports=function(a,b,f,c){var h=c[0],m=c[1];c=c[2];var l=Math.sqrt(h*h+m*m+c*c),e,p,k,r,B,y,na,I,E,A,H,C,D,J,L,Z,fa,S,ba,ja;if(1E-6>Math.abs(l))return null;l=1/l;h*=l;m*=l;c*=l;e=Math.sin(f);p=Math.cos(f);k=1-p;f=b[0];l=b[1];r=b[2];B=b[3];y=b[4];na=b[5];I=b[6];E=b[7];A=b[8];H=b[9];C=b[10];D=b[11];J=h*
h*k+p;L=m*h*k+c*e;Z=c*h*k-m*e;fa=h*m*k-c*e;S=m*m*k+p;ba=c*m*k+h*e;ja=h*c*k+m*e;h=m*c*k-h*e;m=c*c*k+p;a[0]=f*J+y*L+A*Z;a[1]=l*J+na*L+H*Z;a[2]=r*J+I*L+C*Z;a[3]=B*J+E*L+D*Z;a[4]=f*fa+y*S+A*ba;a[5]=l*fa+na*S+H*ba;a[6]=r*fa+I*S+C*ba;a[7]=B*fa+E*S+D*ba;a[8]=f*ja+y*h+A*m;a[9]=l*ja+na*h+H*m;a[10]=r*ja+I*h+C*m;a[11]=B*ja+E*h+D*m;b!==a&&(a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);return a}},{}],18:[function(k,e,r){e.exports=function(a,b,f){var c=Math.sin(f);f=Math.cos(f);var h=b[4],m=b[5],l=b[6],e=b[7],
k=b[8],w=b[9],r=b[10],B=b[11];b!==a&&(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);a[4]=h*f+k*c;a[5]=m*f+w*c;a[6]=l*f+r*c;a[7]=e*f+B*c;a[8]=k*f-h*c;a[9]=w*f-m*c;a[10]=r*f-l*c;a[11]=B*f-e*c;return a}},{}],19:[function(k,e,r){e.exports=function(a,b,f){var c=Math.sin(f);f=Math.cos(f);var h=b[0],m=b[1],e=b[2],k=b[3],p=b[8],w=b[9],r=b[10],B=b[11];b!==a&&(a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);a[0]=h*f-p*c;a[1]=
m*f-w*c;a[2]=e*f-r*c;a[3]=k*f-B*c;a[8]=h*c+p*f;a[9]=m*c+w*f;a[10]=e*c+r*f;a[11]=k*c+B*f;return a}},{}],20:[function(k,e,r){e.exports=function(a,b,f){var c=Math.sin(f);f=Math.cos(f);var h=b[0],e=b[1],l=b[2],k=b[3],p=b[4],w=b[5],r=b[6],B=b[7];b!==a&&(a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);a[0]=h*f+p*c;a[1]=e*f+w*c;a[2]=l*f+r*c;a[3]=k*f+B*c;a[4]=p*f-h*c;a[5]=w*f-e*c;a[6]=r*f-l*c;a[7]=B*f-k*c;return a}},{}],21:[function(k,e,r){e.exports=function(a,
b,f){var c=f[0],h=f[1];f=f[2];a[0]=b[0]*c;a[1]=b[1]*c;a[2]=b[2]*c;a[3]=b[3]*c;a[4]=b[4]*h;a[5]=b[5]*h;a[6]=b[6]*h;a[7]=b[7]*h;a[8]=b[8]*f;a[9]=b[9]*f;a[10]=b[10]*f;a[11]=b[11]*f;a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15];return a}},{}],22:[function(k,e,r){e.exports=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"}},{}],23:[function(k,e,r){e.exports=function(a,
b,f){var c=f[0],h=f[1];f=f[2];var e,l,k,p,w,r,B,y,na,I,E,A;b===a?(a[12]=b[0]*c+b[4]*h+b[8]*f+b[12],a[13]=b[1]*c+b[5]*h+b[9]*f+b[13],a[14]=b[2]*c+b[6]*h+b[10]*f+b[14],a[15]=b[3]*c+b[7]*h+b[11]*f+b[15]):(e=b[0],l=b[1],k=b[2],p=b[3],w=b[4],r=b[5],B=b[6],y=b[7],na=b[8],I=b[9],E=b[10],A=b[11],a[0]=e,a[1]=l,a[2]=k,a[3]=p,a[4]=w,a[5]=r,a[6]=B,a[7]=y,a[8]=na,a[9]=I,a[10]=E,a[11]=A,a[12]=e*c+w*h+na*f+b[12],a[13]=l*c+r*h+I*f+b[13],a[14]=k*c+B*h+E*f+b[14],a[15]=p*c+y*h+A*f+b[15]);return a}},{}],24:[function(k,
e,r){e.exports=function(a,b){if(a===b){var f=b[1],c=b[2],h=b[3],e=b[6],k=b[7],z=b[11];a[1]=b[4];a[2]=b[8];a[3]=b[12];a[4]=f;a[6]=b[9];a[7]=b[13];a[8]=c;a[9]=e;a[11]=b[14];a[12]=h;a[13]=k;a[14]=z}else a[0]=b[0],a[1]=b[4],a[2]=b[8],a[3]=b[12],a[4]=b[1],a[5]=b[5],a[6]=b[9],a[7]=b[13],a[8]=b[2],a[9]=b[6],a[10]=b[10],a[11]=b[14],a[12]=b[3],a[13]=b[7],a[14]=b[11],a[15]=b[15];return a}},{}],25:[function(k,e,r){function a(a,f,c,h){h[0]=b(255*a);h[1]=b(255*f);h[2]=b(255*c)}var b=Math.round,f=Math.min,c=Math.max,
h=Math.ceil;e.exports=function(b,e,k,p){p=p||[0,0,0];b%=360;e=c(0,f(e,1));k=c(0,f(k,1));if(e){e=(1-e)*k;var w=k-e,r=b%60;switch(b/60|0){case 0:a(k,w*b/60+e,e,p);break;case 1:a(w*(60-r)/60+e,k,e,p);break;case 2:a(e,k,w*r/60+e,p);break;case 3:a(e,w*(60-r)/60+e,k,p);break;case 4:a(w*r/60+e,e,k,p);break;case 5:a(k,e,w*(60-r)/60+e,p)}}else p[0]=p[1]=p[2]=h(255*k);return p}},{}],26:[function(k,e,r){(function(a,b){"object"===typeof r&&"undefined"!==typeof e?e.exports=b():"function"===typeof define&&define.amd?
define(b):a.createREGL=b()})(this,function(){function a(d){return"undefined"!==typeof btoa?btoa(d):"base64:"+d}function b(d){d=Error("(regl) "+d);console.error(d);throw d;}function f(d,a){d||b(a)}function c(d){return d?": "+d:""}function e(d,a,g){0>a.indexOf(d)&&b("invalid value"+c(g)+". must be one of: "+a)}function k(d,a){for(d+="";d.length<a;)d=" "+d;return d}function l(){this.name="unknown";this.lines=[];this.index={};this.hasErrors=!1}function r(d,a){this.number=d;this.line=a;this.errors=[]}
function p(d,a,b){this.file=d;this.line=a;this.message=b}function w(){var d=Error(),d=(d.stack||d).toString(),a=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(d);return a?a[1]:(d=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(d))?d[1]:"unknown"}function ma(){var d=Error(),d=(d.stack||d).toString(),a=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(d);return a?a[1]:(d=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(d))?d[1]:"unknown"}function B(d,b){var g=d.split("\n"),f=1,c=0,e={unknown:new l,0:new l};e.unknown.name=
e[0].name=b||w();e.unknown.lines.push(new r(0,""));for(var k=0;k<g.length;++k){var h=g[k],q=/^\s*\#\s*(\w+)\s+(.+)\s*$/.exec(h);if(q)switch(q[1]){case "line":if(q=/(\d+)(\s+\d+)?/.exec(q[2]))f=q[1]|0,q[2]&&(c=q[2]|0,c in e||(e[c]=new l));break;case "define":if(q=/SHADER_NAME(_B64)?\s+(.*)$/.exec(q[2]))e[c].name=q[1]?a(q[2]):q[2]}e[c].lines.push(new r(f++,h))}Object.keys(e).forEach(function(d){var a=e[d];a.lines.forEach(function(d){a.index[d.number]=d})});return e}function y(d){var a=[];d.split("\n").forEach(function(d){if(!(5>
d.length)){var b=/^ERROR\:\s+(\d+)\:(\d+)\:\s*(.*)$/.exec(d);b?a.push(new p(b[1]|0,b[2]|0,b[3].trim())):0<d.length&&a.push(new p("unknown",0,d))}});return a}function na(d,a){a.forEach(function(a){var b=d[a.file];if(b){var n=b.index[a.line];if(n){n.errors.push(a);b.hasErrors=!0;return}}d.unknown.hasErrors=!0;d.unknown.lines[0].errors.push(a)})}function I(d){d._commandRef=w()}function E(d,a){var g=ma();b(d+" in command "+(a||w())+("unknown"===g?"":" called from "+g))}function A(d,a,b,g){typeof d!==
a&&E("invalid parameter type"+c(b)+". expected "+a+", got "+typeof d,g||w())}function H(d,a){return 32820===d||32819===d||33635===d?2:34042===d?4:ka[d]*a}function C(d,a){this.id=Pb++;this.type=d;this.data=a}function D(d){if(0===d.length)return[];var a=d.charAt(0),b=d.charAt(d.length-1);if(1<d.length&&a===b&&('"'===a||"'"===a))return['"'+d.substr(1,d.length-2).replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];if(a=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(d))return D(d.substr(0,a.index)).concat(D(a[1])).concat(D(d.substr(a.index+
a[0].length)));a=d.split(".");if(1===a.length)return['"'+d.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];d=[];for(b=0;b<a.length;++b)d=d.concat(D(a[b]));return d}function J(d){return"["+D(d).join("][")+"]"}function L(){var d={"":0},a=[""];return{id:function(b){var g=d[b];if(g)return g;g=d[b]=a.length;a.push(b);return g},str:function(d){return a[d]}}}function Z(d,a,b){function g(){var a=window.innerWidth,n=window.innerHeight;d!==document.body&&(n=d.getBoundingClientRect(),a=n.right-n.left,n=n.bottom-
n.top);f.width=b*a;f.height=b*n;Y(f.style,{width:a+"px",height:n+"px"})}var f=document.createElement("canvas");Y(f.style,{border:0,margin:0,padding:0,top:0,left:0});d.appendChild(f);d===document.body&&(f.style.position="absolute",Y(d.style,{margin:0,padding:0}));window.addEventListener("resize",g,!1);g();return{canvas:f,onDestroy:function(){window.removeEventListener("resize",g);d.removeChild(f)}}}function fa(a,b){function g(u){try{return a.getContext(u,b)}catch(f){return null}}return g("webgl")||
g("experimental-webgl")||g("webgl-experimental")}function S(a){if("string"===typeof a)return a.split();g(Array.isArray(a),"invalid extension array");return a}function ba(a){return"string"===typeof a?(g("undefined"!==typeof document,"not supported outside of DOM"),document.querySelector(a)):a}function ja(a){var b=a||{},u,f,c,e;a={};var k=[],h=[],q="undefined"===typeof window?1:window.devicePixelRatio,F=!1,Aa=function(a){a&&g.raise(a)},va=function(){};"string"===typeof b?(g("undefined"!==typeof document,
"selector queries only supported in DOM enviroments"),u=document.querySelector(b),g(u,"invalid query string for element")):"object"===typeof b?"string"===typeof b.nodeName&&"function"===typeof b.appendChild&&"function"===typeof b.getBoundingClientRect?u=b:"function"===typeof b.drawArrays||"function"===typeof b.drawElements?(e=b,c=e.canvas):(g.constructor(b),"gl"in b?e=b.gl:"canvas"in b?c=ba(b.canvas):"container"in b&&(f=ba(b.container)),"attributes"in b&&(a=b.attributes,g.type(a,"object","invalid context attributes")),
"extensions"in b&&(k=S(b.extensions)),"optionalExtensions"in b&&(h=S(b.optionalExtensions)),"onDone"in b&&(g.type(b.onDone,"function","invalid or missing onDone callback"),Aa=b.onDone),"profile"in b&&(F=!!b.profile),"pixelRatio"in b&&(q=+b.pixelRatio,g(0<q,"invalid pixel ratio"))):g.raise("invalid arguments to regl");u&&("canvas"===u.nodeName.toLowerCase()?c=u:f=u);if(!e){if(!c){g("undefined"!==typeof document,"must manually specify webgl context outside of DOM environments");u=Z(f||document.body,
Aa,q);if(!u)return null;c=u.canvas;va=u.onDestroy}e=fa(c,a)}return e?{gl:e,canvas:c,container:f,extensions:k,optionalExtensions:h,pixelRatio:q,profile:F,onDone:Aa,onDestroy:va}:(va(),Aa("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function Ia(a,b){function u(b){g.type(b,"string","extension name must be string");b=b.toLowerCase();var n;try{n=f[b]=a.getExtension(b)}catch(u){}return!!n}for(var f={},c=0;c<b.extensions.length;++c){var e=b.extensions[c];
if(!u(e))return b.onDestroy(),b.onDone('"'+e+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}b.optionalExtensions.forEach(u);return{extensions:f,restore:function(){Object.keys(f).forEach(function(a){if(!u(a))throw Error("(regl): error restoring extension "+a);})}}}function T(a){return!!a&&"object"===typeof a&&Array.isArray(a.shape)&&Array.isArray(a.stride)&&"number"===typeof a.offset&&a.shape.length===a.stride.length&&(Array.isArray(a.data)||
ca(a.data))}function U(a,b){for(var g=Array(a),f=0;f<a;++f)g[f]=b(f);return g}function K(a){var b,g;b=(65535<a)<<4;a>>>=b;g=(255<a)<<3;a>>>=g;b|=g;g=(15<a)<<2;a>>>=g;b|=g;g=(3<a)<<1;return b|g|a>>>g>>1}function oa(a){a:{for(var b=16;268435456>=b;b*=16)if(a<=b){a=b;break a}a=0}b=rb[K(a)>>2];return 0<b.length?b.pop():new ArrayBuffer(a)}function sb(a){rb[K(a.byteLength)>>2].push(a)}function tb(a,b,g,f,c,e){for(var k=0;k<b;++k)for(var h=a[k],q=0;q<g;++q)for(var F=h[q],Aa=0;Aa<f;++Aa)c[e++]=F[Aa]}function ub(a,
b,g,f,c){for(var e=1,k=g+1;k<b.length;++k)e*=b[k];var h=b[g];if(4===b.length-g){var q=b[g+1],F=b[g+2];b=b[g+3];for(k=0;k<h;++k)tb(a[k],q,F,b,f,c),c+=e}else for(k=0;k<h;++k)ub(a[k],b,g+1,f,c),c+=e}function db(a){return Xa[Object.prototype.toString.call(a)]|0}function vb(a,b){for(var g=0;g<b.length;++g)a[g]=b[g]}function wb(a,b,g,f,c,e,k){for(var h=0,q=0;q<g;++q)for(var F=0;F<f;++F)a[h++]=b[c*q+e*F+k]}function Qb(a,b,f){function c(b){this.id=m++;this.buffer=a.createBuffer();this.type=b;this.usage=35044;
this.byteLength=0;this.dimension=1;this.dtype=5121;this.persistentData=null;f.profile&&(this.stats={size:0})}function e(b,g,f){b.byteLength=g.byteLength;a.bufferData(b.type,g,f)}function k(a,b,d,f,n,c){a.usage=d;if(Array.isArray(b)){if(a.dtype=f||5126,0<b.length)if(Array.isArray(b[0])){n=xb(b);for(var u=f=1;u<n.length;++u)f*=n[u];a.dimension=f;b=kb(b,n,a.dtype);e(a,b,d);c?a.persistentData=b:R.freeType(b)}else"number"===typeof b[0]?(a.dimension=n,n=R.allocType(a.dtype,b.length),vb(n,b),e(a,n,d),c?
a.persistentData=n:R.freeType(n)):ca(b[0])?(a.dimension=b[0].length,a.dtype=f||db(b[0])||5126,b=kb(b,[b.length,b[0].length],a.dtype),e(a,b,d),c?a.persistentData=b:R.freeType(b)):g.raise("invalid buffer data")}else if(ca(b))a.dtype=f||db(b),a.dimension=n,e(a,b,d),c&&(a.persistentData=new Uint8Array(new Uint8Array(b.buffer)));else if(T(b)){n=b.shape;var h=b.stride,u=b.offset,q=0,V=0,F=0,m=0;1===n.length?(q=n[0],V=1,F=h[0],m=0):2===n.length?(q=n[0],V=n[1],F=h[0],m=h[1]):g.raise("invalid shape");a.dtype=
f||db(b.data)||5126;a.dimension=V;n=R.allocType(a.dtype,q*V);wb(n,b.data,q,V,F,m,u);e(a,n,d);c?a.persistentData=n:R.freeType(n)}else g.raise("invalid buffer data")}function h(f){b.bufferCount--;var c=f.buffer;g(c,"buffer must not be deleted already");a.deleteBuffer(c);f.buffer=null;delete q[f.id]}var m=0,q={};c.prototype.bind=function(){a.bindBuffer(this.type,this.buffer)};c.prototype.destroy=function(){h(this)};var F=[];f.profile&&(b.getTotalBufferSize=function(){var a=0;Object.keys(q).forEach(function(b){a+=
q[b].stats.size});return a});return{create:function(e,va,F,x){function v(b){var n=35044,c=null,e=0,h=0,q=1;Array.isArray(b)||ca(b)||T(b)?c=b:"number"===typeof b?e=b|0:b&&(g.type(b,"object","buffer arguments must be an object, a number or an array"),"data"in b&&(g(null===c||Array.isArray(c)||ca(c)||T(c),"invalid data for buffer"),c=b.data),"usage"in b&&(g.parameter(b.usage,eb,"invalid buffer usage"),n=eb[b.usage]),"type"in b&&(g.parameter(b.type,Ya,"invalid buffer type"),h=Ya[b.type]),"dimension"in
b&&(g.type(b.dimension,"number","invalid dimension"),q=b.dimension|0),"length"in b&&(g.nni(e,"buffer length must be a nonnegative integer"),e=b.length|0));M.bind();c?k(M,c,n,h,q,x):(a.bufferData(M.type,e,n),M.dtype=h||5121,M.usage=n,M.dimension=q,M.byteLength=e);f.profile&&(M.stats.size=M.byteLength*wa[M.dtype]);return v}function m(b,n){g(n+b.byteLength<=M.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+b.byteLength+" starting from offset "+n+" to a buffer of size "+
M.byteLength);a.bufferSubData(M.type,n,b)}b.bufferCount++;var M=new c(va);q[M.id]=M;F||v(e);v._reglType="buffer";v._buffer=M;v.subdata=function(a,b){var d=(b||0)|0,n;M.bind();if(Array.isArray(a)){if(0<a.length)if("number"===typeof a[0]){var f=R.allocType(M.dtype,a.length);vb(f,a);m(f,d);R.freeType(f)}else Array.isArray(a[0])||ca(a[0])?(n=xb(a),f=kb(a,n,M.dtype),m(f,d),R.freeType(f)):g.raise("invalid buffer data")}else if(ca(a))m(a,d);else if(T(a)){n=a.shape;var c=a.stride,e=f=0,u=0,k=0;1===n.length?
(f=n[0],e=1,u=c[0],k=0):2===n.length?(f=n[0],e=n[1],u=c[0],k=c[1]):g.raise("invalid shape");n=Array.isArray(a.data)?M.dtype:db(a.data);n=R.allocType(n,f*e);wb(n,a.data,f,e,u,k,a.offset);m(n,d);R.freeType(n)}else g.raise("invalid data for buffer subdata");return v};f.profile&&(v.stats=M.stats);v.destroy=function(){h(M)};return v},createStream:function(a,b){var d=F.pop();d||(d=new c(a));d.bind();k(d,b,35040,0,1,!1);return d},destroyStream:function(a){F.push(a)},clear:function(){da(q).forEach(h);F.forEach(h)},
getBuffer:function(a){return a&&a._buffer instanceof c?a._buffer:null},restore:function(){da(q).forEach(function(b){b.buffer=a.createBuffer();a.bindBuffer(b.type,b.buffer);a.bufferData(b.type,b.persistentData||b.byteLength,b.usage)})},_initBuffer:k}}function Rb(a,b,f,c){function e(a){this.id=q++;m[this.id]=this;this.buffer=a;this.primType=4;this.type=this.vertCount=0}function k(c,e,h,v,q,m,F){c.buffer.bind();if(e){var V=F;F||ca(e)&&(!T(e)||ca(e.data))||(V=b.oes_element_index_uint?5125:5123);f._initBuffer(c.buffer,
e,h,V,3)}else a.bufferData(34963,m,h),c.buffer.dtype=V||5121,c.buffer.usage=h,c.buffer.dimension=3,c.buffer.byteLength=m;V=F;if(!F){switch(c.buffer.dtype){case 5121:case 5120:V=5121;break;case 5123:case 5122:V=5123;break;case 5125:case 5124:V=5125;break;default:g.raise("unsupported type for element array")}c.buffer.dtype=V}c.type=V;g(5125!==V||!!b.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");e=q;0>e&&(e=c.buffer.byteLength,5123===V?e>>=1:5125===
V&&(e>>=2));c.vertCount=e;e=v;0>v&&(e=4,v=c.buffer.dimension,1===v&&(e=0),2===v&&(e=1),3===v&&(e=4));c.primType=e}function h(a){c.elementsCount--;g(null!==a.buffer,"must not double destroy elements");delete m[a.id];a.buffer.destroy();a.buffer=null}var m={},q=0,F={uint8:5121,uint16:5123};b.oes_element_index_uint&&(F.uint32=5125);e.prototype.bind=function(){this.buffer.bind()};var l=[];return{create:function(a,b){function d(a){if(a)if("number"===typeof a)n(a),q.primType=4,q.vertCount=a|0,q.type=5121;
else{var b=null,f=35044,c=-1,e=-1,u=0,h=0;if(Array.isArray(a)||ca(a)||T(a))b=a;else if(g.type(a,"object","invalid arguments for elements"),"data"in a&&(b=a.data,g(Array.isArray(b)||ca(b)||T(b),"invalid data for element buffer")),"usage"in a&&(g.parameter(a.usage,eb,"invalid element buffer usage"),f=eb[a.usage]),"primitive"in a&&(g.parameter(a.primitive,Na,"invalid element buffer primitive"),c=Na[a.primitive]),"count"in a&&(g("number"===typeof a.count&&0<=a.count,"invalid vertex count for elements"),
e=a.count|0),"type"in a&&(g.parameter(a.type,F,"invalid buffer type"),h=F[a.type]),"length"in a)u=a.length|0;else if(u=e,5123===h||5122===h)u*=2;else if(5125===h||5124===h)u*=4;k(q,b,f,c,e,u,h)}else n(),q.primType=4,q.vertCount=0,q.type=5121;return d}var n=f.create(null,34963,!0),q=new e(n._buffer);c.elementsCount++;d(a);d._reglType="elements";d._elements=q;d.subdata=function(a,b){n.subdata(a,b);return d};d.destroy=function(){h(q)};return d},createStream:function(a){var b=l.pop();b||(b=new e(f.create(null,
34963,!0,!1)._buffer));k(b,a,35040,-1,-1,0,0);return b},destroyStream:function(a){l.push(a)},getElements:function(a){return"function"===typeof a&&a._elements instanceof e?a._elements:null},clear:function(){da(m).forEach(h)}}}function yb(a){for(var b=R.allocType(5123,a.length),g=0;g<a.length;++g)if(isNaN(a[g]))b[g]=65535;else if(Infinity===a[g])b[g]=31744;else if(-Infinity===a[g])b[g]=64512;else{zb[0]=a[g];var f=Sb[0],c=f>>>31<<15,e=(f<<1>>>24)-127,f=f>>13&1023;b[g]=-24>e?c:-14>e?c+(f+1024>>-14-e):
15<e?c+31744:c+(e+15<<10)+f}return b}function W(a){return Array.isArray(a)||ca(a)}function Ab(a){return Array.isArray(a)&&(0===a.length||"number"===typeof a[0])}function Bb(a){return Array.isArray(a)&&0!==a.length&&W(a[0])?!0:!1}function Oa(a){return Object.prototype.toString.call(a)}function mb(a){if(!a)return!1;var b=Oa(a);return 0<=Tb.indexOf(b)?!0:Ab(a)||Bb(a)||T(a)}function Cb(a,b){36193===a.type?(a.data=yb(b),R.freeType(b)):a.data=b}function fb(a,b,g,f,c,e){a="undefined"!==typeof N[a]?N[a]:
la[a]*Pa[b];e&&(a*=6);if(c){for(f=0;1<=g;)f+=a*g*g,g/=2;return f}return a*g*f}function Ub(a,b,f,c,e,h,k){function m(){this.format=this.internalformat=6408;this.type=5121;this.flipY=this.premultiplyAlpha=this.compressed=!1;this.unpackAlignment=1;this.channels=this.height=this.width=this.colorSpace=0}function q(a,b){a.internalformat=b.internalformat;a.format=b.format;a.type=b.type;a.compressed=b.compressed;a.premultiplyAlpha=b.premultiplyAlpha;a.flipY=b.flipY;a.unpackAlignment=b.unpackAlignment;a.colorSpace=
b.colorSpace;a.width=b.width;a.height=b.height;a.channels=b.channels}function F(a,d){if("object"===typeof d&&d){"premultiplyAlpha"in d&&(g.type(d.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),a.premultiplyAlpha=d.premultiplyAlpha);"flipY"in d&&(g.type(d.flipY,"boolean","invalid texture flip"),a.flipY=d.flipY);"alignment"in d&&(g.oneOf(d.alignment,[1,2,4,8],"invalid texture unpack alignment"),a.unpackAlignment=d.alignment);"colorSpace"in d&&(g.parameter(d.colorSpace,Db,"invalid colorSpace"),
a.colorSpace=Db[d.colorSpace]);if("type"in d){var c=d.type;g(b.oes_texture_float||!("float"===c||"float32"===c),"you must enable the OES_texture_float extension in order to use floating point textures.");g(b.oes_texture_half_float||!("half float"===c||"float16"===c),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures.");g(b.webgl_depth_texture||!("uint16"===c||"uint32"===c||"depth stencil"===c),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures.");
g.parameter(c,aa,"invalid texture type");a.type=aa[c]}var e=a.width,h=a.height,k=a.channels,c=!1;"shape"in d?(g(Array.isArray(d.shape)&&2<=d.shape.length,"shape must be an array"),e=d.shape[0],h=d.shape[1],3===d.shape.length&&(k=d.shape[2],g(0<k&&4>=k,"invalid number of channels"),c=!0),g(0<=e&&e<=f.maxTextureSize,"invalid width"),g(0<=h&&h<=f.maxTextureSize,"invalid height")):("radius"in d&&(e=h=d.radius,g(0<=e&&e<=f.maxTextureSize,"invalid radius")),"width"in d&&(e=d.width,g(0<=e&&e<=f.maxTextureSize,
"invalid width")),"height"in d&&(h=d.height,g(0<=h&&h<=f.maxTextureSize,"invalid height")),"channels"in d&&(k=d.channels,g(0<k&&4>=k,"invalid number of channels"),c=!0));a.width=e|0;a.height=h|0;a.channels=k|0;e=!1;"format"in d&&(e=d.format,g(b.webgl_depth_texture||!("depth"===e||"depth stencil"===e),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),g.parameter(e,Q,"invalid texture format"),h=a.internalformat=Q[e],a.format=nb[h],e in aa&&!("type"in d)&&(a.type=
aa[e]),e in C&&(a.compressed=!0),e=!0);!c&&e?a.channels=la[a.format]:c&&!e?a.channels!==gb[a.format]&&(a.format=a.internalformat=gb[a.channels]):e&&c&&g(a.channels===la[a.format],"number of channels inconsistent with specified format")}}function l(b){a.pixelStorei(37440,b.flipY);a.pixelStorei(37441,b.premultiplyAlpha);a.pixelStorei(37443,b.colorSpace);a.pixelStorei(3317,b.unpackAlignment)}function p(){m.call(this);this.yOffset=this.xOffset=0;this.data=null;this.needsFree=!1;this.element=null;this.needsCopy=
!1}function r(a,b){var d=null;mb(b)?d=b:b&&(g.type(b,"object","invalid pixel data type"),F(a,b),"x"in b&&(a.xOffset=b.x|0),"y"in b&&(a.yOffset=b.y|0),mb(b.data)&&(d=b.data));g(!a.compressed||d instanceof Uint8Array,"compressed texture data must be stored in a uint8array");if(b.copy){g(!d,"can not specify copy and data field for the same texture");var c=e.viewportWidth,n=e.viewportHeight;a.width=a.width||c-a.xOffset;a.height=a.height||n-a.yOffset;a.needsCopy=!0;g(0<=a.xOffset&&a.xOffset<c&&0<=a.yOffset&&
a.yOffset<n&&0<a.width&&a.width<=c&&0<a.height&&a.height<=n,"copy texture read out of bounds")}else if(!d)a.width=a.width||1,a.height=a.height||1,a.channels=a.channels||4;else if(ca(d))a.channels=a.channels||4,a.data=d,"type"in b||5121!==a.type||(a.type=Xa[Object.prototype.toString.call(d)]|0);else if(Ab(d)){a.channels=a.channels||4;c=d;n=c.length;switch(a.type){case 5121:case 5123:case 5125:case 5126:n=R.allocType(a.type,n);n.set(c);a.data=n;break;case 36193:a.data=yb(c);break;default:g.raise("unsupported texture type, must specify a typed array")}a.alignment=
1;a.needsFree=!0}else if(T(d)){c=d.data;Array.isArray(c)||5121!==a.type||(a.type=Xa[Object.prototype.toString.call(c)]|0);var n=d.shape,h=d.stride,k,q,t,X;3===n.length?(t=n[2],X=h[2]):(g(2===n.length,"invalid ndarray pixel data, must be 2 or 3D"),X=t=1);k=n[0];q=n[1];n=h[0];h=h[1];a.alignment=1;a.width=k;a.height=q;a.channels=t;a.format=a.internalformat=gb[t];a.needsFree=!0;k=X;d=d.offset;t=a.width;X=a.height;q=a.channels;for(var qa=R.allocType(36193===a.type?5126:a.type,t*X*q),ra=0,Ja=0;Ja<X;++Ja)for(var Ka=
0;Ka<t;++Ka)for(var ob=0;ob<q;++ob)qa[ra++]=c[n*Ka+h*Ja+k*ob+d];Cb(a,qa)}else if("[object HTMLCanvasElement]"===Oa(d)||"[object CanvasRenderingContext2D]"===Oa(d))"[object HTMLCanvasElement]"===Oa(d)?a.element=d:a.element=d.canvas,a.width=a.element.width,a.height=a.element.height,a.channels=4;else if("[object HTMLImageElement]"===Oa(d))a.element=d,a.width=d.naturalWidth,a.height=d.naturalHeight,a.channels=4;else if("[object HTMLVideoElement]"===Oa(d))a.element=d,a.width=d.videoWidth,a.height=d.videoHeight,
a.channels=4;else if(Bb(d)){c=a.width||d[0].length;n=a.height||d.length;h=a.channels;h=W(d[0][0])?h||d[0][0].length:h||1;k=hb.shape(d);t=1;for(X=0;X<k.length;++X)t*=k[X];t=R.allocType(36193===a.type?5126:a.type,t);hb.flatten(d,k,"",t);Cb(a,t);a.alignment=1;a.width=c;a.height=n;a.channels=h;a.format=a.internalformat=gb[h];a.needsFree=!0}5126===a.type?g(0<=f.extensions.indexOf("oes_texture_float"),"oes_texture_float extension not enabled"):36193===a.type&&g(0<=f.extensions.indexOf("oes_texture_half_float"),
"oes_texture_half_float extension not enabled")}function x(b,g,f,e,n){var h=b.element,k=b.data,q=b.internalformat,t=b.format,X=b.type,qa=b.width,ra=b.height;l(b);h?a.texSubImage2D(g,n,f,e,t,X,h):b.compressed?a.compressedTexSubImage2D(g,n,f,e,q,qa,ra,k):b.needsCopy?(c(),a.copyTexSubImage2D(g,n,f,e,b.xOffset,b.yOffset,qa,ra)):a.texSubImage2D(g,n,f,e,qa,ra,t,X,k)}function v(){return P.pop()||new p}function w(a){a.needsFree&&R.freeType(a.data);p.call(a);P.push(a)}function M(){m.call(this);this.genMipmaps=
!1;this.mipmapHint=4352;this.mipmask=0;this.images=Array(16)}function Ba(a,b,d){var g=a.images[0]=v();a.mipmask=1;g.width=a.width=b;g.height=a.height=d;g.channels=a.channels=4}function ha(a,b){var d=null;if(mb(b))d=a.images[0]=v(),q(d,a),r(d,b),a.mipmask=1;else if(F(a,b),Array.isArray(b.mipmap))for(var c=b.mipmap,f=0;f<c.length;++f)d=a.images[f]=v(),q(d,a),d.width>>=f,d.height>>=f,r(d,c[f]),a.mipmask|=1<<f;else d=a.images[0]=v(),q(d,a),r(d,b),a.mipmask=1;q(a,a.images[0]);(a.compressed&&33776===a.internalformat||
33777===a.internalformat||33778===a.internalformat||33779===a.internalformat)&&g(0===a.width%4&&0===a.height%4,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function z(b,g){for(var f=b.images,e=0;e<f.length&&f[e];++e){var n=f[e],h=g,k=e,q=n.element,t=n.data,X=n.internalformat,qa=n.format,ra=n.type,Ja=n.width,Ka=n.height;l(n);q?a.texImage2D(h,k,qa,qa,ra,q):n.compressed?a.compressedTexImage2D(h,k,X,Ja,Ka,0,t):n.needsCopy?(c(),a.copyTexImage2D(h,
k,qa,n.xOffset,n.yOffset,Ja,Ka,0)):a.texImage2D(h,k,qa,Ja,Ka,0,qa,ra,t)}}function B(){var a=U.pop()||new M;m.call(a);for(var b=a.mipmask=0;16>b;++b)a.images[b]=null;return a}function y(a){for(var b=a.images,d=0;d<b.length;++d)b[d]&&w(b[d]),b[d]=null;U.push(a)}function E(){this.magFilter=this.minFilter=9728;this.wrapT=this.wrapS=33071;this.anisotropic=1;this.genMipmaps=!1;this.mipmapHint=4352}function A(a,b){if("min"in b){var d=b.min;g.parameter(d,Fa);a.minFilter=Fa[d];0<=Vb.indexOf(a.minFilter)&&
(a.genMipmaps=!0)}"mag"in b&&(d=b.mag,g.parameter(d,ab),a.magFilter=ab[d]);var d=a.wrapS,c=a.wrapT;if("wrap"in b){var e=b.wrap;"string"===typeof e?(g.parameter(e,D),d=c=D[e]):Array.isArray(e)&&(g.parameter(e[0],D),g.parameter(e[1],D),d=D[e[0]],c=D[e[1]])}else"wrapS"in b&&(d=b.wrapS,g.parameter(d,D),d=D[d]),"wrapT"in b&&(c=b.wrapT,g.parameter(c,D),c=D[c]);a.wrapS=d;a.wrapT=c;"anisotropic"in b&&(d=b.anisotropic,g("number"===typeof d&&1<=d&&d<=f.maxAnisotropic,"aniso samples must be between 1 and "),
a.anisotropic=b.anisotropic);if("mipmap"in b){d=!1;switch(typeof b.mipmap){case "string":g.parameter(b.mipmap,G,"invalid mipmap hint");a.mipmapHint=G[b.mipmap];d=a.genMipmaps=!0;break;case "boolean":d=a.genMipmaps=b.mipmap;break;case "object":g(Array.isArray(b.mipmap),"invalid mipmap type");a.genMipmaps=!1;d=!0;break;default:g.raise("invalid mipmap type")}!d||"min"in b||(a.minFilter=9984)}}function H(g,c){a.texParameteri(c,10241,g.minFilter);a.texParameteri(c,10240,g.magFilter);a.texParameteri(c,
10242,g.wrapS);a.texParameteri(c,10243,g.wrapT);b.ext_texture_filter_anisotropic&&a.texParameteri(c,34046,g.anisotropic);g.genMipmaps&&(a.hint(33170,g.mipmapHint),a.generateMipmap(c))}function lb(b){m.call(this);this.mipmask=0;this.internalformat=6408;this.id=Wb++;this.refCount=1;this.target=b;this.texture=a.createTexture();this.unit=-1;this.bindCount=0;this.texInfo=new E;k.profile&&(this.stats={size:0})}function Qa(b){a.activeTexture(33984);a.bindTexture(b.target,b.texture)}function Ra(){var b=xa[0];
b?a.bindTexture(b.target,b.texture):a.bindTexture(3553,null)}function Eb(b){var c=b.texture;g(c,"must not double destroy texture");var e=b.unit,f=b.target;0<=e&&(a.activeTexture(33984+e),a.bindTexture(f,null),xa[e]=null);a.deleteTexture(c);b.texture=null;b.params=null;b.pixels=null;b.refCount=0;delete ga[b.id];h.textureCount--}var G={"don't care":4352,"dont care":4352,nice:4354,fast:4353},D={repeat:10497,clamp:33071,mirror:33648},ab={nearest:9728,linear:9729},Fa=Y({mipmap:9987,"nearest mipmap nearest":9984,
"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":9987},ab),Db={none:0,browser:37444},aa={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},Q={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},C={};b.ext_srgb&&(Q.srgb=35904,Q.srgba=35906);b.oes_texture_float&&(aa.float32=aa["float"]=5126);b.oes_texture_half_float&&(aa.float16=aa["half float"]=36193);b.webgl_depth_texture&&(Y(Q,{depth:6402,"depth stencil":34041}),
Y(aa,{uint16:5123,uint32:5125,"depth stencil":34042}));b.webgl_compressed_texture_s3tc&&Y(C,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779});b.webgl_compressed_texture_atc&&Y(C,{"rgb atc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798});b.webgl_compressed_texture_pvrtc&&Y(C,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,"rgba pvrtc 2bppv1":35843});b.webgl_compressed_texture_etc1&&(C["rgb etc1"]=36196);
var J=Array.prototype.slice.call(a.getParameter(34467));Object.keys(C).forEach(function(a){var b=C[a];0<=J.indexOf(b)&&(Q[a]=b)});var I=Object.keys(Q);f.textureFormats=I;var L=[];Object.keys(Q).forEach(function(a){L[Q[a]]=a});var K=[];Object.keys(aa).forEach(function(a){K[aa[a]]=a});var bb=[];Object.keys(ab).forEach(function(a){bb[ab[a]]=a});var La=[];Object.keys(Fa).forEach(function(a){La[Fa[a]]=a});var Ma=[];Object.keys(D).forEach(function(a){Ma[D[a]]=a});var nb=I.reduce(function(a,b){var d=Q[b];
6409===d||6406===d||6409===d||6410===d||6402===d||34041===d?a[d]=d:32855===d||0<=b.indexOf("rgba")?a[d]=6408:a[d]=6407;return a},{}),P=[],U=[],Wb=0,ga={},N=f.maxTextureUnits,xa=Array(N).map(function(){return null});Y(lb.prototype,{bind:function(){this.bindCount+=1;var b=this.unit;if(0>b){for(var c=0;c<N;++c){var e=xa[c];if(e){if(0<e.bindCount)continue;e.unit=-1}xa[c]=this;b=c;break}b>=N&&g.raise("insufficient number of texture units");k.profile&&h.maxTextureUnits<b+1&&(h.maxTextureUnits=b+1);this.unit=
b;a.activeTexture(33984+b);a.bindTexture(this.target,this.texture)}return b},unbind:function(){--this.bindCount},decRef:function(){0>=--this.refCount&&Eb(this)}});k.profile&&(h.getTotalTextureSize=function(){var a=0;Object.keys(ga).forEach(function(b){a+=ga[b].stats.size});return a});return{create2D:function(b,c){function e(a,b){var d=n.texInfo;E.call(d);var c=B();"number"===typeof a?"number"===typeof b?Ba(c,a|0,b|0):Ba(c,a|0,a|0):a?(g.type(a,"object","invalid arguments to regl.texture"),A(d,a),ha(c,
a)):Ba(c,1,1);d.genMipmaps&&(c.mipmask=(c.width<<1)-1);n.mipmask=c.mipmask;q(n,c);g.texture2D(d,c,f);n.internalformat=c.internalformat;e.width=c.width;e.height=c.height;Qa(n);z(c,3553);H(d,3553);Ra();y(c);k.profile&&(n.stats.size=fb(n.internalformat,n.type,c.width,c.height,d.genMipmaps,!1));e.format=L[n.internalformat];e.type=K[n.type];e.mag=bb[d.magFilter];e.min=La[d.minFilter];e.wrapS=Ma[d.wrapS];e.wrapT=Ma[d.wrapT];return e}var n=new lb(3553);ga[n.id]=n;h.textureCount++;e(b,c);e.subimage=function(a,
b,d,c){g(!!a,"must specify image data");b|=0;d|=0;c|=0;var t=v();q(t,n);t.width=0;t.height=0;r(t,a);t.width=t.width||(n.width>>c)-b;t.height=t.height||(n.height>>c)-d;g(n.type===t.type&&n.format===t.format&&n.internalformat===t.internalformat,"incompatible format for texture.subimage");g(0<=b&&0<=d&&b+t.width<=n.width&&d+t.height<=n.height,"texture.subimage write out of bounds");g(n.mipmask&1<<c,"missing mipmap data");g(t.data||t.element||t.needsCopy,"missing image data");Qa(n);x(t,3553,b,d,c);Ra();
w(t);return e};e.resize=function(b,g){var c=b|0,f=g|0||c;if(c===n.width&&f===n.height)return e;e.width=n.width=c;e.height=n.height=f;Qa(n);for(var t=0;n.mipmask>>t;++t)a.texImage2D(3553,t,n.format,c>>t,f>>t,0,n.format,n.type,null);Ra();k.profile&&(n.stats.size=fb(n.internalformat,n.type,c,f,!1,!1));return e};e._reglType="texture2d";e._texture=n;k.profile&&(e.stats=n.stats);e.destroy=function(){n.decRef()};return e},createCube:function(b,c,e,n,m,V){function l(a,b,d,c,e,n){var O,ia=G.texInfo;E.call(ia);
for(O=0;6>O;++O)t[O]=B();if("number"!==typeof a&&a)if("object"===typeof a)if(b)ha(t[0],a),ha(t[1],b),ha(t[2],d),ha(t[3],c),ha(t[4],e),ha(t[5],n);else if(A(ia,a),F(G,a),"faces"in a)for(a=a.faces,g(Array.isArray(a)&&6===a.length,"cube faces must be a length 6 array"),O=0;6>O;++O)g("object"===typeof a[O]&&!!a[O],"invalid input for cube map face"),q(t[O],G),ha(t[O],a[O]);else for(O=0;6>O;++O)ha(t[O],a);else g.raise("invalid arguments to cube map");else for(a=a|0||1,O=0;6>O;++O)Ba(t[O],a,a);q(G,t[0]);
G.mipmask=ia.genMipmaps?(t[0].width<<1)-1:t[0].mipmask;g.textureCube(G,ia,t,f);G.internalformat=t[0].internalformat;l.width=t[0].width;l.height=t[0].height;Qa(G);for(O=0;6>O;++O)z(t[O],34069+O);H(ia,34067);Ra();k.profile&&(G.stats.size=fb(G.internalformat,G.type,l.width,l.height,ia.genMipmaps,!0));l.format=L[G.internalformat];l.type=K[G.type];l.mag=bb[ia.magFilter];l.min=La[ia.minFilter];l.wrapS=Ma[ia.wrapS];l.wrapT=Ma[ia.wrapT];for(O=0;6>O;++O)y(t[O]);return l}var G=new lb(34067);ga[G.id]=G;h.cubeCount++;
var t=Array(6);l(b,c,e,n,m,V);l.subimage=function(a,b,d,c,t){g(!!b,"must specify image data");g("number"===typeof a&&a===(a|0)&&0<=a&&6>a,"invalid face");d|=0;c|=0;t|=0;var e=v();q(e,G);e.width=0;e.height=0;r(e,b);e.width=e.width||(G.width>>t)-d;e.height=e.height||(G.height>>t)-c;g(G.type===e.type&&G.format===e.format&&G.internalformat===e.internalformat,"incompatible format for texture.subimage");g(0<=d&&0<=c&&d+e.width<=G.width&&c+e.height<=G.height,"texture.subimage write out of bounds");g(G.mipmask&
1<<t,"missing mipmap data");g(e.data||e.element||e.needsCopy,"missing image data");Qa(G);x(e,34069+a,d,c,t);Ra();w(e);return l};l.resize=function(b){b|=0;if(b!==G.width){l.width=G.width=b;l.height=G.height=b;Qa(G);for(var g=0;6>g;++g)for(var c=0;G.mipmask>>c;++c)a.texImage2D(34069+g,c,G.format,b>>c,b>>c,0,G.format,G.type,null);Ra();k.profile&&(G.stats.size=fb(G.internalformat,G.type,l.width,l.height,!1,!0));return l}};l._reglType="textureCube";l._texture=G;k.profile&&(l.stats=G.stats);l.destroy=function(){G.decRef()};
return l},clear:function(){for(var b=0;b<N;++b)a.activeTexture(33984+b),a.bindTexture(3553,null),xa[b]=null;da(ga).forEach(Eb);h.cubeCount=0;h.textureCount=0},getTexture:function(a){return null},restore:function(){da(ga).forEach(function(b){b.texture=a.createTexture();a.bindTexture(b.target,b.texture);for(var g=0;32>g;++g)if(0!==(b.mipmask&1<<g))if(3553===b.target)a.texImage2D(3553,g,b.internalformat,b.width>>g,b.height>>g,0,b.internalformat,b.type,null);else for(var c=0;6>c;++c)a.texImage2D(34069+
c,g,b.internalformat,b.width>>g,b.height>>g,0,b.internalformat,b.type,null);H(b.texInfo,b.target)})}}}function Xb(a,b,c,e,f,h){function k(a,b,d){this.target=a;this.texture=b;this.renderbuffer=d;var g=a=0;b?(a=b.width,g=b.height):d&&(a=d.width,g=d.height);this.width=a;this.height=g}function l(a){a&&(a.texture&&a.texture._texture.decRef(),a.renderbuffer&&a.renderbuffer._renderbuffer.decRef())}function q(a,b,d){if(a){if(a.texture){a=a.texture._texture;var c=Math.max(1,a.height);g(Math.max(1,a.width)===
b&&c===d,"inconsistent width/height for supplied texture")}else a=a.renderbuffer._renderbuffer,g(a.width===b&&a.height===d,"inconsistent width/height for renderbuffer");a.refCount+=1}}function m(b,g){g&&(g.texture?a.framebufferTexture2D(36160,b,g.target,g.texture._texture.texture,0):a.framebufferRenderbuffer(36160,b,36161,g.renderbuffer._renderbuffer.renderbuffer))}function p(a){var b=3553,d=null,c=null,e=a;"object"===typeof a&&(e=a.data,"target"in a&&(b=a.target|0));g.type(e,"function","invalid attachment data");
a=e._reglType;"texture2d"===a?(d=e,g(3553===b)):"textureCube"===a?(d=e,g(34069<=b&&34075>b,"invalid cube map target")):"renderbuffer"===a?(c=e,b=36161):g.raise("invalid regl object for attachment");return new k(b,d,c)}function va(a,b,d,g,c){if(d)return a=e.create2D({width:a,height:b,format:g,type:c}),a._texture.refCount=0,new k(3553,a,null);a=f.create({width:a,height:b,format:g});a._renderbuffer.refCount=0;return new k(36161,null,a)}function r(a){return a&&(a.texture||a.renderbuffer)}function x(a,
b,d){a&&(a.texture?a.texture.resize(b,d):a.renderbuffer&&a.renderbuffer.resize(b,d))}function v(){this.id=D++;A[this.id]=this;this.framebuffer=a.createFramebuffer();this.height=this.width=0;this.colorAttachments=[];this.depthStencilAttachment=this.stencilAttachment=this.depthAttachment=null}function w(a){a.colorAttachments.forEach(l);l(a.depthAttachment);l(a.stencilAttachment);l(a.depthStencilAttachment)}function M(b){var c=b.framebuffer;g(c,"must not double destroy framebuffer");a.deleteFramebuffer(c);
b.framebuffer=null;h.framebufferCount--;delete A[b.id]}function Ba(b){var e;a.bindFramebuffer(36160,b.framebuffer);var f=b.colorAttachments;for(e=0;e<f.length;++e)m(36064+e,f[e]);for(e=f.length;e<c.maxColorAttachments;++e)a.framebufferTexture2D(36160,36064+e,3553,null,0);a.framebufferTexture2D(36160,33306,3553,null,0);a.framebufferTexture2D(36160,36096,3553,null,0);a.framebufferTexture2D(36160,36128,3553,null,0);m(36096,b.depthAttachment);m(36128,b.stencilAttachment);m(33306,b.depthStencilAttachment);
b=a.checkFramebufferStatus(36160);36053!==b&&g.raise("framebuffer configuration not supported, status = "+Yb[b]);a.bindFramebuffer(36160,z.next);z.cur=z.next;a.getError()}function ha(a,d){function e(a,d){var h;g(z.next!==f,"can not update framebuffer which is currently in use");var k=b.webgl_draw_buffers,v=0,l=0,m=!0,F=!0;h=null;var V=!0,x="rgba",ta="uint8",ha=1,Wa=null,M=null,cb=null,D=!1;if("number"===typeof a)v=a|0,l=d|0||v;else if(a){g.type(a,"object","invalid arguments for framebuffer");"shape"in
a?(l=a.shape,g(Array.isArray(l)&&2<=l.length,"invalid shape for framebuffer"),v=l[0],l=l[1]):("radius"in a&&(v=l=a.radius),"width"in a&&(v=a.width),"height"in a&&(l=a.height));if("color"in a||"colors"in a)h=a.color||a.colors,Array.isArray(h)&&g(1===h.length||k,"multiple render targets not supported");if(!h){"colorCount"in a&&(ha=a.colorCount|0,g(0<ha,"invalid color buffer count"));"colorTexture"in a&&(V=!!a.colorTexture,x="rgba4");if("colorType"in a){ta=a.colorType;if(V)g(b.oes_texture_float||!("float"===
ta||"float32"===ta),"you must enable OES_texture_float in order to use floating point framebuffer objects"),g(b.oes_texture_half_float||!("half float"===ta||"float16"===ta),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects");else if("half float"===ta||"float16"===ta)g(b.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),x="rgba16f";else if("float"===ta||"float32"===ta)g(b.webgl_color_buffer_float,
"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),x="rgba32f";g.oneOf(ta,E,"invalid color type")}if("colorFormat"in a)if(x=a.colorFormat,0<=B.indexOf(x))V=!0;else if(0<=y.indexOf(x))V=!1;else if(V)g.oneOf(a.colorFormat,B,"invalid color format for texture");else g.oneOf(a.colorFormat,y,"invalid color format for renderbuffer")}if("depthTexture"in a||"depthStencilTexture"in a)D=!(!a.depthTexture&&!a.depthStencilTexture),g(!D||b.webgl_depth_texture,"webgl_depth_texture extension not supported");
"depth"in a&&("boolean"===typeof a.depth?m=a.depth:(Wa=a.depth,F=!1));"stencil"in a&&("boolean"===typeof a.stencil?F=a.stencil:(M=a.stencil,m=!1));"depthStencil"in a&&("boolean"===typeof a.depthStencil?m=F=a.depthStencil:(cb=a.depthStencil,F=m=!1))}else v=l=1;var A=k=null,za=null,C=null;if(Array.isArray(h))k=h.map(p);else if(h)k=[p(h)];else for(k=Array(ha),h=0;h<ha;++h)k[h]=va(v,l,V,x,ta);g(b.webgl_draw_buffers||1>=k.length,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers.");
g(k.length<=c.maxColorAttachments,"too many color attachments, not supported");v=v||k[0].width;l=l||k[0].height;Wa?A=p(Wa):m&&!F&&(A=va(v,l,D,"depth","uint32"));M?za=p(M):F&&!m&&(za=va(v,l,!1,"stencil","uint8"));cb?C=p(cb):!Wa&&!M&&F&&m&&(C=va(v,l,D,"depth stencil","depth stencil"));g(1>=!!Wa+!!M+!!cb,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");m=null;for(h=0;h<k.length;++h)q(k[h],v,l),g(!k[h]||k[h].texture&&0<=Zb.indexOf(k[h].texture._texture.format)||k[h].renderbuffer&&
0<=$b.indexOf(k[h].renderbuffer._renderbuffer.format),"framebuffer color attachment "+h+" is invalid"),k[h]&&k[h].texture&&(F=Fb[k[h].texture._texture.format]*ib[k[h].texture._texture.type],null===m?m=F:g(m===F,"all color attachments much have the same number of bits per pixel."));q(A,v,l);g(!A||A.texture&&6402===A.texture._texture.format||A.renderbuffer&&33189===A.renderbuffer._renderbuffer.format,"invalid depth attachment for framebuffer object");q(za,v,l);g(!za||za.renderbuffer&&36168===za.renderbuffer._renderbuffer.format,
"invalid stencil attachment for framebuffer object");q(C,v,l);g(!C||C.texture&&34041===C.texture._texture.format||C.renderbuffer&&34041===C.renderbuffer._renderbuffer.format,"invalid depth-stencil attachment for framebuffer object");w(f);f.width=v;f.height=l;f.colorAttachments=k;f.depthAttachment=A;f.stencilAttachment=za;f.depthStencilAttachment=C;e.color=k.map(r);e.depth=r(A);e.stencil=r(za);e.depthStencil=r(C);e.width=f.width;e.height=f.height;Ba(f);return e}var f=new v;h.framebufferCount++;e(a,
d);return Y(e,{resize:function(a,b){g(z.next!==f,"can not resize a framebuffer which is currently in use");var d=a|0,c=b|0||d;if(d===f.width&&c===f.height)return e;for(var n=f.colorAttachments,h=0;h<n.length;++h)x(n[h],d,c);x(f.depthAttachment,d,c);x(f.stencilAttachment,d,c);x(f.depthStencilAttachment,d,c);f.width=e.width=d;f.height=e.height=c;Ba(f);return e},_reglType:"framebuffer",_framebuffer:f,destroy:function(){M(f);w(f)},use:function(a){z.setFBO({framebuffer:e},a)}})}var z={cur:null,next:null,
dirty:!1,setFBO:null},B=["rgba"],y=["rgba4","rgb565","rgb5 a1"];b.ext_srgb&&y.push("srgba");b.ext_color_buffer_half_float&&y.push("rgba16f","rgb16f");b.webgl_color_buffer_float&&y.push("rgba32f");var E=["uint8"];b.oes_texture_half_float&&E.push("half float","float16");b.oes_texture_float&&E.push("float","float32");var D=0,A={};return Y(z,{getFramebuffer:function(a){return"function"===typeof a&&"framebuffer"===a._reglType&&(a=a._framebuffer,a instanceof v)?a:null},create:ha,createCube:function(a){function d(a){var c;
g(0>f.indexOf(z.next),"can not update framebuffer which is currently in use");var h=b.webgl_draw_buffers,k={color:null},q=0,v=null;c="rgba";var l="uint8",u=1;if("number"===typeof a)q=a|0;else if(a){g.type(a,"object","invalid arguments for framebuffer");"shape"in a?(q=a.shape,g(Array.isArray(q)&&2<=q.length,"invalid shape for framebuffer"),g(q[0]===q[1],"cube framebuffer must be square"),q=q[0]):("radius"in a&&(q=a.radius|0),"width"in a?(q=a.width|0,"height"in a&&g(a.height===q,"must be square")):
"height"in a&&(q=a.height|0));if("color"in a||"colors"in a)v=a.color||a.colors,Array.isArray(v)&&g(1===v.length||h,"multiple render targets not supported");v||("colorCount"in a&&(u=a.colorCount|0,g(0<u,"invalid color buffer count")),"colorType"in a&&(g.oneOf(a.colorType,E,"invalid color type"),l=a.colorType),"colorFormat"in a&&(c=a.colorFormat,g.oneOf(a.colorFormat,B,"invalid color format for texture")));"depth"in a&&(k.depth=a.depth);"stencil"in a&&(k.stencil=a.stencil);"depthStencil"in a&&(k.depthStencil=
a.depthStencil)}else q=1;if(v)if(Array.isArray(v))for(a=[],c=0;c<v.length;++c)a[c]=v[c];else a=[v];else for(a=Array(u),v={radius:q,format:c,type:l},c=0;c<u;++c)a[c]=e.createCube(v);k.color=Array(a.length);for(c=0;c<a.length;++c)u=a[c],g("function"===typeof u&&"textureCube"===u._reglType,"invalid cube map"),q=q||u.width,g(u.width===q&&u.height===q,"invalid cube map shape"),k.color[c]={target:34069,data:a[c]};for(c=0;6>c;++c){for(u=0;u<a.length;++u)k.color[u].target=34069+c;0<c&&(k.depth=f[0].depth,
k.stencil=f[0].stencil,k.depthStencil=f[0].depthStencil);if(f[c])f[c](k);else f[c]=ha(k)}return Y(d,{width:q,height:q,color:a})}var f=Array(6);d(a);return Y(d,{faces:f,resize:function(a){var b=a|0;g(0<b&&b<=c.maxCubeMapSize,"invalid radius for cube fbo");if(b===d.width)return d;var e=d.color;for(a=0;a<e.length;++a)e[a].resize(b);for(a=0;6>a;++a)f[a].resize(b);d.width=d.height=b;return d},_reglType:"framebufferCube",destroy:function(){f.forEach(function(a){a.destroy()})}})},clear:function(){da(A).forEach(M)},
restore:function(){da(A).forEach(function(b){b.framebuffer=a.createFramebuffer();Ba(b)})}})}function Gb(){this.w=this.z=this.y=this.x=this.state=0;this.buffer=null;this.size=0;this.normalized=!1;this.type=5126;this.divisor=this.stride=this.offset=0}function ac(a,b,c,g,e){a=c.maxAttributes;b=Array(a);for(c=0;c<a;++c)b[c]=new Gb;return{Record:Gb,scope:{},state:b}}function bc(a,b,c,e){function f(a,b,d,c){this.name=a;this.id=b;this.location=d;this.info=c}function h(a,b){for(var d=0;d<a.length;++d)if(a[d].id===
b.id){a[d].location=b.location;return}a.push(b)}function k(c,e,f){var h=35632===c?m:p,q=h[e];if(!q){var l=b.str(e),q=a.createShader(c);a.shaderSource(q,l);a.compileShader(q);g.shaderError(a,q,l,c,f);h[e]=q}return q}function l(a,b){this.id=x++;this.fragId=a;this.vertId=b;this.program=null;this.uniforms=[];this.attributes=[];e.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function q(c,q){var l,u;l=k(35632,c.fragId);u=k(35633,c.vertId);var m=c.program=a.createProgram();a.attachShader(m,l);
a.attachShader(m,u);a.linkProgram(m);g.linkError(a,m,b.str(c.fragId),b.str(c.vertId),q);var F=a.getProgramParameter(m,35718);e.profile&&(c.stats.uniformsCount=F);var p=c.uniforms;for(l=0;l<F;++l)if(u=a.getActiveUniform(m,l))if(1<u.size)for(var x=0;x<u.size;++x){var r=u.name.replace("[0]","["+x+"]");h(p,new f(r,b.id(r),a.getUniformLocation(m,r),u))}else h(p,new f(u.name,b.id(u.name),a.getUniformLocation(m,u.name),u));F=a.getProgramParameter(m,35721);e.profile&&(c.stats.attributesCount=F);p=c.attributes;
for(l=0;l<F;++l)(u=a.getActiveAttrib(m,l))&&h(p,new f(u.name,b.id(u.name),a.getAttribLocation(m,u.name),u))}var m={},p={},r={},w=[],x=0;e.profile&&(c.getMaxUniformsCount=function(){var a=0;w.forEach(function(b){b.stats.uniformsCount>a&&(a=b.stats.uniformsCount)});return a},c.getMaxAttributesCount=function(){var a=0;w.forEach(function(b){b.stats.attributesCount>a&&(a=b.stats.attributesCount)});return a});return{clear:function(){var b=a.deleteShader.bind(a);da(m).forEach(b);m={};da(p).forEach(b);p=
{};w.forEach(function(b){a.deleteProgram(b.program)});w.length=0;r={};c.shaderCount=0},program:function(a,b,d){g.command(0<=a,"missing vertex shader",d);g.command(0<=b,"missing fragment shader",d);var e=r[b];e||(e=r[b]={});var f=e[a];f||(f=new l(b,a),c.shaderCount++,q(f,d),e[a]=f,w.push(f));return f},restore:function(){m={};p={};for(var a=0;a<w.length;++a)q(w[a])},shader:k,frag:-1,vert:-1}}function cc(a,b,c,e,f,h){function k(q){var l;null===b.next?(g(f.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),
l=5121):(g(null!==b.next.colorAttachments[0].texture,"You cannot read from a renderbuffer"),l=b.next.colorAttachments[0].texture._texture.type,h.oes_texture_float?g(5121===l||5126===l,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"):g(5121===l,"Reading from a framebuffer is only allowed for the type 'uint8'"));var m=0,p=0,r=e.framebufferWidth,x=e.framebufferHeight,v=null;ca(q)?v=q:q&&(g.type(q,"object","invalid arguments to regl.read()"),m=q.x|0,p=q.y|0,g(0<=m&&m<e.framebufferWidth,
"invalid x offset for regl.read"),g(0<=p&&p<e.framebufferHeight,"invalid y offset for regl.read"),r=(q.width||e.framebufferWidth-m)|0,x=(q.height||e.framebufferHeight-p)|0,v=q.data||null);v&&(5121===l?g(v instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):5126===l&&g(v instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'"));g(0<r&&r+m<=e.framebufferWidth,"invalid width for read pixels");g(0<x&&x+p<=
e.framebufferHeight,"invalid height for read pixels");c();q=r*x*4;v||(5121===l?v=new Uint8Array(q):5126===l&&(v=v||new Float32Array(q)));g.isTypedArray(v,"data buffer for regl.read() must be a typedarray");g(v.byteLength>=q,"data buffer for regl.read() too small");a.pixelStorei(3333,4);a.readPixels(m,p,r,x,6408,l,v);return v}function l(a){var d;b.setFBO({framebuffer:a.framebuffer},function(){d=k(a)});return d}return function(a){return a&&"framebuffer"in a?l(a):k(a)}}function Sa(a){return Array.prototype.slice.call(a)}
function Ta(a){return Sa(a).join("")}function dc(){function a(){var b=[],d=[];return Y(function(){b.push.apply(b,Sa(arguments))},{def:function(){var a="v"+c++;d.push(a);0<arguments.length&&(b.push(a,"="),b.push.apply(b,Sa(arguments)),b.push(";"));return a},toString:function(){return Ta([0<d.length?"var "+d+";":"",Ta(b)])}})}function b(){function c(a,b){g(a,b,"=",e.def(a,b),";")}var e=a(),g=a(),f=e.toString,n=g.toString;return Y(function(){e.apply(e,Sa(arguments))},{def:e.def,entry:e,exit:g,save:c,
set:function(a,b,d){c(a,b);e(a,b,"=",d,";")},toString:function(){return f()+n()}})}var c=0,e=[],g=[],f=a(),h={};return{global:f,link:function(a){for(var b=0;b<g.length;++b)if(g[b]===a)return e[b];b="g"+c++;e.push(b);g.push(a);return b},block:a,proc:function(a,d){function c(){var a="a"+e.length;e.push(a);return a}var e=[];d=d||0;for(var g=0;g<d;++g)c();var g=b(),f=g.toString;return h[a]=Y(g,{arg:c,toString:function(){return Ta(["function(",e.join(),"){",f(),"}"])}})},scope:b,cond:function(){var a=
Ta(arguments),d=b(),c=b(),e=d.toString,g=c.toString;return Y(d,{then:function(){d.apply(d,Sa(arguments));return this},"else":function(){c.apply(c,Sa(arguments));return this},toString:function(){var b=g();b&&(b="else{"+b+"}");return Ta(["if(",a,"){",e(),"}",b])}})},compile:function(){var a=['"use strict";',f,"return {"];Object.keys(h).forEach(function(b){a.push('"',b,'":',h[b].toString(),",")});a.push("}");var b=Ta(a).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,
e.concat(b)).apply(null,g)}}}function jb(a){return Array.isArray(a)||ca(a)||T(a)}function Hb(a){return a.sort(function(a,b){return"viewport"===a?-1:"viewport"===b?1:a<b?-1:1})}function sa(a,b,c,e){this.thisDep=a;this.contextDep=b;this.propDep=c;this.append=e}function Ga(a){return a&&!(a.thisDep||a.contextDep||a.propDep)}function P(a){return new sa(!1,!1,!1,a)}function pa(a,b){var c=a.type;return 0===c?(c=a.data.length,new sa(!0,1<=c,2<=c,b)):4===c?(c=a.data,new sa(c.thisDep,c.contextDep,c.propDep,
b)):new sa(3===c,2===c,1===c,b)}function ec(a,b,c,e,f,h,k,l,m,p,r,w,z,x,v){function B(a){return a.replace(".","_")}function A(a,b,d){var c=B(a);$a.push(a);Za[c]=Ca[c]=!!d;Da[c]=b}function y(a,b,d){var c=B(a);$a.push(a);Array.isArray(d)?(Ca[c]=d.slice(),Za[c]=d.slice()):Ca[c]=Za[c]=d;Ea[c]=b}function D(){var a=dc(),d=a.link,c=a.global;a.id=wa++;a.batchId="0";var e=d(na),f=a.shared={props:"a0"};Object.keys(na).forEach(function(a){f[a]=c.def(e,".",a)});g.optional(function(){a.CHECK=d(g);a.commandStr=
g.guessCommand();a.command=d(a.commandStr);a.assert=function(a,b,c){a("if(!(",b,"))",this.CHECK,".commandRaise(",d(c),",",this.command,");")};oa.invalidBlendCombinations=Jb});var h=a.next={},k=a.current={};Object.keys(Ea).forEach(function(a){Array.isArray(Ca[a])&&(h[a]=c.def(f.next,".",a),k[a]=c.def(f.current,".",a))});var O=a.constants={};Object.keys(oa).forEach(function(a){O[a]=c.def(JSON.stringify(oa[a]))});a.invoke=function(b,c){switch(c.type){case 0:var e=["this",f.context,f.props,a.batchId];
return b.def(d(c.data),".call(",e.slice(0,Math.max(c.data.length+1,4)),")");case 1:return b.def(f.props,c.data);case 2:return b.def(f.context,c.data);case 3:return b.def("this",c.data);case 4:return c.data.append(a,b),c.data.ref}};a.attribCache={};var ia={};a.scopeAttrib=function(a){a=b.id(a);if(a in ia)return ia[a];var c=p.scope[a];c||(c=p.scope[a]=new ea);return ia[a]=d(c)};return a}function E(a){var b=a["static"];a=a.dynamic;var d;if("profile"in b){var c=!!b.profile;d=P(function(a,b){return c});
d.enable=c}else if("profile"in a){var e=a.profile;d=pa(e,function(a,b){return a.invoke(b,e)})}return d}function C(a,b){var d=a["static"],c=a.dynamic;if("framebuffer"in d){var e=d.framebuffer;return e?(e=l.getFramebuffer(e),g.command(e,"invalid framebuffer object"),P(function(a,b){var d=a.link(e),c=a.shared;b.set(c.framebuffer,".next",d);c=c.context;b.set(c,".framebufferWidth",d+".width");b.set(c,".framebufferHeight",d+".height");return d})):P(function(a,b){var d=a.shared;b.set(d.framebuffer,".next",
"null");d=d.context;b.set(d,".framebufferWidth",d+".drawingBufferWidth");b.set(d,".framebufferHeight",d+".drawingBufferHeight");return"null"})}if("framebuffer"in c){var f=c.framebuffer;return pa(f,function(a,b){var d=a.invoke(b,f),c=a.shared,e=c.framebuffer,t=b.def(e,".getFramebuffer(",d,")");g.optional(function(){a.assert(b,"!"+d+"||"+t,"invalid framebuffer object")});b.set(e,".next",t);c=c.context;b.set(c,".framebufferWidth",t+"?"+t+".width:"+c+".drawingBufferWidth");b.set(c,".framebufferHeight",
t+"?"+t+".height:"+c+".drawingBufferHeight");return t})}return null}function H(a,b,d){function c(a){if(a in e){var t=e[a];g.commandType(t,"object","invalid "+a,d.commandStr);var h=!0,Ib=t.x|0,k=t.y|0,n,l;"width"in t?(n=t.width|0,g.command(0<=n,"invalid "+a,d.commandStr)):h=!1;"height"in t?(l=t.height|0,g.command(0<=l,"invalid "+a,d.commandStr)):h=!1;return new sa(!h&&b&&b.thisDep,!h&&b&&b.contextDep,!h&&b&&b.propDep,function(a,b){var d=a.shared.context,c=n;"width"in t||(c=b.def(d,".","framebufferWidth",
"-",Ib));var e=l;"height"in t||(e=b.def(d,".","framebufferHeight","-",k));return[Ib,k,c,e]})}if(a in f){var m=f[a],h=pa(m,function(b,d){var c=b.invoke(d,m);g.optional(function(){b.assert(d,c+"&&typeof "+c+'==="object"',"invalid "+a)});var e=b.shared.context,f=d.def(c,".x|0"),t=d.def(c,".y|0"),h=d.def('"width" in ',c,"?",c,".width|0:","(",e,".","framebufferWidth","-",f,")"),ia=d.def('"height" in ',c,"?",c,".height|0:","(",e,".","framebufferHeight","-",t,")");g.optional(function(){b.assert(d,h+">=0&&"+
ia+">=0","invalid "+a)});return[f,t,h,ia]});b&&(h.thisDep=h.thisDep||b.thisDep,h.contextDep=h.contextDep||b.contextDep,h.propDep=h.propDep||b.propDep);return h}return b?new sa(b.thisDep,b.contextDep,b.propDep,function(a,b){var d=a.shared.context;return[0,0,b.def(d,".","framebufferWidth"),b.def(d,".","framebufferHeight")]}):null}var e=a["static"],f=a.dynamic;if(a=c("viewport")){var h=a;a=new sa(a.thisDep,a.contextDep,a.propDep,function(a,b){var d=h.append(a,b),c=a.shared.context;b.set(c,".viewportWidth",
d[2]);b.set(c,".viewportHeight",d[3]);return d})}return{viewport:a,scissor_box:c("scissor.box")}}function L(a){function d(a){if(a in c){var f=b.id(c[a]);g.optional(function(){r.shader(Kb[a],f,g.guessCommand())});var h=P(function(){return f});h.id=f;return h}if(a in e){var t=e[a];return pa(t,function(b,d){var c=b.invoke(d,t),e=d.def(b.shared.strings,".id(",c,")");g.optional(function(){d(b.shared.shader,".shader(",Kb[a],",",e,",",b.command,");")});return e})}return null}var c=a["static"],e=a.dynamic,
f=d("frag"),h=d("vert"),k=null;Ga(f)&&Ga(h)?(k=r.program(h.id,f.id),a=P(function(a,b){return a.link(k)})):a=new sa(f&&f.thisDep||h&&h.thisDep,f&&f.contextDep||h&&h.contextDep,f&&f.propDep||h&&h.propDep,function(a,b){var d=a.shared.shader,c;c=f?f.append(a,b):b.def(d,".","frag");var e;e=h?h.append(a,b):b.def(d,".","vert");var t=d+".program("+e+","+c;g.optional(function(){t+=","+a.command});return b.def(t+")")});return{frag:f,vert:h,progVar:a,program:k}}function I(a,b){function d(a,t){if(a in c){var h=
c[a]|0;g.command(!t||0<=h,"invalid "+a,b.commandStr);return P(function(a,b){t&&(a.OFFSET=h);return h})}if(a in e){var k=e[a];return pa(k,function(b,d){var c=b.invoke(d,k);t&&(b.OFFSET=c,g.optional(function(){b.assert(d,c+">=0","invalid "+a)}));return c})}return t&&f?P(function(a,b){a.OFFSET="0";return 0}):null}var c=a["static"],e=a.dynamic,f=function(){if("elements"in c){var a=c.elements;jb(a)?a=h.getElements(h.create(a,!0)):a&&(a=h.getElements(a),g.command(a,"invalid elements",b.commandStr));var d=
P(function(b,d){if(a){var c=b.link(a);return b.ELEMENTS=c}return b.ELEMENTS=null});d.value=a;return d}if("elements"in e){var f=e.elements;return pa(f,function(a,b){var d=a.shared,c=d.isBufferArgs,d=d.elements,e=a.invoke(b,f),t=b.def("null"),c=b.def(c,"(",e,")"),h=a.cond(c).then(t,"=",d,".createStream(",e,");")["else"](t,"=",d,".getElements(",e,");");g.optional(function(){a.assert(h["else"],"!"+e+"||"+t,"invalid elements")});b.entry(h);b.exit(a.cond(c).then(d,".destroyStream(",t,");"));return a.ELEMENTS=
t})}return null}(),k=d("offset",!0);return{elements:f,primitive:function(){if("primitive"in c){var a=c.primitive;g.commandParameter(a,Na,"invalid primitve",b.commandStr);return P(function(b,d){return Na[a]})}if("primitive"in e){var d=e.primitive;return pa(d,function(a,b){var c=a.constants.primTypes,e=a.invoke(b,d);g.optional(function(){a.assert(b,e+" in "+c,"invalid primitive, must be one of "+Object.keys(Na))});return b.def(c,"[",e,"]")})}return f?Ga(f)?f.value?P(function(a,b){return b.def(a.ELEMENTS,
".primType")}):P(function(){return 4}):new sa(f.thisDep,f.contextDep,f.propDep,function(a,b){var d=a.ELEMENTS;return b.def(d,"?",d,".primType:",4)}):null}(),count:function(){if("count"in c){var a=c.count|0;g.command("number"===typeof a&&0<=a,"invalid vertex count",b.commandStr);return P(function(){return a})}if("count"in e){var d=e.count;return pa(d,function(a,b){var c=a.invoke(b,d);g.optional(function(){a.assert(b,"typeof "+c+'==="number"&&'+c+">=0&&"+c+"===("+c+"|0)","invalid vertex count")});return c})}if(f){if(Ga(f)){if(f)return k?
new sa(k.thisDep,k.contextDep,k.propDep,function(a,b){var d=b.def(a.ELEMENTS,".vertCount-",a.OFFSET);g.optional(function(){a.assert(b,d+">=0","invalid vertex offset/element buffer too small")});return d}):P(function(a,b){return b.def(a.ELEMENTS,".vertCount")});var t=P(function(){return-1});g.optional(function(){t.MISSING=!0});return t}var h=new sa(f.thisDep||k.thisDep,f.contextDep||k.contextDep,f.propDep||k.propDep,function(a,b){var d=a.ELEMENTS;return a.OFFSET?b.def(d,"?",d,".vertCount-",a.OFFSET,
":-1"):b.def(d,"?",d,".vertCount:-1")});g.optional(function(){h.DYNAMIC=!0});return h}return null}(),instances:d("instances",!1),offset:k}}function J(a,b){var d=a["static"],c=a.dynamic,f={};$a.forEach(function(a){function t(b,e){if(a in d){var g=b(d[a]);f[h]=P(function(){return g})}else if(a in c){var k=c[a];f[h]=pa(k,function(a,b){return e(a,b,a.invoke(b,k))})}}var h=B(a);switch(a){case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "depth.mask":return t(function(d){g.commandType(d,
"boolean",a,b.commandStr);return d},function(b,d,c){g.optional(function(){b.assert(d,"typeof "+c+'==="boolean"',"invalid flag "+a,b.commandStr)});return c});case "depth.func":return t(function(d){g.commandParameter(d,Ua,"invalid "+a,b.commandStr);return Ua[d]},function(b,d,c){var e=b.constants.compareFuncs;g.optional(function(){b.assert(d,c+" in "+e,"invalid "+a+", must be one of "+Object.keys(Ua))});return d.def(e,"[",c,"]")});case "depth.range":return t(function(a){g.command(W(a)&&2===a.length&&
"number"===typeof a[0]&&"number"===typeof a[1]&&a[0]<=a[1],"depth range is 2d array",b.commandStr);return a},function(a,b,d){g.optional(function(){a.assert(b,a.shared.isArrayLike+"("+d+")&&"+d+".length===2&&typeof "+d+'[0]==="number"&&typeof '+d+'[1]==="number"&&'+d+"[0]<="+d+"[1]","depth range must be a 2d array")});var c=b.def("+",d,"[0]"),e=b.def("+",d,"[1]");return[c,e]});case "blend.func":return t(function(a){g.commandType(a,"object","blend.func",b.commandStr);var d="srcRGB"in a?a.srcRGB:a.src,
c="srcAlpha"in a?a.srcAlpha:a.src,e="dstRGB"in a?a.dstRGB:a.dst;a="dstAlpha"in a?a.dstAlpha:a.dst;g.commandParameter(d,ya,h+".srcRGB",b.commandStr);g.commandParameter(c,ya,h+".srcAlpha",b.commandStr);g.commandParameter(e,ya,h+".dstRGB",b.commandStr);g.commandParameter(a,ya,h+".dstAlpha",b.commandStr);g.command(-1===Jb.indexOf(d+", "+e),"unallowed blending combination (srcRGB, dstRGB) = ("+d+", "+e+")",b.commandStr);return[ya[d],ya[e],ya[c],ya[a]]},function(b,d,c){function e(t,h){var k=d.def('"',t,
h,'" in ',c,"?",c,".",t,h,":",c,".",t);g.optional(function(){b.assert(d,k+" in "+f,"invalid "+a+"."+t+h+", must be one of "+Object.keys(ya))});return k}var f=b.constants.blendFuncs;g.optional(function(){b.assert(d,c+"&&typeof "+c+'==="object"',"invalid blend func, must be an object")});var t=e("src","RGB"),h=e("dst","RGB");g.optional(function(){b.assert(d,b.constants.invalidBlendCombinations+".indexOf("+t+'+", "+'+h+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var k=d.def(f,
"[",t,"]"),n=d.def(f,"[",e("src","Alpha"),"]"),X=d.def(f,"[",h,"]"),l=d.def(f,"[",e("dst","Alpha"),"]");return[k,X,n,l]});case "blend.equation":return t(function(d){if("string"===typeof d)return g.commandParameter(d,ga,"invalid "+a,b.commandStr),[ga[d],ga[d]];if("object"===typeof d)return g.commandParameter(d.rgb,ga,a+".rgb",b.commandStr),g.commandParameter(d.alpha,ga,a+".alpha",b.commandStr),[ga[d.rgb],ga[d.alpha]];g.commandRaise("invalid blend.equation",b.commandStr)},function(b,d,c){var e=b.constants.blendEquations,
f=d.def(),t=d.def(),h=b.cond("typeof ",c,'==="string"');g.optional(function(){function d(a,c,f){b.assert(a,f+" in "+e,"invalid "+c+", must be one of "+Object.keys(ga))}d(h.then,a,c);b.assert(h["else"],c+"&&typeof "+c+'==="object"',"invalid "+a);d(h["else"],a+".rgb",c+".rgb");d(h["else"],a+".alpha",c+".alpha")});h.then(f,"=",t,"=",e,"[",c,"];");h["else"](f,"=",e,"[",c,".rgb];",t,"=",e,"[",c,".alpha];");d(h);return[f,t]});case "blend.color":return t(function(a){g.command(W(a)&&4===a.length,"blend.color must be a 4d array",
b.commandStr);return U(4,function(b){return+a[b]})},function(a,b,d){g.optional(function(){a.assert(b,a.shared.isArrayLike+"("+d+")&&"+d+".length===4","blend.color must be a 4d array")});return U(4,function(a){return b.def("+",d,"[",a,"]")})});case "stencil.mask":return t(function(a){g.commandType(a,"number",h,b.commandStr);return a|0},function(a,b,d){g.optional(function(){a.assert(b,"typeof "+d+'==="number"',"invalid stencil.mask")});return b.def(d,"|0")});case "stencil.func":return t(function(d){g.commandType(d,
"object",h,b.commandStr);var c=d.cmp||"keep",e=d.ref||0;d="mask"in d?d.mask:-1;g.commandParameter(c,Ua,a+".cmp",b.commandStr);g.commandType(e,"number",a+".ref",b.commandStr);g.commandType(d,"number",a+".mask",b.commandStr);return[Ua[c],e,d]},function(a,b,d){var c=a.constants.compareFuncs;g.optional(function(){function e(){a.assert(b,Array.prototype.join.call(arguments,""),"invalid stencil.func")}e(d+"&&typeof ",d,'==="object"');e('!("cmp" in ',d,")||(",d,".cmp in ",c,")")});var e=b.def('"cmp" in ',
d,"?",c,"[",d,".cmp]",":",7680),f=b.def(d,".ref|0"),h=b.def('"mask" in ',d,"?",d,".mask|0:-1");return[e,f,h]});case "stencil.opFront":case "stencil.opBack":return t(function(d){g.commandType(d,"object",h,b.commandStr);var c=d.fail||"keep",e=d.zfail||"keep";d=d.zpass||"keep";g.commandParameter(c,Ha,a+".fail",b.commandStr);g.commandParameter(e,Ha,a+".zfail",b.commandStr);g.commandParameter(d,Ha,a+".zpass",b.commandStr);return["stencil.opBack"===a?1029:1028,Ha[c],Ha[e],Ha[d]]},function(b,d,c){function e(h){g.optional(function(){b.assert(d,
'!("'+h+'" in '+c+")||("+c+"."+h+" in "+f+")","invalid "+a+"."+h+", must be one of "+Object.keys(Ha))});return d.def('"',h,'" in ',c,"?",f,"[",c,".",h,"]:",7680)}var f=b.constants.stencilOps;g.optional(function(){b.assert(d,c+"&&typeof "+c+'==="object"',"invalid "+a)});return["stencil.opBack"===a?1029:1028,e("fail"),e("zfail"),e("zpass")]});case "polygonOffset.offset":return t(function(a){g.commandType(a,"object",h,b.commandStr);var d=a.factor|0;a=a.units|0;g.commandType(d,"number",h+".factor",b.commandStr);
g.commandType(a,"number",h+".units",b.commandStr);return[d,a]},function(b,d,c){g.optional(function(){b.assert(d,c+"&&typeof "+c+'==="object"',"invalid "+a)});var e=d.def(c,".factor|0"),f=d.def(c,".units|0");return[e,f]});case "cull.face":return t(function(a){var d=0;"front"===a?d=1028:"back"===a&&(d=1029);g.command(!!d,h,b.commandStr);return d},function(a,b,d){g.optional(function(){a.assert(b,d+'==="front"||'+d+'==="back"',"invalid cull.face")});return b.def(d,'==="front"?',1028,":",1029)});case "lineWidth":return t(function(a){g.command("number"===
typeof a&&a>=e.lineWidthDims[0]&&a<=e.lineWidthDims[1],"invalid line width, must positive number between "+e.lineWidthDims[0]+" and "+e.lineWidthDims[1],b.commandStr);return a},function(a,b,d){g.optional(function(){a.assert(b,"typeof "+d+'==="number"&&'+d+">="+e.lineWidthDims[0]+"&&"+d+"<="+e.lineWidthDims[1],"invalid line width")});return d});case "frontFace":return t(function(a){g.commandParameter(a,pb,h,b.commandStr);return pb[a]},function(a,b,d){g.optional(function(){a.assert(b,d+'==="cw"||'+
d+'==="ccw"',"invalid frontFace, must be one of cw,ccw")});return b.def(d+'==="cw"?2304:2305')});case "colorMask":return t(function(a){g.command(W(a)&&4===a.length,"color.mask must be length 4 array",b.commandStr);return a.map(function(a){return!!a})},function(a,b,d){g.optional(function(){a.assert(b,a.shared.isArrayLike+"("+d+")&&"+d+".length===4","invalid color.mask")});return U(4,function(a){return"!!"+d+"["+a+"]"})});case "sample.coverage":return t(function(a){g.command("object"===typeof a&&a,
h,b.commandStr);var d="value"in a?a.value:1;a=!!a.invert;g.command("number"===typeof d&&0<=d&&1>=d,"sample.coverage.value must be a number between 0 and 1",b.commandStr);return[d,a]},function(a,b,d){g.optional(function(){a.assert(b,d+"&&typeof "+d+'==="object"',"invalid sample.coverage")});var c=b.def('"value" in ',d,"?+",d,".value:1"),e=b.def("!!",d,".invert");return[c,e]})}});return f}function K(a,b){var d=a["static"],c=a.dynamic,e={};Object.keys(d).forEach(function(a){var c=d[a],f;if("number"===
typeof c||"boolean"===typeof c)f=P(function(){return c});else if("function"===typeof c){var h=c._reglType;"texture2d"===h||"textureCube"===h?f=P(function(a){return a.link(c)}):"framebuffer"===h||"framebufferCube"===h?(g.command(0<c.color.length,'missing color attachment for framebuffer sent to uniform "'+a+'"',b.commandStr),f=P(function(a){return a.link(c.color[0])})):g.commandRaise('invalid data for uniform "'+a+'"',b.commandStr)}else W(c)?f=P(function(b){return b.global.def("[",U(c.length,function(d){g.command("number"===
typeof c[d]||"boolean"===typeof c[d],"invalid uniform "+a,b.commandStr);return c[d]}),"]")}):g.commandRaise('invalid or missing data for uniform "'+a+'"',b.commandStr);f.value=c;e[a]=f});Object.keys(c).forEach(function(a){var b=c[a];e[a]=pa(b,function(a,d){return a.invoke(d,b)})});return e}function Y(a,d){var c=a["static"],e=a.dynamic,h={};Object.keys(c).forEach(function(a){var e=c[a],t=b.id(a),k=new ea;if(jb(e))k.state=1,k.buffer=f.getBuffer(f.create(e,34962,!1,!0)),k.type=0;else{var l=f.getBuffer(e);
if(l)k.state=1,k.buffer=l,k.type=0;else if(g.command("object"===typeof e&&e,"invalid data for attribute "+a,d.commandStr),e.constant){var m=e.constant;k.buffer="null";k.state=2;"number"===typeof m?k.x=m:(g.command(W(m)&&0<m.length&&4>=m.length,"invalid constant for attribute "+a,d.commandStr),Va.forEach(function(a,b){b<m.length&&(k[a]=m[b])}))}else{l=jb(e.buffer)?f.getBuffer(f.create(e.buffer,34962,!1,!0)):f.getBuffer(e.buffer);g.command(!!l,'missing buffer for attribute "'+a+'"',d.commandStr);var q=
e.offset|0;g.command(0<=q,'invalid offset for attribute "'+a+'"',d.commandStr);var u=e.stride|0;g.command(0<=u&&256>u,'invalid stride for attribute "'+a+'", must be integer betweeen [0, 255]',d.commandStr);var p=e.size|0;g.command(!("size"in e)||0<p&&4>=p,'invalid size for attribute "'+a+'", must be 1,2,3,4',d.commandStr);var v=!!e.normalized,r=0;"type"in e&&(g.commandParameter(e.type,Ya,"invalid type for attribute "+a,d.commandStr),r=Ya[e.type]);var ra=e.divisor|0;"divisor"in e&&(g.command(0===ra||
da,'cannot specify divisor for attribute "'+a+'", instancing not supported',d.commandStr),g.command(0<=ra,'invalid divisor for attribute "'+a+'"',d.commandStr));g.optional(function(){var b=d.commandStr,c="buffer offset divisor normalized type size stride".split(" ");Object.keys(e).forEach(function(d){g.command(0<=c.indexOf(d),'unknown parameter "'+d+'" for attribute pointer "'+a+'" (valid parameters are '+c+")",b)})});k.buffer=l;k.state=1;k.size=p;k.normalized=v;k.type=r||l.dtype;k.offset=q;k.stride=
u;k.divisor=ra}}h[a]=P(function(a,b){var d=a.attribCache;if(t in d)return d[t];var c={isStream:!1};Object.keys(k).forEach(function(a){c[a]=k[a]});k.buffer&&(c.buffer=a.link(k.buffer),c.type=c.type||c.buffer+".dtype");return d[t]=c})});Object.keys(e).forEach(function(a){var b=e[a];h[a]=pa(b,function(d,c){function e(a){c(n[a],"=",f,".",a,"|0;")}var f=d.invoke(c,b),h=d.shared,t=h.isBufferArgs,k=h.buffer;g.optional(function(){d.assert(c,f+"&&(typeof "+f+'==="object"||typeof '+f+'==="function")&&('+t+
"("+f+")||"+k+".getBuffer("+f+")||"+k+".getBuffer("+f+".buffer)||"+t+"("+f+'.buffer)||("constant" in '+f+"&&(typeof "+f+'.constant==="number"||'+h.isArrayLike+"("+f+".constant))))",'invalid dynamic attribute "'+a+'"')});var n={isStream:c.def(!1)},l=new ea;l.state=1;Object.keys(l).forEach(function(a){n[a]=c.def(""+l[a])});var X=n.buffer,m=n.type;c("if(",t,"(",f,")){",n.isStream,"=true;",X,"=",k,".createStream(",34962,",",f,");",m,"=",X,".dtype;","}else{",X,"=",k,".getBuffer(",f,");","if(",X,"){",m,
"=",X,".dtype;",'}else if("constant" in ',f,"){",n.state,"=",2,";","if(typeof "+f+'.constant === "number"){',n[Va[0]],"=",f,".constant;",Va.slice(1).map(function(a){return n[a]}).join("="),"=0;","}else{",Va.map(function(a,b){return n[a]+"="+f+".constant.length>="+b+"?"+f+".constant["+b+"]:0;"}).join(""),"}}else{","if(",t,"(",f,".buffer)){",X,"=",k,".createStream(",34962,",",f,".buffer);","}else{",X,"=",k,".getBuffer(",f,".buffer);","}",m,'="type" in ',f,"?",h.glTypes,"[",f,".type]:",X,".dtype;",n.normalized,
"=!!",f,".normalized;");e("size");e("offset");e("stride");e("divisor");c("}}");c.exit("if(",n.isStream,"){",k,".destroyStream(",X,");","}");return n})});return h}function N(a){var b=a["static"],d=a.dynamic,c={};Object.keys(b).forEach(function(a){var d=b[a];c[a]=P(function(a,b){return"number"===typeof d||"boolean"===typeof d?""+d:a.link(d)})});Object.keys(d).forEach(function(a){var b=d[a];c[a]=pa(b,function(a,d){return a.invoke(d,b)})});return c}function R(a,b,d,c,e){function f(a){var b=l[a];b&&(q[a]=
b)}var h=a["static"],k=a.dynamic;g.optional(function(){function a(d){Object.keys(d).forEach(function(a){g.command(0<=b.indexOf(a),'unknown parameter "'+a+'"',e.commandStr)})}var b="framebuffer vert frag elements primitive offset count instances profile".split(" ").concat($a);a(h);a(k)});var n=C(a,e),l=H(a,n,e),m=I(a,e),q=J(a,e),u=L(a,e);f("viewport");f(B("scissor.box"));var p=0<Object.keys(q).length,n={framebuffer:n,draw:m,shader:u,state:q,dirty:p};n.profile=E(a,e);n.uniforms=K(d,e);n.attributes=
Y(b,e);n.context=N(c,e);return n}function G(a,b,d){var c=a.shared.context,e=a.scope();Object.keys(d).forEach(function(f){b.save(c,"."+f);e(c,".",f,"=",d[f].append(a,b),";")});b(e)}function T(a,b,d,c){var e=a.shared,f=e.gl,g=e.framebuffer,h;xa&&(h=b.def(e.extensions,".webgl_draw_buffers"));var k=a.constants,e=k.drawBuffer,k=k.backBuffer;a=d?d.append(a,b):b.def(g,".next");c||b("if(",a,"!==",g,".cur){");b("if(",a,"){",f,".bindFramebuffer(",36160,",",a,".framebuffer);");xa&&b(h,".drawBuffersWEBGL(",e,
"[",a,".colorAttachments.length]);");b("}else{",f,".bindFramebuffer(",36160,",null);");xa&&b(h,".drawBuffersWEBGL(",k,");");b("}",g,".cur=",a,";");c||b("}")}function ca(a,b,d){var c=a.shared,e=c.gl,f=a.current,g=a.next,h=c.current,k=c.next,n=a.cond(h,".dirty");$a.forEach(function(b){b=B(b);if(!(b in d.state)){var c,l;if(b in g){c=g[b];l=f[b];var m=U(Ca[b].length,function(a){return n.def(c,"[",a,"]")});n(a.cond(m.map(function(a,b){return a+"!=="+l+"["+b+"]"}).join("||")).then(e,".",Ea[b],"(",m,");",
m.map(function(a,b){return l+"["+b+"]="+a}).join(";"),";"))}else c=n.def(k,".",b),m=a.cond(c,"!==",h,".",b),n(m),b in Da?m(a.cond(c).then(e,".enable(",Da[b],");")["else"](e,".disable(",Da[b],");"),h,".",b,"=",c,";"):m(e,".",Ea[b],"(",c,");",h,".",b,"=",c,";")}});0===Object.keys(d.state).length&&n(h,".dirty=false;");b(n)}function Fa(a,b,d,c){var e=a.shared,f=a.current,g=e.current,h=e.gl;Hb(Object.keys(d)).forEach(function(e){var k=d[e];if(!c||c(k)){var n=k.append(a,b);if(Da[e]){var l=Da[e];Ga(k)?n?
b(h,".enable(",l,");"):b(h,".disable(",l,");"):b(a.cond(n).then(h,".enable(",l,");")["else"](h,".disable(",l,");"));b(g,".",e,"=",n,";")}else if(W(n)){var m=f[e];b(h,".",Ea[e],"(",n,");",n.map(function(a,b){return m+"["+b+"]="+a}).join(";"),";")}else b(h,".",Ea[e],"(",n,");",g,".",e,"=",n,";")}})}function S(a,b){da&&(a.instancing=b.def(a.shared.extensions,".angle_instanced_arrays"))}function aa(a,b,d,c,e){function f(){return"undefined"===typeof performance?"Date.now()":"performance.now()"}function g(a){u=
b.def();a(u,"=",f(),";");"string"===typeof e?a(l,".count+=",e,";"):a(l,".count++;");x&&(c?(p=b.def(),a(p,"=",q,".getNumPendingQueries();")):a(q,".beginQuery(",l,");"))}function h(a){a(l,".cpuTime+=",f(),"-",u,";");x&&(c?a(q,".pushScopeStats(",p,",",q,".getNumPendingQueries(),",l,");"):a(q,".endQuery();"))}function k(a){var d=b.def(m,".profile");b(m,".profile=",a,";");b.exit(m,".profile=",d,";")}var n=a.shared,l=a.stats,m=n.current,q=n.timer;d=d.profile;var u,p;if(d){if(Ga(d)){d.enable?(g(b),h(b.exit),
k("true")):k("false");return}d=d.append(a,b);k(d)}else d=b.def(m,".profile");n=a.block();g(n);b("if(",d,"){",n,"}");a=a.block();h(a);b.exit("if(",d,"){",a,"}")}function Q(a,b,d,c,e){function f(a){switch(a){case 35664:case 35667:case 35671:return 2;case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;default:return 1}}function h(d,c,e){function f(){b("if(!",m,".buffer){",n,".enableVertexAttribArray(",l,");}");var d=e.type,g;g=e.size?b.def(e.size,"||",c):c;b("if(",m,".type!==",
d,"||",m,".size!==",g,"||",p.map(function(a){return m+"."+a+"!=="+e[a]}).join("||"),"){",n,".bindBuffer(",34962,",",q,".buffer);",n,".vertexAttribPointer(",[l,g,d,e.normalized,e.stride,e.offset],");",m,".type=",d,";",m,".size=",g,";",p.map(function(a){return m+"."+a+"="+e[a]+";"}).join(""),"}");da&&(d=e.divisor,b("if(",m,".divisor!==",d,"){",a.instancing,".vertexAttribDivisorANGLE(",[l,d],");",m,".divisor=",d,";}"))}function g(){b("if(",m,".buffer){",n,".disableVertexAttribArray(",l,");","}if(",Va.map(function(a,
b){return m+"."+a+"!=="+u[b]}).join("||"),"){",n,".vertexAttrib4f(",l,",",u,");",Va.map(function(a,b){return m+"."+a+"="+u[b]+";"}).join(""),"}")}var n=k.gl,l=b.def(d,".location"),m=b.def(k.attributes,"[",l,"]");d=e.state;var q=e.buffer,u=[e.x,e.y,e.z,e.w],p=["buffer","normalized","offset","stride"];1===d?f():2===d?g():(b("if(",d,"===",1,"){"),f(),b("}else{"),g(),b("}"))}var k=a.shared;c.forEach(function(c){var k=c.name,n=d.attributes[k],l;if(n){if(!e(n))return;l=n.append(a,b)}else{if(!e(Lb))return;
var m=a.scopeAttrib(k);g.optional(function(){a.assert(b,m+".state","missing attribute "+k)});l={};Object.keys(new ea).forEach(function(a){l[a]=b.def(m,".",a)})}h(a.link(c),f(c.info.type),l)})}function ba(a,d,c,e,f){for(var h=a.shared,k=h.gl,l,m=0;m<e.length;++m){var q=e[m],u=q.name,p=q.info.type,v=c.uniforms[u],q=a.link(q)+".location",r;if(v){if(!f(v))continue;if(Ga(v)){var x=v.value;g.command(null!==x&&"undefined"!==typeof x,'missing uniform "'+u+'"',a.commandStr);if(35678===p||35680===p)g.command("function"===
typeof x&&(35678===p&&("texture2d"===x._reglType||"framebuffer"===x._reglType)||35680===p&&("textureCube"===x._reglType||"framebufferCube"===x._reglType)),"invalid texture for uniform "+u,a.commandStr),v=a.link(x._texture||x.color[0]._texture),d(k,".uniform1i(",q,",",v+".bind());"),d.exit(v,".unbind();");else if(35674===p||35675===p||35676===p){g.optional(function(){g.command(W(x),"invalid matrix for uniform "+u,a.commandStr);g.command(35674===p&&4===x.length||35675===p&&9===x.length||35676===p&&
16===x.length,"invalid length for matrix uniform "+u,a.commandStr)});var v=a.global.def("new Float32Array(["+Array.prototype.slice.call(x)+"])"),w=2;35675===p?w=3:35676===p&&(w=4);d(k,".uniformMatrix",w,"fv(",q,",false,",v,");")}else{switch(p){case 5126:g.commandType(x,"number","uniform "+u,a.commandStr);l="1f";break;case 35664:g.command(W(x)&&2===x.length,"uniform "+u,a.commandStr);l="2f";break;case 35665:g.command(W(x)&&3===x.length,"uniform "+u,a.commandStr);l="3f";break;case 35666:g.command(W(x)&&
4===x.length,"uniform "+u,a.commandStr);l="4f";break;case 35670:g.commandType(x,"boolean","uniform "+u,a.commandStr);l="1i";break;case 5124:g.commandType(x,"number","uniform "+u,a.commandStr);l="1i";break;case 35671:g.command(W(x)&&2===x.length,"uniform "+u,a.commandStr);l="2i";break;case 35667:g.command(W(x)&&2===x.length,"uniform "+u,a.commandStr);l="2i";break;case 35672:g.command(W(x)&&3===x.length,"uniform "+u,a.commandStr);l="3i";break;case 35668:g.command(W(x)&&3===x.length,"uniform "+u,a.commandStr);
l="3i";break;case 35673:g.command(W(x)&&4===x.length,"uniform "+u,a.commandStr);l="4i";break;case 35669:g.command(W(x)&&4===x.length,"uniform "+u,a.commandStr),l="4i"}d(k,".uniform",l,"(",q,",",W(x)?Array.prototype.slice.call(x):x,");")}continue}else r=v.append(a,d)}else{if(!f(Lb))continue;r=d.def(h.uniforms,"[",b.id(u),"]")}35678===p?d("if(",r,"&&",r,'._reglType==="framebuffer"){',r,"=",r,".color[0];","}"):35680===p&&d("if(",r,"&&",r,'._reglType==="framebufferCube"){',r,"=",r,".color[0];","}");g.optional(function(){function b(c,
e){a.assert(d,c,'bad data or missing for uniform "'+u+'".  '+e)}function c(a){b("typeof "+r+'==="'+a+'"',"invalid type, expected "+a)}function e(d,c){b(h.isArrayLike+"("+r+")&&"+r+".length==="+d,"invalid vector, should have length "+d,a.commandStr)}function f(d){b("typeof "+r+'==="function"&&'+r+'._reglType==="texture'+(3553===d?"2d":"Cube")+'"',"invalid texture type",a.commandStr)}switch(p){case 5124:c("number");break;case 35667:e(2,"number");break;case 35668:e(3,"number");break;case 35669:e(4,"number");
break;case 5126:c("number");break;case 35664:e(2,"number");break;case 35665:e(3,"number");break;case 35666:e(4,"number");break;case 35670:c("boolean");break;case 35671:e(2,"boolean");break;case 35672:e(3,"boolean");break;case 35673:e(4,"boolean");break;case 35674:e(4,"number");break;case 35675:e(9,"number");break;case 35676:e(16,"number");break;case 35678:f(3553);break;case 35680:f(34067)}});v=1;switch(p){case 35678:case 35680:v=d.def(r,"._texture");d(k,".uniform1i(",q,",",v,".bind());");d.exit(v,
".unbind();");continue;case 5124:case 35670:l="1i";break;case 35667:case 35671:l="2i";v=2;break;case 35668:case 35672:l="3i";v=3;break;case 35669:case 35673:l="4i";v=4;break;case 5126:l="1f";break;case 35664:l="2f";v=2;break;case 35665:l="3f";v=3;break;case 35666:l="4f";v=4;break;case 35674:l="Matrix2fv";break;case 35675:l="Matrix3fv";break;case 35676:l="Matrix4fv"}d(k,".uniform",l,"(",q,",");if("M"===l.charAt(0)){var q=Math.pow(p-35674+2,2),F=a.global.def("new Float32Array(",q,")");d("false,(Array.isArray(",
r,")||",r," instanceof Float32Array)?",r,":(",U(q,function(a){return F+"["+a+"]="+r+"["+a+"]"}),",",F,")")}else 1<v?d(U(v,function(a){return r+"["+a+"]"})):d(r);d(");")}}function Z(a,b,d,c){function e(f){var g=m[f];return g?g.contextDep&&c.contextDynamic||g.propDep?g.append(a,d):g.append(a,b):b.def(l,".",f)}function f(){function a(){d(r,".drawElementsInstancedANGLE(",[u,v,w,p+"<<(("+w+"-5121)>>1)",x],");")}function b(){d(r,".drawArraysInstancedANGLE(",[u,p,v,x],");")}q?F?a():(d("if(",q,"){"),a(),
d("}else{"),b(),d("}")):b()}function h(){function a(){d(n+".drawElements("+[u,v,w,p+"<<(("+w+"-5121)>>1)"]+");")}function b(){d(n+".drawArrays("+[u,p,v]+");")}q?F?a():(d("if(",q,"){"),a(),d("}else{"),b(),d("}")):b()}var k=a.shared,n=k.gl,l=k.draw,m=c.draw,q=function(){var e=m.elements,f=b;if(e){if(e.contextDep&&c.contextDynamic||e.propDep)f=d;e=e.append(a,f)}else e=f.def(l,".","elements");e&&f("if("+e+")"+n+".bindBuffer(34963,"+e+".buffer.buffer);");return e}(),u=e("primitive"),p=e("offset"),v=function(){var e=
m.count,f,h=b;if(e){if(e.contextDep&&c.contextDynamic||e.propDep)h=d;f=e.append(a,h);g.optional(function(){e.MISSING&&a.assert(b,"false","missing vertex count");e.DYNAMIC&&a.assert(h,f+">=0","missing vertex count")})}else f=h.def(l,".","count"),g.optional(function(){a.assert(h,f+">=0","missing vertex count")});return f}();if("number"===typeof v){if(0===v)return}else d("if(",v,"){"),d.exit("}");var x,r;da&&(x=e("instances"),r=a.instancing);var w=q+".type",F=m.elements&&Ga(m.elements);da&&("number"!==
typeof x||0<=x)?"string"===typeof x?(d("if(",x,">0){"),f(),d("}else if(",x,"<0){"),h(),d("}")):f():h()}function fa(a,b,d,c,e){var f=D();e=f.proc("body",e);g.optional(function(){f.commandStr=b.commandStr;f.command=f.link(b.commandStr)});da&&(f.instancing=e.def(f.shared.extensions,".angle_instanced_arrays"));a(f,e,d,c);return f.compile().body}function ja(a,b,d,c){S(a,b);Q(a,b,d,c.attributes,function(){return!0});ba(a,b,d,c.uniforms,function(){return!0});Z(a,b,b,d)}function ka(a,b){var d=a.proc("draw",
1);S(a,d);G(a,d,b.context);T(a,d,b.framebuffer);ca(a,d,b);Fa(a,d,b.state);aa(a,d,b,!1,!0);var c=b.shader.progVar.append(a,d);d(a.shared.gl,".useProgram(",c,".program);");if(b.shader.program)ja(a,d,b,b.shader.program);else{var e=a.global.def("{}"),f=d.def(c,".id"),g=d.def(e,"[",f,"]");d(a.cond(g).then(g,".call(this,a0);")["else"](g,"=",e,"[",f,"]=",a.link(function(d){return fa(ja,a,b,d,1)}),"(",c,");",g,".call(this,a0);"))}0<Object.keys(b.state).length&&d(a.shared.current,".dirty=true;")}function bb(a,
b,d,c){function e(){return!0}a.batchId="a1";S(a,b);Q(a,b,d,c.attributes,e);ba(a,b,d,c.uniforms,e);Z(a,b,b,d)}function La(a,b,d,c){function e(a){return a.contextDep&&g||a.propDep}function f(a){return!e(a)}S(a,b);var g=d.contextDep,h=b.def(),k=b.def();a.shared.props=k;a.batchId=h;var n=a.scope(),l=a.scope();b(n.entry,"for(",h,"=0;",h,"<","a1",";++",h,"){",k,"=","a0","[",h,"];",l,"}",n.exit);d.needsContext&&G(a,l,d.context);d.needsFramebuffer&&T(a,l,d.framebuffer);Fa(a,l,d.state,e);d.profile&&e(d.profile)&&
aa(a,l,d,!1,!0);c?(Q(a,n,d,c.attributes,f),Q(a,l,d,c.attributes,e),ba(a,n,d,c.uniforms,f),ba(a,l,d,c.uniforms,e),Z(a,n,l,d)):(b=a.global.def("{}"),c=d.shader.progVar.append(a,l),k=l.def(c,".id"),n=l.def(b,"[",k,"]"),l(a.shared.gl,".useProgram(",c,".program);","if(!",n,"){",n,"=",b,"[",k,"]=",a.link(function(b){return fa(bb,a,d,b,2)}),"(",c,");}",n,".call(this,a0[",h,"],",h,");"))}function Ma(a,b){function d(a){return a.contextDep&&e||a.propDep}var c=a.proc("batch",2);a.batchId="0";S(a,c);var e=!1,
f=!0;Object.keys(b.context).forEach(function(a){e=e||b.context[a].propDep});e||(G(a,c,b.context),f=!1);var g=b.framebuffer,h=!1;g?(g.propDep?e=h=!0:g.contextDep&&e&&(h=!0),h||T(a,c,g)):T(a,c,null);b.state.viewport&&b.state.viewport.propDep&&(e=!0);ca(a,c,b);Fa(a,c,b.state,function(a){return!d(a)});b.profile&&d(b.profile)||aa(a,c,b,!1,"a1");b.contextDep=e;b.needsContext=f;b.needsFramebuffer=h;f=b.shader.progVar;if(f.contextDep&&e||f.propDep)La(a,c,b,null);else if(f=f.append(a,c),c(a.shared.gl,".useProgram(",
f,".program);"),b.shader.program)La(a,c,b,b.shader.program);else{var g=a.global.def("{}"),h=c.def(f,".id"),k=c.def(g,"[",h,"]");c(a.cond(k).then(k,".call(this,a0,a1);")["else"](k,"=",g,"[",h,"]=",a.link(function(d){return fa(La,a,b,d,2)}),"(",f,");",k,".call(this,a0,a1);"))}0<Object.keys(b.state).length&&c(a.shared.current,".dirty=true;")}function nb(a,d){function c(b){var g=d.shader[b];g&&e.set(f.shader,"."+b,g.append(a,e))}var e=a.proc("scope",3);a.batchId="a2";var f=a.shared,g=f.current;G(a,e,
d.context);d.framebuffer&&d.framebuffer.append(a,e);Hb(Object.keys(d.state)).forEach(function(b){var c=d.state[b].append(a,e);W(c)?c.forEach(function(d,c){e.set(a.next[b],"["+c+"]",d)}):e.set(f.next,"."+b,c)});aa(a,e,d,!0,!0);["elements","offset","count","instances","primitive"].forEach(function(b){var c=d.draw[b];c&&e.set(f.draw,"."+b,""+c.append(a,e))});Object.keys(d.uniforms).forEach(function(c){e.set(f.uniforms,"["+b.id(c)+"]",d.uniforms[c].append(a,e))});Object.keys(d.attributes).forEach(function(b){var c=
d.attributes[b].append(a,e),f=a.scopeAttrib(b);Object.keys(new ea).forEach(function(a){e.set(f,"."+a,c[a])})});c("vert");c("frag");0<Object.keys(d.state).length&&(e(g,".dirty=true;"),e.exit(g,".dirty=true;"));e("a1(",a.shared.context,",a0,",a.batchId,");")}function ma(a){if("object"===typeof a&&!W(a)){for(var b=Object.keys(a),d=0;d<b.length;++d)if(ua.isDynamic(a[b[d]]))return!0;return!1}}function la(a,b,d){function c(a,b){g.forEach(function(d){var c=e[d];ua.isDynamic(c)&&(c=a.invoke(b,c),b(l,".",
d,"=",c,";"))})}var e=b["static"][d];if(e&&ma(e)){var f=a.global,g=Object.keys(e),h=!1,k=!1,n=!1,l=a.global.def("{}");g.forEach(function(b){var d=e[b];if(ua.isDynamic(d))"function"===typeof d&&(d=e[b]=ua.unbox(d)),b=pa(d,null),h=h||b.thisDep,n=n||b.propDep,k=k||b.contextDep;else{f(l,".",b,"=");switch(typeof d){case "number":f(d);break;case "string":f('"',d,'"');break;case "object":Array.isArray(d)&&f("[",d.join(),"]");break;default:f(a.link(d))}f(";")}});b.dynamic[d]=new ua.DynamicVariable(4,{thisDep:h,
contextDep:k,propDep:n,ref:l,append:c});delete b["static"][d]}}var ea=p.Record,ga={add:32774,subtract:32778,"reverse subtract":32779};c.ext_blend_minmax&&(ga.min=32775,ga.max=32776);var da=c.angle_instanced_arrays,xa=c.webgl_draw_buffers,Ca={dirty:!0,profile:v.profile},Za={},$a=[],Da={},Ea={};A("dither",3024);A("blend.enable",3042);y("blend.color","blendColor",[0,0,0,0]);y("blend.equation","blendEquationSeparate",[32774,32774]);y("blend.func","blendFuncSeparate",[1,0,1,0]);A("depth.enable",2929,!0);
y("depth.func","depthFunc",513);y("depth.range","depthRange",[0,1]);y("depth.mask","depthMask",!0);y("colorMask","colorMask",[!0,!0,!0,!0]);A("cull.enable",2884);y("cull.face","cullFace",1029);y("frontFace","frontFace",2305);y("lineWidth","lineWidth",1);A("polygonOffset.enable",32823);y("polygonOffset.offset","polygonOffset",[0,0]);A("sample.alpha",32926);A("sample.enable",32928);y("sample.coverage","sampleCoverage",[1,!1]);A("stencil.enable",2960);y("stencil.mask","stencilMask",-1);y("stencil.func",
"stencilFunc",[519,0,-1]);y("stencil.opFront","stencilOpSeparate",[1028,7680,7680,7680]);y("stencil.opBack","stencilOpSeparate",[1029,7680,7680,7680]);A("scissor.enable",3089);y("scissor.box","scissor",[0,0,a.drawingBufferWidth,a.drawingBufferHeight]);y("viewport","viewport",[0,0,a.drawingBufferWidth,a.drawingBufferHeight]);var na={gl:a,context:z,strings:b,next:Za,current:Ca,draw:w,elements:h,buffer:f,shader:r,attributes:p.state,uniforms:m,framebuffer:l,extensions:c,timer:x,isBufferArgs:jb},oa={primTypes:Na,
compareFuncs:Ua,blendFuncs:ya,blendEquations:ga,stencilOps:Ha,glTypes:Ya,orientationType:pb};g.optional(function(){na.isArrayLike=W});xa&&(oa.backBuffer=[1029],oa.drawBuffer=U(e.maxDrawbuffers,function(a){return 0===a?[0]:U(a,function(a){return 36064+a})}));var wa=0;return{next:Za,current:Ca,procs:function(){var b=D(),c=b.proc("poll"),f=b.proc("refresh"),g=b.block();c(g);f(g);var h=b.shared,k=h.gl,n=h.next,l=h.current;g(l,".dirty=false;");T(b,c);T(b,f,null,!0);var m=a.getExtension("angle_instanced_arrays"),
q;m&&(q=b.link(m));for(var u=0;u<e.maxAttributes;++u){var p=f.def(h.attributes,"[",u,"]"),v=b.cond(p,".buffer");v.then(k,".enableVertexAttribArray(",u,");",k,".bindBuffer(",34962,",",p,".buffer.buffer);",k,".vertexAttribPointer(",u,",",p,".size,",p,".type,",p,".normalized,",p,".stride,",p,".offset);")["else"](k,".disableVertexAttribArray(",u,");",k,".vertexAttrib4f(",u,",",p,".x,",p,".y,",p,".z,",p,".w);",p,".buffer=null;");f(v);m&&f(q,".vertexAttribDivisorANGLE(",u,",",p,".divisor);")}Object.keys(Da).forEach(function(a){var d=
Da[a],e=g.def(n,".",a),h=b.block();h("if(",e,"){",k,".enable(",d,")}else{",k,".disable(",d,")}",l,".",a,"=",e,";");f(h);c("if(",e,"!==",l,".",a,"){",h,"}")});Object.keys(Ea).forEach(function(a){var d=Ea[a],e=Ca[a],h,m,u=b.block();u(k,".",d,"(");W(e)?(d=e.length,h=b.global.def(n,".",a),m=b.global.def(l,".",a),u(U(d,function(a){return h+"["+a+"]"}),");",U(d,function(a){return m+"["+a+"]="+h+"["+a+"];"}).join("")),c("if(",U(d,function(a){return h+"["+a+"]!=="+m+"["+a+"]"}).join("||"),"){",u,"}")):(h=
g.def(n,".",a),m=g.def(l,".",a),u(h,");",l,".",a,"=",h,";"),c("if(",h,"!==",m,"){",u,"}"));f(u)});return b.compile()}(),compile:function(a,b,d,c,e){var f=D();f.stats=f.link(e);Object.keys(b["static"]).forEach(function(a){la(f,b,a)});fc.forEach(function(b){la(f,a,b)});d=R(a,b,d,c,f);ka(f,d);nb(f,d);Ma(f,d);return f.compile()}}}function Mb(a,b){for(var c=0;c<a.length;++c)if(a[c]===b)return c;return-1}var Xa={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,
"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},ca=function(a){return Object.prototype.toString.call(a)in Xa},Y=function(a,b){for(var c=Object.keys(b),e=0;e<c.length;++e)a[c[e]]=b[c[e]];return a},Nb="gl canvas container attributes pixelRatio extensions optionalExtensions profile onDone".split(" "),ka={};ka[5120]=ka[5121]=1;ka[5122]=ka[5123]=ka[36193]=ka[33635]=ka[32819]=
ka[32820]=2;ka[5124]=ka[5125]=ka[5126]=ka[34042]=4;var g=Y(f,{optional:function(a){a()},raise:b,commandRaise:E,command:function(a,b,c){a||E(b,c||w())},parameter:function(a,e,f){a in e||b("unknown parameter ("+a+")"+c(f)+". possible values: "+Object.keys(e).join())},commandParameter:function(a,b,e,f){a in b||E("unknown parameter ("+a+")"+c(e)+". possible values: "+Object.keys(b).join(),f||w())},constructor:function(a){Object.keys(a).forEach(function(a){0>Nb.indexOf(a)&&b('invalid regl constructor argument "'+
a+'". must be one of '+Nb)})},type:function(a,e,f){typeof a!==e&&b("invalid parameter type"+c(f)+". expected "+e+", got "+typeof a)},commandType:A,isTypedArray:function(a,e){ca(a)||b("invalid parameter type"+c(e)+". must be a typed array")},nni:function(a,e){0<=a&&(a|0)===a||b("invalid parameter type, ("+a+")"+c(e)+". must be a nonnegative integer")},oneOf:e,shaderError:function(a,b,c,e,g){if(!a.getShaderParameter(b,a.COMPILE_STATUS)){b=a.getShaderInfoLog(b);a=e===a.FRAGMENT_SHADER?"fragment":"vertex";
A(c,"string",a+" shader source must be a string",g);var h=B(c,g);c=y(b);na(h,c);Object.keys(h).forEach(function(a){function b(a,d){c.push(a);e.push(d||"")}var d=h[a];if(d.hasErrors){var c=[""],e=[""];b("file number "+a+": "+d.name+"\n","color:red;text-decoration:underline;font-weight:bold");d.lines.forEach(function(a){if(0<a.errors.length){b(k(a.number,4)+"|  ","background-color:yellow; font-weight:bold");b(a.line+"\n","color:red; background-color:yellow; font-weight:bold");var d=0;a.errors.forEach(function(c){c=
c.message;var e=/^\s*\'(.*)\'\s*\:\s*(.*)$/.exec(c);if(e){var f=e[1];c=e[2];switch(f){case "assign":f="="}d=Math.max(a.line.indexOf(f,d),0)}else d=0;b(k("| ",6));b(k("^^^",d+3)+"\n","font-weight:bold");b(k("| ",6));b(c+"\n","font-weight:bold")});b(k("| ",6)+"\n")}else b(k(a.number,4)+"|  "),b(a.line+"\n","color:red")});"undefined"!==typeof document?(e[0]=c.join("%c"),console.log.apply(console,e)):console.log(c.join(""))}});f.raise("Error compiling "+a+" shader, "+h[0].name)}},linkError:function(a,
b,c,e,g){a.getProgramParameter(b,a.LINK_STATUS)||(a=a.getProgramInfoLog(b),c=B(c,g),e='Error linking program with vertex shader, "'+B(e,g)[0].name+'", and fragment shader "'+c[0].name+'"',"undefined"!==typeof document?console.log("%c"+e+"\n%c"+a,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(e+"\n"+a),f.raise(e))},callSite:ma,saveCommandRef:I,saveDrawInfo:function(a,b,c,e){function f(a){return a?e.id(a):0}function g(a,b){Object.keys(b).forEach(function(b){a[e.id(b)]=
!0})}I(a);a._fragId=f(a["static"].frag);a._vertId=f(a["static"].vert);var h=a._uniformSet={};g(h,b["static"]);g(h,b.dynamic);b=a._attributeSet={};g(b,c["static"]);g(b,c.dynamic);a._hasCount="count"in a["static"]||"count"in a.dynamic||"elements"in a["static"]||"elements"in a.dynamic},framebufferFormat:function(a,b,c){a.texture?e(a.texture._texture.internalformat,b,"unsupported texture format for attachment"):e(a.renderbuffer._renderbuffer.format,c,"unsupported renderbuffer format for attachment")},
guessCommand:w,texture2D:function(a,b,c){var e=b.width,g=b.height,h=b.channels;f(0<e&&e<=c.maxTextureSize&&0<g&&g<=c.maxTextureSize,"invalid texture shape");33071===a.wrapS&&33071===a.wrapT||f(!(e&e-1)&&!!e&&!(g&g-1)&&!!g,"incompatible wrap mode for texture, both width and height must be power of 2");1===b.mipmask?1!==e&&1!==g&&f(9984!==a.minFilter&&9986!==a.minFilter&&9985!==a.minFilter&&9987!==a.minFilter,"min filter requires mipmap"):(f(!(e&e-1)&&!!e&&!(g&g-1)&&!!g,"texture must be a square power of 2 to support mipmapping"),
f(b.mipmask===(e<<1)-1,"missing or incomplete mipmap data"));5126===b.type&&(0>c.extensions.indexOf("oes_texture_float_linear")&&f(9728===a.minFilter&&9728===a.magFilter,"filter not supported, must enable oes_texture_float_linear"),f(!a.genMipmaps,"mipmap generation not supported with float textures"));var k=b.images;for(c=0;16>c;++c)if(k[c]){var l=e>>c,m=g>>c;f(b.mipmask&1<<c,"missing mipmap data");var p=k[c];f(p.width===l&&p.height===m,"invalid shape for mip images");f(p.format===b.format&&p.internalformat===
b.internalformat&&p.type===b.type,"incompatible type for mip image");!p.compressed&&p.data&&(l=Math.ceil(H(p.type,h)*l/p.unpackAlignment)*p.unpackAlignment,f(p.data.byteLength===l*m,"invalid data for image, buffer size is inconsistent with image format"))}else a.genMipmaps||f(0===(b.mipmask&1<<c),"extra mipmap data");b.compressed&&f(!a.genMipmaps,"mipmap generation for compressed images not supported")},textureCube:function(a,b,c,e){var g=a.width,h=a.height,k=a.channels;f(0<g&&g<=e.maxTextureSize&&
0<h&&h<=e.maxTextureSize,"invalid texture shape");f(g===h,"cube map must be square");f(33071===b.wrapS&&33071===b.wrapT,"wrap mode not supported by cube map");for(e=0;e<c.length;++e){var l=c[e];f(l.width===g&&l.height===h,"inconsistent cube map face shape");b.genMipmaps&&(f(!l.compressed,"can not generate mipmap for compressed textures"),f(1===l.mipmask,"can not specify mipmaps and generate mipmaps"));for(var m=l.images,p=0;16>p;++p){var r=m[p];if(r){var w=g>>p,y=h>>p;f(l.mipmask&1<<p,"missing mipmap data");
f(r.width===w&&r.height===y,"invalid shape for mip images");f(r.format===a.format&&r.internalformat===a.internalformat&&r.type===a.type,"incompatible type for mip image");r.compressed||r.data&&f(r.data.byteLength===w*y*Math.max(H(r.type,k),r.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format")}}}}}),Pb=0,ua={DynamicVariable:C,define:function(a,b){return new C(a,J(b+""))},isDynamic:function(a){return"function"===typeof a&&!a._reglType||a instanceof C},unbox:function(a,
b){return"function"===typeof a?new C(0,a):a},accessor:J},qb={next:"function"===typeof requestAnimationFrame?function(a){return requestAnimationFrame(a)}:function(a){return setTimeout(a,16)},cancel:"function"===typeof cancelAnimationFrame?function(a){return cancelAnimationFrame(a)}:clearTimeout},Ob="undefined"!==typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date},gc=function(a,b){var c=1;b.ext_texture_filter_anisotropic&&(c=a.getParameter(34047));var e=
1,f=1;b.webgl_draw_buffers&&(e=a.getParameter(34852),f=a.getParameter(36063));return{colorBits:[a.getParameter(3410),a.getParameter(3411),a.getParameter(3412),a.getParameter(3413)],depthBits:a.getParameter(3414),stencilBits:a.getParameter(3415),subpixelBits:a.getParameter(3408),extensions:Object.keys(b).filter(function(a){return!!b[a]}),maxAnisotropic:c,maxDrawbuffers:e,maxColorAttachments:f,pointSizeDims:a.getParameter(33901),lineWidthDims:a.getParameter(33902),maxViewportDims:a.getParameter(3386),
maxCombinedTextureUnits:a.getParameter(35661),maxCubeMapSize:a.getParameter(34076),maxRenderbufferSize:a.getParameter(34024),maxTextureUnits:a.getParameter(34930),maxTextureSize:a.getParameter(3379),maxAttributes:a.getParameter(34921),maxVertexUniforms:a.getParameter(36347),maxVertexTextureUnits:a.getParameter(35660),maxVaryingVectors:a.getParameter(36348),maxFragmentUniforms:a.getParameter(36349),glsl:a.getParameter(35724),renderer:a.getParameter(7937),vendor:a.getParameter(7936),version:a.getParameter(7938)}},
da=function(a){return Object.keys(a).map(function(b){return a[b]})},rb=U(8,function(){return[]}),R={alloc:oa,free:sb,allocType:function(a,b){var c=null;switch(a){case 5120:c=new Int8Array(oa(b),0,b);break;case 5121:c=new Uint8Array(oa(b),0,b);break;case 5122:c=new Int16Array(oa(2*b),0,b);break;case 5123:c=new Uint16Array(oa(2*b),0,b);break;case 5124:c=new Int32Array(oa(4*b),0,b);break;case 5125:c=new Uint32Array(oa(4*b),0,b);break;case 5126:c=new Float32Array(oa(4*b),0,b);break;default:return null}return c.length!==
b?c.subarray(0,b):c},freeType:function(a){sb(a.buffer)}},hb={shape:function(a){for(var b=[];a.length;a=a[0])b.push(a.length);return b},flatten:function(a,b,c,e){var f=1;if(b.length)for(var g=0;g<b.length;++g)f*=b[g];else f=0;c=e||R.allocType(c,f);switch(b.length){case 0:break;case 1:e=b[0];for(b=0;b<e;++b)c[b]=a[b];break;case 2:e=b[0];b=b[1];for(g=f=0;g<e;++g)for(var h=a[g],k=0;k<b;++k)c[f++]=h[k];break;case 3:tb(a,b[0],b[1],b[2],c,0);break;default:ub(a,b,0,c,0)}return c}},Ya={int8:5120,int16:5122,
int32:5124,uint8:5121,uint16:5123,uint32:5125,"float":5126,float32:5126},eb={dynamic:35048,stream:35040,"static":35044},kb=hb.flatten,xb=hb.shape,wa=[];wa[5120]=1;wa[5122]=2;wa[5124]=4;wa[5121]=1;wa[5123]=2;wa[5125]=4;wa[5126]=4;var Na={points:0,point:0,lines:1,line:1,triangles:4,triangle:4,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},zb=new Float32Array(1),Sb=new Uint32Array(zb.buffer),Vb=[9984,9986,9985,9987],gb=[0,6409,6410,6407,6408],la={};la[6409]=la[6406]=la[6402]=1;la[34041]=
la[6410]=2;la[6407]=la[35904]=3;la[6408]=la[35906]=4;var Tb=Object.keys(Xa).concat(["[object HTMLCanvasElement]","[object CanvasRenderingContext2D]","[object HTMLImageElement]","[object HTMLVideoElement]"]),Pa=[];Pa[5121]=1;Pa[5126]=4;Pa[36193]=2;Pa[5123]=2;Pa[5125]=4;var N=[];N[32854]=2;N[32855]=2;N[36194]=2;N[34041]=4;N[33776]=.5;N[33777]=.5;N[33778]=1;N[33779]=1;N[35986]=.5;N[35987]=1;N[34798]=1;N[35840]=.5;N[35841]=.25;N[35842]=.5;N[35843]=.25;N[36196]=.5;var ea=[];ea[32854]=2;ea[32855]=2;ea[36194]=
2;ea[33189]=2;ea[36168]=1;ea[34041]=4;ea[35907]=4;ea[34836]=16;ea[34842]=8;ea[34843]=6;var hc=function(a,b,c,e,f){function h(a){this.id=p++;this.refCount=1;this.renderbuffer=a;this.format=32854;this.height=this.width=0;f.profile&&(this.stats={size:0})}function k(b){var c=b.renderbuffer;g(c,"must not double destroy renderbuffer");a.bindRenderbuffer(36161,null);a.deleteRenderbuffer(c);b.renderbuffer=null;b.refCount=0;delete r[b.id];e.renderbufferCount--}var l={rgba4:32854,rgb565:36194,"rgb5 a1":32855,
depth:33189,stencil:36168,"depth stencil":34041};b.ext_srgb&&(l.srgba=35907);b.ext_color_buffer_half_float&&(l.rgba16f=34842,l.rgb16f=34843);b.webgl_color_buffer_float&&(l.rgba32f=34836);var m=[];Object.keys(l).forEach(function(a){m[l[a]]=a});var p=0,r={};h.prototype.decRef=function(){0>=--this.refCount&&k(this)};f.profile&&(e.getTotalRenderbufferSize=function(){var a=0;Object.keys(r).forEach(function(b){a+=r[b].stats.size});return a});return{create:function(b,k){function n(b,e){var h=0,k=0,r=32854;
"object"===typeof b&&b?("shape"in b?(k=b.shape,g(Array.isArray(k)&&2<=k.length,"invalid renderbuffer shape"),h=k[0]|0,k=k[1]|0):("radius"in b&&(h=k=b.radius|0),"width"in b&&(h=b.width|0),"height"in b&&(k=b.height|0)),"format"in b&&(g.parameter(b.format,l,"invalid renderbuffer format"),r=l[b.format])):"number"===typeof b?(h=b|0,k="number"===typeof e?e|0:h):b?g.raise("invalid arguments to renderbuffer constructor"):h=k=1;g(0<h&&0<k&&h<=c.maxRenderbufferSize&&k<=c.maxRenderbufferSize,"invalid renderbuffer size");
if(h!==p.width||k!==p.height||r!==p.format)return n.width=p.width=h,n.height=p.height=k,p.format=r,a.bindRenderbuffer(36161,p.renderbuffer),a.renderbufferStorage(36161,r,h,k),f.profile&&(p.stats.size=ea[p.format]*p.width*p.height),n.format=m[p.format],n}var p=new h(a.createRenderbuffer());r[p.id]=p;e.renderbufferCount++;n(b,k);n.resize=function(b,e){var h=b|0,k=e|0||h;if(h===p.width&&k===p.height)return n;g(0<h&&0<k&&h<=c.maxRenderbufferSize&&k<=c.maxRenderbufferSize,"invalid renderbuffer size");
n.width=p.width=h;n.height=p.height=k;a.bindRenderbuffer(36161,p.renderbuffer);a.renderbufferStorage(36161,p.format,h,k);f.profile&&(p.stats.size=ea[p.format]*p.width*p.height);return n};n._reglType="renderbuffer";n._renderbuffer=p;f.profile&&(n.stats=p.stats);n.destroy=function(){p.decRef()};return n},clear:function(){da(r).forEach(k)},restore:function(){da(r).forEach(function(b){b.renderbuffer=a.createRenderbuffer();a.bindRenderbuffer(36161,b.renderbuffer);a.renderbufferStorage(36161,b.format,b.width,
b.height)});a.bindRenderbuffer(36161,null)}}},Zb=[6408],Fb=[];Fb[6408]=4;var ib=[];ib[5121]=1;ib[5126]=4;ib[36193]=2;var $b=[32854,32855,36194,35907,34842,34843,34836],Yb={36053:"complete",36054:"incomplete attachment",36057:"incomplete dimensions",36055:"incomplete, missing attachment",36061:"unsupported"},Va=["x","y","z","w"],fc="blend.func blend.equation stencil.func stencil.opFront stencil.opBack sample.coverage viewport scissor.box polygonOffset.offset".split(" "),ya={0:0,1:1,zero:0,one:1,"src color":768,
"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Jb="constant color, constant alpha;one minus constant color, constant alpha;constant color, one minus constant alpha;one minus constant color, one minus constant alpha;constant alpha, constant color;constant alpha, one minus constant color;one minus constant alpha, constant color;one minus constant alpha, one minus constant color".split(";"),
Ua={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Ha={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},Kb={frag:35632,vert:35633},pb={cw:2304,ccw:2305},Lb=new sa(!1,!1,!1,function(){}),ic=function(a,b){function c(){this.endQueryIndex=this.startQueryIndex=-1;this.sum=0;this.stats=null}function e(a,b,d){var f=
k.pop()||new c;f.startQueryIndex=a;f.endQueryIndex=b;f.sum=0;f.stats=d;l.push(f)}var f=b.ext_disjoint_timer_query;if(!f)return null;var g=[],h=[],k=[],l=[],m=[],p=[];return{beginQuery:function(a){var b=g.pop()||f.createQueryEXT();f.beginQueryEXT(35007,b);h.push(b);e(h.length-1,h.length,a)},endQuery:function(){f.endQueryEXT(35007)},pushScopeStats:e,update:function(){var a,b;a=h.length;if(0!==a){p.length=Math.max(p.length,a+1);m.length=Math.max(m.length,a+1);m[0]=0;var c=p[0]=0;for(b=a=0;b<h.length;++b){var d=
h[b];f.getQueryObjectEXT(d,34919)?(c+=f.getQueryObjectEXT(d,34918),g.push(d)):h[a++]=d;m[b+1]=c;p[b+1]=a}h.length=a;for(b=a=0;b<l.length;++b){var c=l[b],e=c.startQueryIndex,d=c.endQueryIndex;c.sum+=m[d]-m[e];e=p[e];d=p[d];d===e?(c.stats.gpuTime+=c.sum/1E6,k.push(c)):(c.startQueryIndex=e,c.endQueryIndex=d,l[a++]=c)}l.length=a}},getNumPendingQueries:function(){return h.length},clear:function(){g.push.apply(g,h);for(var a=0;a<g.length;a++)f.deleteQueryEXT(g[a]);h.length=0;g.length=0},restore:function(){h.length=
0;g.length=0}}};return function(a){function b(){if(0===Q.length)C&&C.update(),Z=null;else{Z=qb.next(b);r();for(var a=Q.length-1;0<=a;--a){var c=Q[a];c&&c(K,null,0)}x.flush();C&&C.update()}}function c(){!Z&&0<Q.length&&(Z=qb.next(b))}function e(){Z&&(qb.cancel(b),Z=null)}function f(a){a.preventDefault();z=!0;e();ca.forEach(function(a){a()})}function h(a){x.getError();z=!1;B.restore();W.restore();P.restore();G.restore();U.restore();S.restore();C&&C.restore();R.procs.refresh();c();da.forEach(function(a){a()})}
function k(a){function b(a){var c={},d={};Object.keys(a).forEach(function(b){var e=a[b];ua.isDynamic(e)?d[b]=ua.unbox(e,b):c[b]=e});return{dynamic:d,"static":c}}function c(a){for(;p.length<a;)p.push(null);return p}g(!!a,"invalid args to regl({...})");g.type(a,"object","invalid args to regl({...})");var d=b(a.context||{}),e=b(a.uniforms||{}),f=b(a.attributes||{}),h=b(function(a){function b(a){if(a in c){var d=c[a];delete c[a];Object.keys(d).forEach(function(b){c[a+"."+b]=d[b]})}}var c=Y({},a);delete c.uniforms;
delete c.attributes;delete c.context;"stencil"in c&&c.stencil.op&&(c.stencil.opBack=c.stencil.opFront=c.stencil.op,delete c.stencil.op);b("blend");b("depth");b("cull");b("stencil");b("polygonOffset");b("scissor");b("sample");return c}(a));a={gpuTime:0,cpuTime:0,count:0};var d=R.compile(h,f,e,d,a),l=d.draw,m=d.batch,n=d.scope,p=[];return Y(function(a,b){var d;z&&g.raise("context lost");if("function"===typeof a)return n.call(this,null,a,0);if("function"===typeof b)if("number"===typeof a)for(d=0;d<a;++d)n.call(this,
null,b,d);else if(Array.isArray(a))for(d=0;d<a.length;++d)n.call(this,a[d],b,d);else return n.call(this,a,b,0);else if("number"===typeof a){if(0<a)return m.call(this,c(a|0),a|0)}else if(Array.isArray(a)){if(a.length)return m.call(this,a,a.length)}else return l.call(this,a)},{stats:a})}function l(a,b){var c=0;R.procs.poll();var d=b.color;d&&(x.clearColor(+d[0]||0,+d[1]||0,+d[2]||0,+d[3]||0),c|=16384);"depth"in b&&(x.clearDepth(+b.depth),c|=256);"stencil"in b&&(x.clearStencil(b.stencil|0),c|=1024);
g(!!c,"called regl.clear with no buffer specified");x.clear(c)}function m(a){g.type(a,"function","regl.frame() callback must be a function");Q.push(a);c();return{cancel:function(){function b(){var a=Mb(Q,b);Q[a]=Q[Q.length-1];--Q.length;0>=Q.length&&e()}var c=Mb(Q,a);g(0<=c,"cannot cancel a frame twice");Q[c]=b}}}function p(){var a=ba.viewport,b=ba.scissor_box;a[0]=a[1]=b[0]=b[1]=0;K.viewportWidth=K.framebufferWidth=K.drawingBufferWidth=a[2]=b[2]=x.drawingBufferWidth;K.viewportHeight=K.framebufferHeight=
K.drawingBufferHeight=a[3]=b[3]=x.drawingBufferHeight}function r(){K.tick+=1;K.time=y();p();R.procs.poll()}function w(){p();R.procs.refresh();C&&C.update()}function y(){return(Ob()-H)/1E3}a=ja(a);if(!a)return null;var x=a.gl,v=x.getContextAttributes(),z=x.isContextLost(),B=Ia(x,a);if(!B)return null;var A=L(),D={bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0},E=B.extensions,C=ic(x,E),H=Ob(),I=x.drawingBufferWidth,J=x.drawingBufferHeight,
K={tick:0,time:0,viewportWidth:I,viewportHeight:J,framebufferWidth:I,framebufferHeight:J,drawingBufferWidth:I,drawingBufferHeight:J,pixelRatio:a.pixelRatio},N=gc(x,E),P=Qb(x,D,a),T=Rb(x,E,P,D),I=ac(x,E,N,P,A),W=bc(x,A,D,a),G=Ub(x,E,N,function(){R.procs.poll()},K,D,a),U=hc(x,E,N,D,a),S=Xb(x,E,N,G,U,D),R=ec(x,A,E,N,P,T,G,S,{},I,W,{elements:null,primitive:4,count:-1,offset:0,instances:-1},K,C,a),A=cc(x,S,R.procs.poll,K,v,E),ba=R.next,aa=x.canvas,Q=[],ca=[],da=[],ea=[a.onDestroy],Z=null;aa&&(aa.addEventListener("webglcontextlost",
f,!1),aa.addEventListener("webglcontextrestored",h,!1));var fa=S.setFBO=k({framebuffer:ua.define.call(null,1,"framebuffer")});w();v=Y(k,{clear:function(a){g("object"===typeof a&&a,"regl.clear() takes an object as input");if("framebuffer"in a)if(a.framebuffer&&"framebufferCube"===a.framebuffer_reglType)for(var b=0;6>b;++b)fa(Y({framebuffer:a.framebuffer.faces[b]},a),l);else fa(a,l);else l(null,a)},prop:ua.define.bind(null,1),context:ua.define.bind(null,2),"this":ua.define.bind(null,3),draw:k({}),buffer:function(a){return P.create(a,
34962,!1,!1)},elements:function(a){return T.create(a,!1)},texture:G.create2D,cube:G.createCube,renderbuffer:U.create,framebuffer:S.create,framebufferCube:S.createCube,attributes:v,frame:m,on:function(a,b){g.type(b,"function","listener callback must be a function");var c;switch(a){case "frame":return m(b);case "lost":c=ca;break;case "restore":c=da;break;case "destroy":c=ea;break;default:g.raise("invalid event, must be one of frame,lost,restore,destroy")}c.push(b);return{cancel:function(){for(var a=
0;a<c.length;++a)if(c[a]===b){c[a]=c[c.length-1];c.pop();break}}}},limits:N,hasExtension:function(a){return 0<=N.extensions.indexOf(a.toLowerCase())},read:A,destroy:function(){Q.length=0;e();aa&&(aa.removeEventListener("webglcontextlost",f),aa.removeEventListener("webglcontextrestored",h));W.clear();S.clear();U.clear();G.clear();T.clear();P.clear();C&&C.clear();ea.forEach(function(a){a()})},_gl:x,_refresh:w,poll:function(){r();C&&C.update()},now:y,stats:D});a.onDone(null,v);return v}})},{}],27:[function(k,
e,r){var a=k("regl")(),b=k("gl-mat4"),f=k("hsv2rgb");k=a.buffer(Array(1E4).fill().map(function(){var a=f(360*Math.random(),.6,1);return[10*Math.random(),10*Math.random(),10*Math.random(),10*Math.random(),2*Math.PI*Math.random(),2*Math.PI*Math.random(),2*Math.PI*Math.random(),2*Math.PI*Math.random(),a[0]/255,a[1]/255,a[2]/255]}));var c=a({vert:"\n  precision mediump float;\n  attribute vec4 freq, phase;\n  attribute vec3 color;\n  uniform float time;\n  uniform mat4 view, projection;\n  varying vec3 fragColor;\n  void main() {\n    vec3 position = 8.0 * cos(freq.xyz * time + phase.xyz);\n    gl_PointSize = 5.0 * (1.0 + cos(freq.w * time + phase.w));\n    gl_Position = projection * view * vec4(position, 1);\n    fragColor = color;\n  }",
frag:"\n  precision lowp float;\n  varying vec3 fragColor;\n  void main() {\n    if (length(gl_PointCoord.xy - 0.5) > 0.5) {\n      discard;\n    }\n    gl_FragColor = vec4(fragColor, 1);\n  }",attributes:{freq:{buffer:k,stride:44,offset:0},phase:{buffer:k,stride:44,offset:16},color:{buffer:k,stride:44,offset:32}},uniforms:{view:function(a){a=.01*a.tick;return b.lookAt([],[30*Math.cos(a),2.5,30*Math.sin(a)],[0,0,0],[0,1,0])},projection:function(a){return b.perspective([],Math.PI/4,a.viewportWidth/
a.viewportHeight,.01,1E3)},time:function(a){return.001*a.tick}},count:1E4,primitive:"points"});a.frame(function(){a.clear({depth:1,color:[0,0,0,1]});c()})},{"gl-mat4":10,hsv2rgb:25,regl:26}]},{},[27]);

        </script>
        </body>
      </html>